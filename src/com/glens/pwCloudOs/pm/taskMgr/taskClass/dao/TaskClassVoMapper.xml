<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.glens.pwCloudOs.pm.taskMgr.taskClass.dao.TaskClassVoMapper" >
  <resultMap id="BaseResultMap" type="com.glens.pwCloudOs.pm.taskMgr.taskClass.vo.TaskClassVo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    
    <id column="rowid" property="rowid" jdbcType="BIGINT" />
    <result column="COMPANY_CODE" property="companyCode" jdbcType="VARCHAR" />
    <result column="PRO_NO" property="proNo" jdbcType="VARCHAR" />
     <result column="PRO_NAME" property="proName" jdbcType="VARCHAR" />
     <result column="CATEGORY_CODE" property="categoryCode" jdbcType="VARCHAR" />
     <result column="CATEGORY_NAME" property="categoryName" jdbcType="VARCHAR" />
    <result column="TASK_CLASS_CODE" property="taskClassCode" jdbcType="VARCHAR" />
    <result column="TASK_CLASS_NAME" property="taskClassName" jdbcType="VARCHAR" /> 
    <result column="TASK_TYPE" property="taskType" jdbcType="INTEGER" /> 
    <result column="TASK_WORDLOAD" property="taskWordload" jdbcType="REAL" />     
    <result column="KPI_CODE" property="kpiCode" jdbcType="VARCHAR" />
    <result column="KPI_NAME" property="kpiName" jdbcType="VARCHAR" />  
    <result column="KPI_UNIT" property="kpiUnit" jdbcType="VARCHAR" />  
    <result column="KPI_WORDLOAD" property="kpiWordload" jdbcType="REAL" />
    <result column="REMARKS" property="remarks" jdbcType="VARCHAR" />  
  </resultMap>
  
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
     c.PRO_NO,p.PRO_NAME,p.CATEGORY_CODE,g.CATEGORY_NAME,c.TASK_CLASS_CODE,c.TASK_CLASS_NAME,c.TASK_TYPE,c.TASK_WORDLOAD,c.KPI_CODE,k.KPI_NAME,k.KPI_UNIT,c.KPI_WORDLOAD,c.REMARKS

  </sql>
  
  <select id="queryForCount" parameterType="java.util.HashMap" resultType="int">
  	select count(*) from PM_TASK_CLASS
  	where SYS_PROCESS_FLAG='1' 
  	<if test="proNo != null and proNo != ''">
  	 and PRO_NO=#{proNo}
  	</if>
  	
  </select>
  
  <select id="queryForPage" parameterType="java.util.HashMap" resultMap="BaseResultMap">
  	select 
    <include refid="Base_Column_List" />
    from PM_TASK_CLASS c
	LEFT JOIN PM_BASE p on p.PRO_NO=c.PRO_NO
	LEFT JOIN PM_KPI_LIB k on k.KPI_CODE=c.KPI_CODE
	LEFT JOIN pm_category g on g.CATEGORY_CODE=p.CATEGORY_CODE
    where c.SYS_PROCESS_FLAG='1' 
   <if test="proNo != null and proNo != ''">
  	 and c.PRO_NO=#{proNo}
  	</if>
  	limit #{firstResult},#{maxResult}
  </select>
  
  <select id="getKpiList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  	  select KPI_CODE kpicode,KPI_NAME kpiname,KPI_UNIT kpiunit from pm_kpi_lib 
  	  where category_code=#{categoryCode} and kpi_type=#{taskType}
  	  
  </select>
  
  <delete id="delete" parameterType="com.glens.pwCloudOs.pm.taskMgr.taskClass.vo.TaskClassVo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update PM_TASK_CLASS set sys_process_flag='0', SYS_DELETE_TIME=now()
    where TASK_CLASS_CODE = #{taskClassCode}
  </delete>
  <insert id="insert" parameterType="com.glens.pwCloudOs.pm.taskMgr.mctMgr.vo.MctVo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->

  
insert into PM_TASK_CLASS(COMPANY_CODE,PRO_NO,TASK_CLASS_CODE,TASK_CLASS_NAME,TASK_TYPE,TASK_WORDLOAD,KPI_CODE,KPI_WORDLOAD,SYS_CREATE_TIME,SYS_PROCESS_FLAG,REMARKS)
VALUES (#{companyCode},#{proNo},#{taskClassCode},#{taskClassName},#{taskType},#{taskWordload},#{kpiCode},#{kpiWordload},NOW(),'1',#{remarks})
  </insert>
  
   <update id="update" parameterType="com.glens.pwCloudOs.pm.taskMgr.taskClass.vo.TaskClassVo" >
  		update PM_TASK_CLASS set 
  		PRO_NO=#{proNo},
  		TASK_CLASS_NAME=#{taskClassName},
  		TASK_TYPE=#{taskType},
  		TASK_WORDLOAD=#{taskWordload},
  		KPI_CODE=#{kpiCode},
  		KPI_WORDLOAD=#{kpiWordload},
  		SYS_UPDATE_TIME=now(),
  		REMARKS=#{remarks}
  		where TASK_CLASS_CODE=#{taskClassCode}
  </update>
  
   <select id="findById" resultMap="BaseResultMap" parameterType="com.glens.pwCloudOs.pm.taskMgr.taskClass.vo.TaskClassVo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from PM_TASK_CLASS c
	LEFT JOIN PM_BASE p on p.PRO_NO=c.PRO_NO
	LEFT JOIN PM_KPI_LIB k on k.KPI_CODE=c.KPI_CODE
	LEFT JOIN pm_category g on g.CATEGORY_CODE=p.CATEGORY_CODE
    where c.SYS_PROCESS_FLAG='1' 
    and  c.TASK_CLASS_CODE = #{taskClassCode}
  </select>
  
 
  
</mapper>