<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.glens.pwCloudOs.pm.scene.spot.dao.ProSpotMapper" >
  <resultMap id="BaseResultMap" type="com.glens.pwCloudOs.pm.scene.spot.vo.ProSpot" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="rowid" property="rowid" jdbcType="BIGINT" />
    <result column="COMPANY_CODE" property="companyCode" jdbcType="VARCHAR" />
    <result column="SPOT_CODE" property="spotCode" jdbcType="VARCHAR" />
    <result column="SPOT_NAME" property="spotName" jdbcType="VARCHAR" />
    <result column="PRO_NO" property="proNo" jdbcType="VARCHAR" />
    <result column="PRO_NAME" property="proName" jdbcType="VARCHAR" />
    <result column="BUILD_EMPLOYEE_CODE" property="buildEmployeeCode" jdbcType="VARCHAR" />
    <result column="MANAGE_EMPLOYEE_CODE" property="manageEmployeeCode" jdbcType="VARCHAR" />
    <result column="OWNER_EMPLOYEE_CODE" property="ownerEmployeeCode" jdbcType="VARCHAR" />
    <result column="SPOT_ADDR" property="spotAddr" jdbcType="VARCHAR" />
    <result column="LNG" property="lng" jdbcType="VARCHAR" />
    <result column="LAT" property="lat" jdbcType="VARCHAR" />
    <result column="PIC1" property="pic1" jdbcType="VARCHAR" />
    <result column="PIC2" property="pic2" jdbcType="VARCHAR" />
    <result column="PIC3" property="pic3" jdbcType="VARCHAR" />
    <result column="SYS_CREATE_TIME" property="sysCreateTime" jdbcType="VARCHAR" />
    <result column="SYS_UPDATE_TIME" property="sysUpdateTime" jdbcType="VARCHAR" />
    <result column="SYS_DELETE_TIME" property="sysDeleteTime" jdbcType="VARCHAR" />
    <result column="SYS_PROCESS_FLAG" property="sysProcessFlag" jdbcType="CHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    rowid, COMPANY_CODE, SPOT_CODE, SPOT_NAME, PRO_NO, PRO_NAME, BUILD_EMPLOYEE_CODE, 
    MANAGE_EMPLOYEE_CODE, OWNER_EMPLOYEE_CODE, SPOT_ADDR, LNG, LAT, PIC1, PIC2, PIC3, 
    SYS_CREATE_TIME, SYS_UPDATE_TIME, SYS_DELETE_TIME, SYS_PROCESS_FLAG
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from pro_spot
    where rowid = #{rowid,jdbcType=BIGINT}
  </select>
  
  
  
  <select id="queryProSpotInfo" resultType="map"  parameterType="map">
	SELECT
		b.PRO_NO,
		b.PRO_NAME,
		b.SPOT_CODE,
		b.SPOT_NAME,
		c.DEVICE_NO,
		c.DEVICE_NAME,
		c.DEVICE_CHANNEL
	FROM
		pro_spot b
	LEFT JOIN pro_camera c ON b.SPOT_CODE = c.SPOT_CODE
	AND c.`STATUS` = '1'
	WHERE
		b.SYS_PROCESS_FLAG = '1'
	ORDER BY
		b.rowid
	  </select>
  
  
  <select id="queryProspotCode" resultType="map"  parameterType="map">
  	select SPOT_CODE 	from pro_spot
  	where SYS_PROCESS_FLAG='1'
  	and  BUILD_EMPLOYEE_CODE=#{reportEmployeeCode}
  </select>
  
  
  <select id="getSpot" resultType="map" parameterType="string" >
	SELECT
		b.rowid,
		b.COMPANY_CODE,
		b.SPOT_CODE,
		b.SPOT_NAME,
		b.PRO_NO,
		b.PRO_NAME,
		b.BUILD_EMPLOYEE_CODE,
		c.EMPLOYEENAME BUILD_EMPLOYEE_NAME,
		b.MANAGE_EMPLOYEE_CODE,
		d.EMPLOYEENAME MANAGE_EMPLOYEE_NAME,
		b.OWNER_EMPLOYEE_CODE,
		e.EMPLOYEENAME OWNER_EMPLOYEE_NAME,
		b.SPOT_ADDR,
		b.LNG,
		b.LAT,
		b.PIC1,
		b.PIC2,
		b.PIC3,
		g.CATEGORY_NAME,
		g.CATEGORY_CODE
	FROM
		pro_spot b
	LEFT JOIN md_employee c ON b.BUILD_EMPLOYEE_CODE = c.EMPLOYEECODE
	LEFT JOIN md_employee d ON b.MANAGE_EMPLOYEE_CODE = d.EMPLOYEECODE
	LEFT JOIN md_employee e ON b.OWNER_EMPLOYEE_CODE = e.EMPLOYEECODE
	LEFT JOIN pm_base f ON b.PRO_NO = f.PRO_CODE
	LEFT JOIN pm_category g ON f.CATEGORY_CODE = g.CATEGORY_CODE	
    where    b.SYS_PROCESS_FLAG='1'
    and      b.SPOT_CODE = #{spotCode}
  </select>
  
    <select id="queryForList" resultType="map"  parameterType="map">
  	select  distinct SPOT_CODE spotCode, SPOT_NAME spotName
  	from pro_spot
  	where SYS_PROCESS_FLAG='1'
  	<if test="proNo!=null and proNo!=''">
  	and PRO_NO=#{proNo}
  	</if>
  </select>
  
   <select id="queryForCount" parameterType="java.util.HashMap" resultType="int">
  	select count(*)
  	from pro_spot 
  	where SYS_PROCESS_FLAG='1'
  	<if test="proNo!=null and proNo!=''">
  		and PRO_NO=#{proNo}
  	</if>
  	<if test="spotName!=null and spotName!=''">
  		and SPOT_NAME  like concat('%',#{spotName},'%')
  	</if>
  	
  </select>
  
  <select id="queryForPage" parameterType="java.util.HashMap" resultType="map">
	SELECT
		b.rowid,
		b.COMPANY_CODE companyCode,
		b.SPOT_CODE spotCode,
		b.SPOT_NAME spotName,
		b.PRO_NO proNo,
		b.PRO_NAME proName,
		b.BUILD_EMPLOYEE_CODE buildEmployeeCode,
		b.MANAGE_EMPLOYEE_CODE manageEmployeeCode,
		b.OWNER_EMPLOYEE_CODE ownerEmployeeCode,
		b.SPOT_ADDR spotAddr,
		b.LNG lng,
		b.LAT lat,
		b.PIC1 pic1,
		b.PIC2 pic2,
		b.PIC3 pic3,
		c.EMPLOYEENAME buildEmployeeName,
		c.MOBILEPHONE1 buildEmployeeMobile,
		d.EMPLOYEENAME manageEmployeeName,
		d.MOBILEPHONE1 manageEmployeeMobile,
		e.EMPLOYEENAME ownerEmployeeName,
		e.MOBILEPHONE1 ownerEmployeeMobile
	FROM
		pro_spot b
	LEFT JOIN md_employee c ON b.BUILD_EMPLOYEE_CODE = c.EMPLOYEECODE
	LEFT JOIN md_employee d ON b.MANAGE_EMPLOYEE_CODE = d.EMPLOYEECODE
	LEFT JOIN md_employee e ON b.OWNER_EMPLOYEE_CODE = e.EMPLOYEECODE
	WHERE
		b.SYS_PROCESS_FLAG = '1'  	
  	<if test="proNo!=null and proNo!=''">
  		and b.PRO_NO=#{proNo}
  	</if>
  	<if test="spotName!=null and spotName!=''">
  		and b.SPOT_NAME like concat('%',#{spotName},'%')
  	</if>
  	limit #{firstResult},#{maxResult}
  </select>
  
  
  
  
   <select id="queryForCount1" parameterType="java.util.HashMap" resultType="int">
  	select count(*)
  	from pro_spot 
  	where SYS_PROCESS_FLAG='1'
  	<if test="proNo!=null and proNo!=''">
  		and PRO_NO=#{proNo}
  	</if>
  	<if test="spotCode!=null and spotCode!=''">
  		and SPOT_CODE=#{spotCode}
  	</if>
  </select>
  
  <select id="queryForPage1" parameterType="java.util.HashMap" resultType="map">
		SELECT
		b.rowid,
		b.PRO_NO,
		b.PRO_NAME,
		b.SPOT_CODE,
		b.SPOT_NAME,
		b.BUILD_EMPLOYEE_CODE,
		c.EMPLOYEENAME BUILD_EMPLOYEE_NAME,
		b.MANAGE_EMPLOYEE_CODE,
		b.LNG,
		b.LAT,
		d.EMPLOYEENAME MANAGE_EMPLOYEE_NAME,
		b.OWNER_EMPLOYEE_CODE,
		e.EMPLOYEENAME OWNER_EMPLOYEE_NAME,
		(
			SELECT
				count(1)
			FROM
				pro_workers f
			WHERE
				f.SPOT_CODE = b.spot_code
			AND f.SYS_PROCESS_FLAG = '1'
		) TOTAL_COUNT,
		(
		SELECT
			count(DISTINCT  g.CARD_NO)
		FROM
			pm_scene_monitoring g  join pro_workers  h  on g.CARD_NO=h.WORKER_CARD and h.SYS_PROCESS_FLAG='1'
		WHERE
			g.SPOT_CODE = b.SPOT_CODE
			<if test="startTime!=null and startTime!=''">
				AND g.REPORT_DATE = #{startTime}
			</if>
		)  COUNT
	FROM
		pro_spot b
	LEFT JOIN md_employee c ON b.BUILD_EMPLOYEE_CODE = c.EMPLOYEECODE
	LEFT JOIN md_employee d ON b.MANAGE_EMPLOYEE_CODE = d.EMPLOYEECODE
	LEFT JOIN md_employee e ON b.OWNER_EMPLOYEE_CODE = e.EMPLOYEECODE
	WHERE
		b.SYS_PROCESS_FLAG = '1' 	
  	<if test="proNo!=null and proNo!=''">
  		and b.PRO_NO=#{proNo}
  	</if>
  	<if test="spotCode!=null and spotCode!=''">
  		and b.SPOT_CODE=#{spotCode}
  	</if>
  	limit #{firstResult},#{maxResult}
  </select>
  
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from pro_spot
    where rowid = #{rowid,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.glens.pwCloudOs.pm.scene.spot.vo.ProSpot" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into pro_spot (rowid, COMPANY_CODE, SPOT_CODE, 
      SPOT_NAME, PRO_NO, PRO_NAME, 
      BUILD_EMPLOYEE_CODE, MANAGE_EMPLOYEE_CODE, 
      OWNER_EMPLOYEE_CODE, SPOT_ADDR, LNG, 
      LAT, PIC1, PIC2, PIC3, 
      SYS_CREATE_TIME, SYS_UPDATE_TIME, SYS_DELETE_TIME, 
      SYS_PROCESS_FLAG)
    values (#{rowid,jdbcType=BIGINT}, #{companyCode,jdbcType=VARCHAR}, #{spotCode,jdbcType=VARCHAR}, 
      #{spotName,jdbcType=VARCHAR}, #{proNo,jdbcType=VARCHAR}, #{proName,jdbcType=VARCHAR}, 
      #{buildEmployeeCode,jdbcType=VARCHAR}, #{manageEmployeeCode,jdbcType=VARCHAR}, 
      #{ownerEmployeeCode,jdbcType=VARCHAR}, #{spotAddr,jdbcType=VARCHAR}, #{lng,jdbcType=VARCHAR}, 
      #{lat,jdbcType=VARCHAR}, #{pic1,jdbcType=VARCHAR}, #{pic2,jdbcType=VARCHAR}, #{pic3,jdbcType=VARCHAR}, 
      #{sysCreateTime,jdbcType=VARCHAR}, #{sysUpdateTime,jdbcType=VARCHAR}, #{sysDeleteTime,jdbcType=VARCHAR}, 
      #{sysProcessFlag,jdbcType=CHAR})
  </insert>
  
  <insert id="insertSelective" parameterType="com.glens.pwCloudOs.pm.scene.spot.vo.ProSpot" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into pro_spot
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="rowid != null" >
        rowid,
      </if>
      <if test="companyCode != null" >
        COMPANY_CODE,
      </if>
      <if test="spotCode != null" >
        SPOT_CODE,
      </if>
      <if test="spotName != null" >
        SPOT_NAME,
      </if>
      <if test="proNo != null" >
        PRO_NO,
      </if>
      <if test="proName != null" >
        PRO_NAME,
      </if>
      <if test="buildEmployeeCode != null" >
        BUILD_EMPLOYEE_CODE,
      </if>
      <if test="manageEmployeeCode != null" >
        MANAGE_EMPLOYEE_CODE,
      </if>
      <if test="ownerEmployeeCode != null" >
        OWNER_EMPLOYEE_CODE,
      </if>
      <if test="spotAddr != null" >
        SPOT_ADDR,
      </if>
      <if test="lng != null" >
        LNG,
      </if>
      <if test="lat != null" >
        LAT,
      </if>
      <if test="pic1 != null" >
        PIC1,
      </if>
      <if test="pic2 != null" >
        PIC2,
      </if>
      <if test="pic3 != null" >
        PIC3,
      </if>
      <if test="sysCreateTime != null" >
        SYS_CREATE_TIME,
      </if>
      <if test="sysUpdateTime != null" >
        SYS_UPDATE_TIME,
      </if>
      <if test="sysDeleteTime != null" >
        SYS_DELETE_TIME,
      </if>
      <if test="sysProcessFlag != null" >
        SYS_PROCESS_FLAG,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="rowid != null" >
        #{rowid,jdbcType=BIGINT},
      </if>
      <if test="companyCode != null" >
        #{companyCode,jdbcType=VARCHAR},
      </if>
      <if test="spotCode != null" >
        #{spotCode,jdbcType=VARCHAR},
      </if>
      <if test="spotName != null" >
        #{spotName,jdbcType=VARCHAR},
      </if>
      <if test="proNo != null" >
        #{proNo,jdbcType=VARCHAR},
      </if>
      <if test="proName != null" >
        #{proName,jdbcType=VARCHAR},
      </if>
      <if test="buildEmployeeCode != null" >
        #{buildEmployeeCode,jdbcType=VARCHAR},
      </if>
      <if test="manageEmployeeCode != null" >
        #{manageEmployeeCode,jdbcType=VARCHAR},
      </if>
      <if test="ownerEmployeeCode != null" >
        #{ownerEmployeeCode,jdbcType=VARCHAR},
      </if>
      <if test="spotAddr != null" >
        #{spotAddr,jdbcType=VARCHAR},
      </if>
      <if test="lng != null" >
        #{lng,jdbcType=VARCHAR},
      </if>
      <if test="lat != null" >
        #{lat,jdbcType=VARCHAR},
      </if>
      <if test="pic1 != null" >
        #{pic1,jdbcType=VARCHAR},
      </if>
      <if test="pic2 != null" >
        #{pic2,jdbcType=VARCHAR},
      </if>
      <if test="pic3 != null" >
        #{pic3,jdbcType=VARCHAR},
      </if>
      <if test="sysCreateTime != null" >
        #{sysCreateTime,jdbcType=VARCHAR},
      </if>
      <if test="sysUpdateTime != null" >
        #{sysUpdateTime,jdbcType=VARCHAR},
      </if>
      <if test="sysDeleteTime != null" >
        #{sysDeleteTime,jdbcType=VARCHAR},
      </if>
      <if test="sysProcessFlag != null" >
        #{sysProcessFlag,jdbcType=CHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.glens.pwCloudOs.pm.scene.spot.vo.ProSpot" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update pro_spot
    <set >
      <if test="companyCode != null" >
        COMPANY_CODE = #{companyCode,jdbcType=VARCHAR},
      </if>
      <if test="spotName != null" >
        SPOT_NAME = #{spotName,jdbcType=VARCHAR},
      </if>
      <if test="proNo != null" >
        PRO_NO = #{proNo,jdbcType=VARCHAR},
      </if>
      <if test="proName != null" >
        PRO_NAME = #{proName,jdbcType=VARCHAR},
      </if>
      <if test="buildEmployeeCode != null" >
        BUILD_EMPLOYEE_CODE = #{buildEmployeeCode,jdbcType=VARCHAR},
      </if>
      <if test="manageEmployeeCode != null" >
        MANAGE_EMPLOYEE_CODE = #{manageEmployeeCode,jdbcType=VARCHAR},
      </if>
      <if test="ownerEmployeeCode != null" >
        OWNER_EMPLOYEE_CODE = #{ownerEmployeeCode,jdbcType=VARCHAR},
      </if>
      <if test="spotAddr != null" >
        SPOT_ADDR = #{spotAddr,jdbcType=VARCHAR},
      </if>
      <if test="lng != null" >
        LNG = #{lng,jdbcType=VARCHAR},
      </if>
      <if test="lat != null" >
        LAT = #{lat,jdbcType=VARCHAR},
      </if>
      <if test="pic1 != null" >
        PIC1 = #{pic1,jdbcType=VARCHAR},
      </if>
      <if test="pic2 != null" >
        PIC2 = #{pic2,jdbcType=VARCHAR},
      </if>
      <if test="pic3 != null" >
        PIC3 = #{pic3,jdbcType=VARCHAR},
      </if>
      <if test="sysCreateTime != null" >
        SYS_CREATE_TIME = #{sysCreateTime,jdbcType=VARCHAR},
      </if>
      <if test="sysUpdateTime != null" >
        SYS_UPDATE_TIME = #{sysUpdateTime,jdbcType=VARCHAR},
      </if>
      <if test="sysDeleteTime != null" >
        SYS_DELETE_TIME = #{sysDeleteTime,jdbcType=VARCHAR},
      </if>
      <if test="sysProcessFlag != null" >
        SYS_PROCESS_FLAG = #{sysProcessFlag,jdbcType=CHAR},
      </if>
    </set>
    where SPOT_CODE = #{spotCode}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.glens.pwCloudOs.pm.scene.spot.vo.ProSpot" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update pro_spot
    set COMPANY_CODE = #{companyCode,jdbcType=VARCHAR},
      SPOT_NAME = #{spotName,jdbcType=VARCHAR},
      PRO_NO = #{proNo,jdbcType=VARCHAR},
      PRO_NAME = #{proName,jdbcType=VARCHAR},
      BUILD_EMPLOYEE_CODE = #{buildEmployeeCode,jdbcType=VARCHAR},
      MANAGE_EMPLOYEE_CODE = #{manageEmployeeCode,jdbcType=VARCHAR},
      OWNER_EMPLOYEE_CODE = #{ownerEmployeeCode,jdbcType=VARCHAR},
      SPOT_ADDR = #{spotAddr,jdbcType=VARCHAR},
      LNG = #{lng,jdbcType=VARCHAR},
      LAT = #{lat,jdbcType=VARCHAR},
      PIC1 = #{pic1,jdbcType=VARCHAR},
      PIC2 = #{pic2,jdbcType=VARCHAR},
      PIC3 = #{pic3,jdbcType=VARCHAR},
      SYS_CREATE_TIME = #{sysCreateTime,jdbcType=VARCHAR},
      SYS_UPDATE_TIME = #{sysUpdateTime,jdbcType=VARCHAR},
      SYS_DELETE_TIME = #{sysDeleteTime,jdbcType=VARCHAR},
      SYS_PROCESS_FLAG = #{sysProcessFlag,jdbcType=CHAR}
   where SPOT_CODE = #{spotCode}
  </update>
</mapper>