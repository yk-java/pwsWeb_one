<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.glens.pwCloudOs.pm.plan.dao.PmPlanKpiMapper" >
  <resultMap id="BaseResultMap" type="com.glens.pwCloudOs.pm.plan.vo.PmPlanKpi" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="rowid" property="rowid" jdbcType="BIGINT" />
    <result column="COMPANY_CODE" property="companyCode" jdbcType="VARCHAR" />
    <result column="PRO_NO" property="proNo" jdbcType="VARCHAR" />
    <result column="PRO_NAME" property="proName" jdbcType="VARCHAR" />
    <result column="PLAN_NO" property="planNo" jdbcType="VARCHAR" />
    <result column="KPI_CODE" property="kpiCode" jdbcType="VARCHAR" />
    <result column="KPI_VALUE" property="kpiValue" jdbcType="REAL" />
    <result column="ATTACHED_VALUE" property="attachedValue" jdbcType="REAL" />
    <result column="STANDARD_HOURS" property="standardHours" jdbcType="REAL" />
    <result column="REPORT_DATE" property="reportDate" jdbcType="DATE" />
    <result column="SYS_CREATE_TIME" property="sysCreateTime" jdbcType="TIMESTAMP" />
    <result column="SYS_UPDATE_TIME" property="sysUpdateTime" jdbcType="TIMESTAMP" />
    <result column="SYS_DELETE_TIME" property="sysDeleteTime" jdbcType="TIMESTAMP" />
    <result column="SYS_PROCESS_FLAG" property="sysProcessFlag" jdbcType="CHAR" />
    <result column="REMARKS" property="remarks" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    rowid, COMPANY_CODE, PRO_NO, PRO_NAME, PLAN_NO, KPI_CODE, KPI_VALUE, ATTACHED_VALUE, STANDARD_HOURS,
    REPORT_DATE, SYS_CREATE_TIME, SYS_UPDATE_TIME, SYS_DELETE_TIME, SYS_PROCESS_FLAG, 
    REMARKS
  </sql>
  <select id="findById" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from pm_plan_kpi
    where rowid = #{rowid,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from pm_plan_kpi
    where rowid = #{rowid,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.glens.pwCloudOs.pm.plan.vo.PmPlanKpi" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into pm_plan_kpi (rowid, COMPANY_CODE, PRO_NO, 
      PRO_NAME, PLAN_NO, KPI_CODE, 
      KPI_VALUE, ATTACHED_VALUE, REPORT_DATE, STANDARD_HOURS,
      SYS_CREATE_TIME, SYS_UPDATE_TIME, SYS_DELETE_TIME, 
      SYS_PROCESS_FLAG, REMARKS)
    values (#{rowid,jdbcType=BIGINT}, #{companyCode,jdbcType=VARCHAR}, #{proNo,jdbcType=VARCHAR}, 
      #{proName,jdbcType=VARCHAR}, #{planNo,jdbcType=VARCHAR}, #{kpiCode,jdbcType=VARCHAR}, 
      #{kpiValue,jdbcType=REAL}, #{attachedValue,jdbcType=REAL}, #{reportDate,jdbcType=DATE}, #{standardHours,jdbcType=REAL},
      #{sysCreateTime,jdbcType=TIMESTAMP}, #{sysUpdateTime,jdbcType=TIMESTAMP}, #{sysDeleteTime,jdbcType=TIMESTAMP}, 
      #{sysProcessFlag,jdbcType=CHAR}, #{remarks,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.glens.pwCloudOs.pm.plan.vo.PmPlanKpi" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into pm_plan_kpi
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="rowid != null" >
        rowid,
      </if>
      <if test="companyCode != null" >
        COMPANY_CODE,
      </if>
      <if test="proNo != null" >
        PRO_NO,
      </if>
      <if test="proName != null" >
        PRO_NAME,
      </if>
      <if test="planNo != null" >
        PLAN_NO,
      </if>
      <if test="kpiCode != null" >
        KPI_CODE,
      </if>
      <if test="kpiValue != null" >
        KPI_VALUE,
      </if>
      <if test="attachedValue != null" >
        ATTACHED_VALUE,
      </if>
      <if test="reportDate != null" >
        REPORT_DATE,
      </if>
      <if test="sysCreateTime != null" >
        SYS_CREATE_TIME,
      </if>
      <if test="sysUpdateTime != null" >
        SYS_UPDATE_TIME,
      </if>
      <if test="sysDeleteTime != null" >
        SYS_DELETE_TIME,
      </if>
      <if test="sysProcessFlag != null" >
        SYS_PROCESS_FLAG,
      </if>
      <if test="remarks != null" >
        REMARKS,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="rowid != null" >
        #{rowid,jdbcType=BIGINT},
      </if>
      <if test="companyCode != null" >
        #{companyCode,jdbcType=VARCHAR},
      </if>
      <if test="proNo != null" >
        #{proNo,jdbcType=VARCHAR},
      </if>
      <if test="proName != null" >
        #{proName,jdbcType=VARCHAR},
      </if>
      <if test="planNo != null" >
        #{planNo,jdbcType=VARCHAR},
      </if>
      <if test="kpiCode != null" >
        #{kpiCode,jdbcType=VARCHAR},
      </if>
      <if test="kpiValue != null" >
        #{kpiValue,jdbcType=REAL},
      </if>
      <if test="attachedValue != null" >
        #{attachedValue,jdbcType=REAL},
      </if>
      <if test="reportDate != null" >
        #{reportDate,jdbcType=DATE},
      </if>
      <if test="sysCreateTime != null" >
        #{sysCreateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="sysUpdateTime != null" >
        #{sysUpdateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="sysDeleteTime != null" >
        #{sysDeleteTime,jdbcType=TIMESTAMP},
      </if>
      <if test="sysProcessFlag != null" >
        #{sysProcessFlag,jdbcType=CHAR},
      </if>
      <if test="remarks != null" >
        #{remarks,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.glens.pwCloudOs.pm.plan.vo.PmPlanKpi" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update pm_plan_kpi
    <set >
      <if test="companyCode != null" >
        COMPANY_CODE = #{companyCode,jdbcType=VARCHAR},
      </if>
      <if test="proNo != null" >
        PRO_NO = #{proNo,jdbcType=VARCHAR},
      </if>
      <if test="proName != null" >
        PRO_NAME = #{proName,jdbcType=VARCHAR},
      </if>
      <if test="planNo != null" >
        PLAN_NO = #{planNo,jdbcType=VARCHAR},
      </if>
      <if test="kpiCode != null" >
        KPI_CODE = #{kpiCode,jdbcType=VARCHAR},
      </if>
      <if test="kpiValue != null" >
        KPI_VALUE = #{kpiValue,jdbcType=REAL},
      </if>
      <if test="attachedValue != null" >
        ATTACHED_VALUE = #{attachedValue,jdbcType=REAL},
      </if>
      <if test="reportDate != null" >
        REPORT_DATE = #{reportDate,jdbcType=DATE},
      </if>
      <if test="sysCreateTime != null" >
        SYS_CREATE_TIME = #{sysCreateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="sysUpdateTime != null" >
        SYS_UPDATE_TIME = #{sysUpdateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="sysDeleteTime != null" >
        SYS_DELETE_TIME = #{sysDeleteTime,jdbcType=TIMESTAMP},
      </if>
      <if test="sysProcessFlag != null" >
        SYS_PROCESS_FLAG = #{sysProcessFlag,jdbcType=CHAR},
      </if>
      <if test="remarks != null" >
        REMARKS = #{remarks,jdbcType=VARCHAR},
      </if>
    </set>
    where rowid = #{rowid,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.glens.pwCloudOs.pm.plan.vo.PmPlanKpi" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update pm_plan_kpi
    set COMPANY_CODE = #{companyCode,jdbcType=VARCHAR},
      PRO_NO = #{proNo,jdbcType=VARCHAR},
      PRO_NAME = #{proName,jdbcType=VARCHAR},
      PLAN_NO = #{planNo,jdbcType=VARCHAR},
      KPI_CODE = #{kpiCode,jdbcType=VARCHAR},
      KPI_VALUE = #{kpiValue,jdbcType=REAL},
      ATTACHED_VALUE = #{attachedValue,jdbcType=REAL},
      REPORT_DATE = #{reportDate,jdbcType=DATE},
      SYS_CREATE_TIME = #{sysCreateTime,jdbcType=TIMESTAMP},
      SYS_UPDATE_TIME = #{sysUpdateTime,jdbcType=TIMESTAMP},
      SYS_DELETE_TIME = #{sysDeleteTime,jdbcType=TIMESTAMP},
      SYS_PROCESS_FLAG = #{sysProcessFlag,jdbcType=CHAR},
      REMARKS = #{remarks,jdbcType=VARCHAR}
    where rowid = #{rowid,jdbcType=BIGINT}
  </update>
  <select id="queryForList" resultType="map">
    select 
    	t1.rowid,t1.company_code as companyCode,t1.pro_no as proNo,
    	t1.pro_name as proName, t1.plan_no as planNo, t2.kpi_code as kpiCode,
    	t1.kpi_value as kpiValue, t1.attached_value as attachedValue, t1.report_date as reportDate,t1.STANDARD_HOURS as standardHours,
    	t1.sys_create_time as sysCreateTime, 
    	t2.kpi_name as kpiName, t2.kpi_unit as kpiUnit, t2.kpi_type as kpiType, t2.is_per_cnt as isPerCnt
    from pm_plan_kpi t1
    RIGHT JOIN (SELECT tt1.* FROM pm_pro_kpi tt1 
		WHERE tt1.pro_no=#{proNo,jdbcType=VARCHAR}
    ) t2 
    ON t2.kpi_code = t1.kpi_code 
	    AND t1.pro_no=#{proNo,jdbcType=VARCHAR}
	    <if test="planNo != null and planNo != ''">
	    and t1.PLAN_NO = #{planNo,jdbcType=VARCHAR}
	    </if>
	    <if test="reportDate != null and reportDate != ''">
	    and t1.REPORT_DATE = #{reportDate,jdbcType=DATE}
	    </if>
    order by t2.kpi_type, t1.kpi_code
  </select>
  
  <select id="queryForCount" resultType="int" parameterType="map">
    select 
    count(*)
    from pm_plan_kpi
  </select>
  
  <select id="queryForPage" resultMap="BaseResultMap" parameterType="map">
    select 
    <include refid="Base_Column_List" />
    from pm_plan_kpi
    limit #{firstResult},#{maxResult} 
  </select>
  
  <insert id="batchInsert" parameterType="list" >
    insert into pm_plan_kpi (COMPANY_CODE, PRO_NO, 
      PRO_NAME, PLAN_NO, KPI_CODE, 
      KPI_VALUE, ATTACHED_VALUE, REPORT_DATE, STANDARD_HOURS,
      SYS_CREATE_TIME, SYS_UPDATE_TIME, SYS_DELETE_TIME, 
      SYS_PROCESS_FLAG, REMARKS)
    values 
    <foreach collection="list" item="item" separator="," close="" open="">
  		(#{item.companyCode,jdbcType=VARCHAR}, #{item.proNo,jdbcType=VARCHAR}, 
      #{item.proName,jdbcType=VARCHAR}, #{item.planNo,jdbcType=VARCHAR}, #{item.kpiCode,jdbcType=VARCHAR}, 
      #{item.kpiValue,jdbcType=REAL}, #{item.attachedValue,jdbcType=REAL}, now(), #{item.standardHours,jdbcType=REAL},
      now(), null, null, 
      1, #{item.remarks,jdbcType=VARCHAR})
	</foreach>
  </insert>
  
   <update id="batchUpdate" parameterType="list" >
    <foreach collection="list" item="item" separator=";" close="" open="">
  		update pm_plan_kpi 
  		set 
  			KPI_VALUE=#{item.kpiValue,jdbcType=REAL},
  			STANDARD_HOURS=#{item.standardHours,jdbcType=REAL}
  		where rowid = #{rowid,jdbcType=BIGINT}
	</foreach>
  </update>
  
  <delete id="deleteByProNoAndPlanNo" parameterType="map" >
    delete from pm_plan_kpi
    where pro_no = #{proNo,jdbcType=VARCHAR} and plan_no = #{planNo,jdbcType=VARCHAR} 
  </delete>
  
  <select id="findByProNoAndPlanNo" resultMap="BaseResultMap" parameterType="map">
    select 
    	a.rowid, a.COMPANY_CODE, a.PRO_NO, a.PRO_NAME, a.PLAN_NO, a.KPI_CODE, a.KPI_VALUE, a.ATTACHED_VALUE, a.STANDARD_HOURS,
    	a.REPORT_DATE, a.SYS_CREATE_TIME, a.SYS_UPDATE_TIME, a.SYS_DELETE_TIME, a.SYS_PROCESS_FLAG, 
    	a.REMARKS, b.is_per_cnt as isPerCnt, b.merge_flag as mergeFlag, b.item_label as itemLabel, b.kpi_type as kpiType
    from pm_plan_kpi a, pm_pro_kpi b
    where a.kpi_code = b.kpi_code and a.pro_no = #{proNo,jdbcType=VARCHAR} and a.plan_no = #{planNo,jdbcType=VARCHAR} 
  </select>
  
  
</mapper>