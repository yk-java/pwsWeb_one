<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.glens.pwCloudOs.pm.ticket.dao.TicketVoMapper" >
  <resultMap id="BaseResultMap" type="com.glens.pwCloudOs.pm.ticket.vo.TicketVo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="rowid" property="rowid" jdbcType="BIGINT" />
    <result column="COMPANY_CODE" property="companyCode" jdbcType="VARCHAR" />
    <result column="PRO_NO" property="proNo" jdbcType="VARCHAR" />
    <result column="PRO_NAME" property="proName" />
    <result column="WORKTICKET_DATE" property="workticketDate" jdbcType="VARCHAR" />
    <result column="WORKTICKET_NUMBER" property="workticketNumber" jdbcType="INTEGER" />
    <result column="START_NO" property="startNo" jdbcType="VARCHAR" />
    <result column="END_NO" property="endNo" />
    <result column="REMARKS" property="remarks" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
   rowid,COMPANY_CODE,PRO_NO,PRO_NAME,WORKTICKET_DATE,WORKTICKET_NUMBER,START_NO,END_NO,REMARKS
  </sql>
  
  <select id="queryForCount" parameterType="java.util.HashMap" resultType="int">
  	select count(*)
  	from PM_WORKTICKET b inner join pm_base d on b.pro_no=d.pro_no
   
  	where b.SYS_PROCESS_FLAG='1'
  	
  	<if test="proNo != null and proNo != ''">
    and b.PRO_NO=#{proNo}
    </if>
    <if test="fromDate != null and fromDate != ''">
    	and  b.WORKTICKET_DATE &gt;=#{fromDate}
    </if>
    <if test="toDate != null and toDate != ''">
    	and b.WORKTICKET_DATE &lt;=#{toDate}
    </if>
    
    <if test="deptCode != null and deptCode != ''">
		and d.MANAGE_DEPT=#{deptCode}
    </if>
    
  </select>
  
  <select id="queryForPage" parameterType="java.util.HashMap" resultMap="BaseResultMap">
  	select 
    	b.rowid,b.COMPANY_CODE,b.PRO_NO,b.PRO_NAME,b.WORKTICKET_DATE,b.WORKTICKET_NUMBER,b.START_NO,b.END_NO,b.REMARKS
    from PM_WORKTICKET b inner join pm_base d on b.pro_no=d.pro_no
   
  	where b.SYS_PROCESS_FLAG='1'
  	
  	<if test="proNo != null and proNo != ''">
    and b.PRO_NO=#{proNo}
    </if>
    <if test="fromDate != null and fromDate != ''">
    	and  b.WORKTICKET_DATE &gt;=#{fromDate}
    </if>
    <if test="toDate != null and toDate != ''">
    	and b.WORKTICKET_DATE &lt;=#{toDate}
    </if>
     <if test="deptCode != null and deptCode != ''">
		and d.MANAGE_DEPT=#{deptCode}
   	 </if>
    order by b.rowid desc
    
    
  	limit #{firstResult},#{maxResult}
  </select>
  
  <select id="findById" resultMap="BaseResultMap" parameterType="com.glens.pwCloudOs.pm.ticket.vo.TicketVo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from PM_WORKTICKET 
    where rowid = #{rowid}
  </select>
  <delete id="delete" parameterType="com.glens.pwCloudOs.pm.ticket.vo.TicketVo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from PM_WORKTICKET
    where rowid = #{rowid}
  </delete>
  <insert id="insert" parameterType="com.glens.pwCloudOs.pm.ticket.vo.TicketVo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
   insert into PM_WORKTICKET(COMPANY_CODE,PRO_NO,PRO_NAME,WORKTICKET_DATE,WORKTICKET_NUMBER,START_NO,END_NO,SYS_CREATE_TIME,SYS_PROCESS_FLAG,REMARKS)
	VALUES(#{companyCode},#{proNo},#{proName},#{workticketDate},#{workticketNumber},#{startNo},#{endNo},NOW(),'1',#{remarks});

  </insert>
  
  <select id="getNum" parameterType="map" resultType="map">
  	select COMPANY_CODE companyCode,WORKTICKET_COUNT workticketCount from PM_WORKTICKET_COUNT where COMPANY_CODE=#{companyCode}
  </select>
  
  <update id="updateNum" parameterType="map">
  		update PM_WORKTICKET_COUNT set WORKTICKET_COUNT=#{totalNum} where COMPANY_CODE=#{companyCode}
  </update>
  
  
  
</mapper>