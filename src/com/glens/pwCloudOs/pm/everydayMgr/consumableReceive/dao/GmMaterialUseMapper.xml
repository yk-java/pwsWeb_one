<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.glens.pwCloudOs.pm.everydayMgr.consumableReceive.dao.GmMaterialUseMapper" >
  <resultMap id="BaseResultMap" type="com.glens.pwCloudOs.pm.everydayMgr.consumableReceive.vo.GmMaterialUse" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="rowid" property="rowid" jdbcType="BIGINT" />
    <result column="MATERIAL_BATCHNO" property="materialBatchno" jdbcType="VARCHAR" />
    <result column="MATERIAL_NAME" property="materialName" jdbcType="VARCHAR" />
    <result column="LOAN_EMPLOYEECODE" property="loanEmployeecode" jdbcType="VARCHAR" />
    <result column="LOAN_EMPLOYEENAME" property="loanEmployeename" jdbcType="VARCHAR" />
    <result column="LOAN_UNIT_CODE" property="loanUnitCode" jdbcType="VARCHAR" />
    <result column="LOAN_UNIT_NAME" property="loanUnitName" jdbcType="VARCHAR" />
    <result column="LOAN_PRO_NO" property="loanProNo" jdbcType="VARCHAR" />
    <result column="LOAN_PRO_NAME" property="loanProName" jdbcType="VARCHAR" />
    <result column="USE_COUNT" property="useCount" jdbcType="INTEGER" />
    <result column="USE_DATE" property="useDate" jdbcType="DATE" />
    <result column="USE_DESC" property="useDesc" jdbcType="VARCHAR" />
    <result column="FLOW_STATUS" property="flowStatus" jdbcType="INTEGER" />
    <result column="SYS_CREATE_TIME" property="sysCreateTime" jdbcType="TIMESTAMP" />
    <result column="SYS_UPDATE_TIME" property="sysUpdateTime" jdbcType="TIMESTAMP" />
    <result column="SYS_DELETE_TIME" property="sysDeleteTime" jdbcType="TIMESTAMP" />
    <result column="SYS_PROCESS_FLAG" property="sysProcessFlag" jdbcType="CHAR" />
    <result column="REMARKS" property="remarks" jdbcType="VARCHAR" />
    <result column="ASSET_TYPE_NAME" property="assetTypeName" jdbcType="VARCHAR" />
    <result column="BRAND" property="brand" jdbcType="VARCHAR" />
    <result column="MODEL_NO" property="modelNo" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    rowid, MATERIAL_BATCHNO, LOAN_EMPLOYEECODE, LOAN_EMPLOYEENAME, LOAN_UNIT_CODE, LOAN_UNIT_NAME, 
    LOAN_PRO_NO, LOAN_PRO_NAME, USE_COUNT, USE_DATE, USE_DESC, FLOW_STATUS, SYS_CREATE_TIME, 
    SYS_UPDATE_TIME, SYS_DELETE_TIME, SYS_PROCESS_FLAG, REMARKS,  ASSET_TYPE_NAME, BRAND, MODEL_NO
  </sql>
  <select id="findById" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select t2.material_batchno, t2.material_name, t3.asset_type_name, t2.brand, t2.model_no, t1.*  
  	from gm_material_use t1 
	left join gm_material_base t2 on t2.material_batchno=t1.material_batchno
	left join gm_asset_type t3 on t3.asset_type_code = t2.asset_type_code
    where t1.rowid = #{rowid,jdbcType=BIGINT}
  </select>
  <delete id="delete" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from gm_material_use
    where rowid = #{rowid,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.glens.pwCloudOs.pm.everydayMgr.consumableReceive.vo.GmMaterialUse" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into gm_material_use (rowid, MATERIAL_BATCHNO, LOAN_EMPLOYEECODE, 
      LOAN_EMPLOYEENAME, LOAN_UNIT_CODE, LOAN_UNIT_NAME, 
      LOAN_PRO_NO, LOAN_PRO_NAME, USE_COUNT, 
      USE_DATE, USE_DESC, FLOW_STATUS, 
      SYS_CREATE_TIME, SYS_UPDATE_TIME, SYS_DELETE_TIME, 
      SYS_PROCESS_FLAG, REMARKS)
    values (#{rowid,jdbcType=BIGINT}, #{materialBatchno,jdbcType=VARCHAR}, #{loanEmployeecode,jdbcType=VARCHAR}, 
      #{loanEmployeename,jdbcType=VARCHAR}, #{loanUnitCode,jdbcType=VARCHAR}, #{loanUnitName,jdbcType=VARCHAR}, 
      #{loanProNo,jdbcType=VARCHAR}, #{loanProName,jdbcType=VARCHAR}, #{useCount,jdbcType=INTEGER}, 
      #{useDate,jdbcType=DATE}, #{useDesc,jdbcType=VARCHAR}, #{flowStatus,jdbcType=INTEGER}, 
      now(), #{sysUpdateTime,jdbcType=TIMESTAMP}, #{sysDeleteTime,jdbcType=TIMESTAMP}, 
      1, #{remarks,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.glens.pwCloudOs.pm.everydayMgr.consumableReceive.vo.GmMaterialUse" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into gm_material_use
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="rowid != null" >
        rowid,
      </if>
      <if test="materialBatchno != null" >
        MATERIAL_BATCHNO,
      </if>
      <if test="loanEmployeecode != null" >
        LOAN_EMPLOYEECODE,
      </if>
      <if test="loanEmployeename != null" >
        LOAN_EMPLOYEENAME,
      </if>
      <if test="loanUnitCode != null" >
        LOAN_UNIT_CODE,
      </if>
      <if test="loanUnitName != null" >
        LOAN_UNIT_NAME,
      </if>
      <if test="loanProNo != null" >
        LOAN_PRO_NO,
      </if>
      <if test="loanProName != null" >
        LOAN_PRO_NAME,
      </if>
      <if test="useCount != null" >
        USE_COUNT,
      </if>
      <if test="useDate != null" >
        USE_DATE,
      </if>
      <if test="useDesc != null" >
        USE_DESC,
      </if>
      <if test="flowStatus != null" >
        FLOW_STATUS,
      </if>
      <if test="sysCreateTime != null" >
        SYS_CREATE_TIME,
      </if>
      <if test="sysUpdateTime != null" >
        SYS_UPDATE_TIME,
      </if>
      <if test="sysDeleteTime != null" >
        SYS_DELETE_TIME,
      </if>
      <if test="sysProcessFlag != null" >
        SYS_PROCESS_FLAG,
      </if>
      <if test="remarks != null" >
        REMARKS,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="rowid != null" >
        #{rowid,jdbcType=BIGINT},
      </if>
      <if test="materialBatchno != null" >
        #{materialBatchno,jdbcType=VARCHAR},
      </if>
      <if test="loanEmployeecode != null" >
        #{loanEmployeecode,jdbcType=VARCHAR},
      </if>
      <if test="loanEmployeename != null" >
        #{loanEmployeename,jdbcType=VARCHAR},
      </if>
      <if test="loanUnitCode != null" >
        #{loanUnitCode,jdbcType=VARCHAR},
      </if>
      <if test="loanUnitName != null" >
        #{loanUnitName,jdbcType=VARCHAR},
      </if>
      <if test="loanProNo != null" >
        #{loanProNo,jdbcType=VARCHAR},
      </if>
      <if test="loanProName != null" >
        #{loanProName,jdbcType=VARCHAR},
      </if>
      <if test="useCount != null" >
        #{useCount,jdbcType=INTEGER},
      </if>
      <if test="useDate != null" >
        #{useDate,jdbcType=DATE},
      </if>
      <if test="useDesc != null" >
        #{useDesc,jdbcType=VARCHAR},
      </if>
      <if test="flowStatus != null" >
        #{flowStatus,jdbcType=INTEGER},
      </if>
      <if test="sysCreateTime != null" >
        #{sysCreateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="sysUpdateTime != null" >
        #{sysUpdateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="sysDeleteTime != null" >
        #{sysDeleteTime,jdbcType=TIMESTAMP},
      </if>
      <if test="sysProcessFlag != null" >
        #{sysProcessFlag,jdbcType=CHAR},
      </if>
      <if test="remarks != null" >
        #{remarks,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="update" parameterType="com.glens.pwCloudOs.pm.everydayMgr.consumableReceive.vo.GmMaterialUse" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update gm_material_use
    <set >
      <if test="materialBatchno != null" >
        MATERIAL_BATCHNO = #{materialBatchno,jdbcType=VARCHAR},
      </if>
      <if test="loanEmployeecode != null" >
        LOAN_EMPLOYEECODE = #{loanEmployeecode,jdbcType=VARCHAR},
      </if>
      <if test="loanEmployeename != null" >
        LOAN_EMPLOYEENAME = #{loanEmployeename,jdbcType=VARCHAR},
      </if>
      <if test="loanUnitCode != null" >
        LOAN_UNIT_CODE = #{loanUnitCode,jdbcType=VARCHAR},
      </if>
      <if test="loanUnitName != null" >
        LOAN_UNIT_NAME = #{loanUnitName,jdbcType=VARCHAR},
      </if>
      <if test="loanProNo != null" >
        LOAN_PRO_NO = #{loanProNo,jdbcType=VARCHAR},
      </if>
      <if test="loanProName != null" >
        LOAN_PRO_NAME = #{loanProName,jdbcType=VARCHAR},
      </if>
      <if test="useCount != null and useCount != 0 " >
        USE_COUNT = #{useCount,jdbcType=INTEGER},
      </if>
      <if test="useDate != null" >
        USE_DATE = #{useDate,jdbcType=DATE},
      </if>
      <if test="useDesc != null" >
        USE_DESC = #{useDesc,jdbcType=VARCHAR},
      </if>
      <if test="flowStatus != null" >
        FLOW_STATUS = #{flowStatus,jdbcType=INTEGER},
      </if>
      <if test="sysCreateTime != null" >
        SYS_CREATE_TIME = #{sysCreateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="sysUpdateTime != null" >
        SYS_UPDATE_TIME = #{sysUpdateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="sysDeleteTime != null" >
        SYS_DELETE_TIME = #{sysDeleteTime,jdbcType=TIMESTAMP},
      </if>
      <if test="sysProcessFlag != null" >
        SYS_PROCESS_FLAG = #{sysProcessFlag,jdbcType=CHAR},
      </if>
      <if test="remarks != null" >
        REMARKS = #{remarks,jdbcType=VARCHAR},
      </if>
    </set>
    where rowid = #{rowid,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.glens.pwCloudOs.pm.everydayMgr.consumableReceive.vo.GmMaterialUse" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update gm_material_use
    set MATERIAL_BATCHNO = #{materialBatchno,jdbcType=VARCHAR},
      LOAN_EMPLOYEECODE = #{loanEmployeecode,jdbcType=VARCHAR},
      LOAN_EMPLOYEENAME = #{loanEmployeename,jdbcType=VARCHAR},
      LOAN_UNIT_CODE = #{loanUnitCode,jdbcType=VARCHAR},
      LOAN_UNIT_NAME = #{loanUnitName,jdbcType=VARCHAR},
      LOAN_PRO_NO = #{loanProNo,jdbcType=VARCHAR},
      LOAN_PRO_NAME = #{loanProName,jdbcType=VARCHAR},
      USE_COUNT = #{useCount,jdbcType=INTEGER},
      USE_DATE = #{useDate,jdbcType=DATE},
      USE_DESC = #{useDesc,jdbcType=VARCHAR},
      FLOW_STATUS = #{flowStatus,jdbcType=INTEGER},
      SYS_CREATE_TIME = #{sysCreateTime,jdbcType=TIMESTAMP},
      SYS_UPDATE_TIME = #{sysUpdateTime,jdbcType=TIMESTAMP},
      SYS_DELETE_TIME = #{sysDeleteTime,jdbcType=TIMESTAMP},
      SYS_PROCESS_FLAG = #{sysProcessFlag,jdbcType=CHAR},
      REMARKS = #{remarks,jdbcType=VARCHAR}
    where rowid = #{rowid,jdbcType=BIGINT}
  </update>
  <select id="queryForList" resultMap="BaseResultMap" parameterType="map">
  	select * 
  	from gm_material_use
  </select>
<!--    <select id="queryForCount" parameterType="map" resultType="int"> -->
<!--   	select count(*) -->
<!--   	from gm_material_use t1 -->
<!--   	left join gm_material_base t2 on t1.MATERIAL_BATCHNO=t2.MATERIAL_BATCHNO -->
<!--   	where 1=1 -->
<!--   	<if test="loanProNo != null and loanProNo != ''"> -->
<!--   	and t1.LOAN_PRO_NO = #{loanProNo} -->
<!--   	</if> -->
<!--   	<if test="loanUnitCode != null and loanUnitCode != ''"> -->
<!--   	and t1.LOAN_UNIT_CODE like "%"#{loanUnitCode}"%" -->
<!--   	</if> -->
<!--   	<if test="loanEmployeename != null and loanEmployeename != ''"> -->
<!--   	and t1.LOAN_EMPLOYEENAME like "%"#{loanEmployeename}"%" -->
<!--   	</if> -->
<!--   </select> -->
  
<!--   <select id="queryForPage" parameterType="map" resultMap="BaseResultMap"> -->
<!--   	select t1.*, t2.MATERIAL_NAME -->
<!--   	from gm_material_use t1 -->
<!--   	left join gm_material_base t2 on t1.MATERIAL_BATCHNO=t2.MATERIAL_BATCHNO -->
<!--   	where 1=1 -->
<!--   	<if test="loanProNo != null and loanProNo != ''"> -->
<!--   	and t1.LOAN_PRO_NO = #{loanProNo} -->
<!--   	</if> -->
<!--   	<if test="loanUnitCode != null and loanUnitCode != ''"> -->
<!--   	and t1.LOAN_UNIT_CODE like "%"#{loanUnitCode}"%" -->
<!--   	</if> -->
<!--   	<if test="loanEmployeename != null and loanEmployeename != ''"> -->
<!--   	and t1.LOAN_EMPLOYEENAME like "%"#{loanEmployeename}"%" -->
<!--   	</if> -->
<!--   	order by t1.USE_DATE DESC -->
<!--   	limit #{firstResult},#{maxResult} -->
<!--   </select> -->
  
  <select id="queryForCount" parameterType="map" resultType="int">
  	select count(*)  
  	from gm_material_use t1 
	left join gm_material_base t2 on t2.material_batchno=t1.material_batchno
	left join gm_asset_type t3 on t3.asset_type_code = t2.asset_type_code
	left join gm_asset_class t31 on t31.asset_class_code = t3.asset_class_code 
	left join pm_base t4 on t4.pro_no = t1.loan_pro_no
	where 1=1
	<if test="assetClassCode != null and assetClassCode != ''">
  		and t3.asset_class_code = #{assetClassCode}
  	</if>
	<if test="loanProNo != null and loanProNo != ''">
  	and t1.LOAN_PRO_NO = #{loanProNo}
  	</if>
  	<if test="accountCode != null and accountCode != ''">
  	 and (t4.account_code = #{accountCode} or  t1.LOAN_EMPLOYEECODE=#{loanEmployeecode})
  	</if>
  	<if test="districtManager != null and districtManager != ''">
	and t4.DISTRICT_MANAGER=#{districtManager}
	</if>
	<if test="deptCode != null and deptCode != ''">
		and t4.MANAGE_DEPT=#{deptCode}
    </if>	
  </select>
  
  <select id="queryForPage" parameterType="map" resultMap="BaseResultMap">
  	select t2.material_batchno, t2.material_name, t3.asset_type_name, t2.brand, t2.model_no, t1.*  
  	from gm_material_use t1 
	left join gm_material_base t2 on t2.material_batchno=t1.material_batchno
	left join gm_asset_type t3 on t3.asset_type_code = t2.asset_type_code
	left join gm_asset_class t31 on t31.asset_class_code = t3.asset_class_code
	left join pm_base t4 on t4.pro_no = t1.loan_pro_no
	where 1=1
	
	<if test="assetClassCode != null and assetClassCode != ''">
  		and t3.asset_class_code = #{assetClassCode}
  	</if>
  	
	<if test="loanProNo != null and loanProNo != ''">
  	and t1.LOAN_PRO_NO = #{loanProNo}
  	</if>
  	
  	<if test="accountCode != null and accountCode != ''">
   	 and (t4.account_code = #{accountCode} or  t1.LOAN_EMPLOYEECODE=#{loanEmployeecode})
  	</if>
  	<if test="districtManager != null and districtManager != ''">
	and t4.DISTRICT_MANAGER=#{districtManager}
	</if>
	<if test="deptCode != null and deptCode != ''">
		and t4.MANAGE_DEPT=#{deptCode}
    </if>	
  	order by t1.use_date desc
  	limit #{firstResult},#{maxResult}
  </select>
  
  <update id="updateFlowStatus" parameterType="map" >
    <!--
      	项目管理部审批
    -->
    update gm_material_use
    set 
      <if test="flowStatus != null" >
      FLOW_STATUS = #{flowStatus,jdbcType=INTEGER},
      </if>
      SYS_UPDATE_TIME = now()
    where rowid = #{rowid,jdbcType=BIGINT}
  </update>
  <update id="updateMaterial" parameterType="map" >
    <!--
      	行政管理部审批
    -->
    update gm_material_use
    set 
      <if test="materialBatchno != null" >
      MATERIAL_BATCHNO = #{materialBatchno,jdbcType=VARCHAR},
      </if>
      SYS_UPDATE_TIME = now()
    where rowid = #{rowid,jdbcType=BIGINT}
  </update>
</mapper>