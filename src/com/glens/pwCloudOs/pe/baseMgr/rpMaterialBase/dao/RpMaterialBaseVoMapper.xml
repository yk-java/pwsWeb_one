<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.glens.pwCloudOs.pe.baseMgr.rpMaterialBase.dao.RpMaterialBaseVoMapper" >
  <resultMap id="BaseResultMap" type="com.glens.pwCloudOs.pe.baseMgr.rpMaterialBase.vo.RpMaterialBaseVo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <result column="MATERIAL_BATCHNO" property="materialBatchno" jdbcType="VARCHAR" />
    <result column="MATERIAL_NAME" property="materialName" jdbcType="VARCHAR" />
    <result column="MATERIALTYPE_CODE" property="materialtypeCode" jdbcType="VARCHAR" />
    <result column="MATERIALTYPE_NAME" property="materialtypeName" jdbcType="VARCHAR" />
    <result column="BRAND" property="brand" jdbcType="VARCHAR" />
    <result column="MODEL_NO" property="modelNo" jdbcType="VARCHAR" />
    <result column="PRICE1" property="price1" jdbcType="REAL" />
    <result column="PRICE2" property="price2" jdbcType="REAL" />
    <result column="TOTAL1" property="total1" jdbcType="REAL" />
    <result column="TOTAL2" property="total2" jdbcType="REAL" />
    <result column="BILL" property="bill" jdbcType="VARCHAR" />
    <result column="DATE_PURCHASE" property="datePurchase" />
    <result column="DATE_STORAGE" property="dateStorage" />
    <result column="COUNT_STORAGE" property="countStorage" />
    <result column="CURCOUNT_STORAGE" property="curcountStorage" />
    <result column="REMARKS" property="remarks" jdbcType="VARCHAR" />
    
  </resultMap>
  <sql id="Base_Column_List" >
 
   	  a.MATERIAL_BATCHNO, a.MATERIAL_NAME,a.MATERIALTYPE_CODE,m.MATERIALTYPE_NAME, a.PRICE1, a.PRICE2,a.TOTAL1,a.TOTAL2, a.BILL, DATE_FORMAT(a.DATE_PURCHASE,'%Y-%m-%d') DATE_PURCHASE, 
       DATE_FORMAT(a.DATE_STORAGE,'%Y-%m-%d') DATE_STORAGE,a.COUNT_STORAGE,a.CURCOUNT_STORAGE,a.REMARKS,
       a.BRAND,a.MODEL_NO 
       
  </sql>
  
  <select id="queryForCount" parameterType="java.util.HashMap" resultType="int">
  	select count(*) from PE_BS_RP_MATERIAL_BASE a
  	
  	where a.SYS_PROCESS_FLAG='1'
  	

  	<if test="materialName != null and materialName != ''">
  	and a.MATERIAL_NAME like "%"#{materialName}"%"
  	</if>
  	<if test="materialtypeCode != null and materialtypeCode != ''">
  	and a.MATERIALTYPE_CODE =#{materialtypeCode}
  	</if>
  	
  	
  </select>
  
  <select id="queryForPage" parameterType="java.util.HashMap" resultMap="BaseResultMap">
  	select 
    <include refid="Base_Column_List" />
    from PE_BS_RP_MATERIAL_BASE a
	left join PE_BS_RP_MATERIALTYPE m 
	on m.MATERIALTYPE_CODE=a.MATERIALTYPE_CODE
  	where a.SYS_PROCESS_FLAG='1'
  	
  	<if test="materialName != null and materialName != ''">
  	and a.MATERIAL_NAME like "%"#{materialName}"%"
  	</if>
  	<if test="materialtypeCode != null and materialtypeCode != ''">
  	and a.MATERIALTYPE_CODE =#{materialtypeCode}
  	</if>
  	limit #{firstResult},#{maxResult}
  </select>
  
  <select id="findById" resultMap="BaseResultMap" parameterType="com.glens.pwCloudOs.pe.baseMgr.rpMaterialBase.vo.RpMaterialBaseVo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from PE_BS_RP_MATERIAL_BASE a
	left join PE_BS_RP_MATERIALTYPE m 
	on m.MATERIALTYPE_CODE=a.MATERIALTYPE_CODE
  	where a.SYS_PROCESS_FLAG='1'
    and  a.MATERIAL_BATCHNO = #{materialBatchno}
  </select>
  <delete id="delete" parameterType="com.glens.pwCloudOs.pe.baseMgr.rpMaterialBase.vo.RpMaterialBaseVo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from PE_BS_RP_MATERIAL_BASE
    where MATERIAL_BATCHNO = #{materialBatchno}
  </delete>
  <insert id="insert" parameterType="com.glens.pwCloudOs.pe.baseMgr.rpMaterialBase.vo.RpMaterialBaseVo"  >
    
    insert into PE_BS_RP_MATERIAL_BASE
	(MATERIAL_BATCHNO, MATERIAL_NAME,MATERIALTYPE_CODE, BRAND, MODEL_NO, PRICE1, 
	PRICE2, TOTAL1, TOTAL2, BILL, DATE_PURCHASE, DATE_STORAGE, COUNT_STORAGE, CURCOUNT_STORAGE, 
	SYS_CREATE_TIME, SYS_PROCESS_FLAG, REMARKS)
	values
	(#{materialBatchno},#{materialName},#{materialtypeCode},#{brand}, #{modelNo}, #{price1}, 
	#{price2},#{total1}, #{total2}, #{bill},#{datePurchase}, #{dateStorage}, #{countStorage},#{curcountStorage}, 
	now(), '1', #{remarks})
  </insert>
  
  <update id="update" parameterType="com.glens.pwCloudOs.pe.baseMgr.rpMaterialBase.vo.RpMaterialBaseVo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update PE_BS_RP_MATERIAL_BASE
    <set >
      
      <if test="materialName != null" >
        MATERIAL_NAME = #{materialName,jdbcType=VARCHAR},
      </if>
      <if test="materialtypeCode != null" >
        MATERIALTYPE_CODE = #{materialtypeCode,jdbcType=VARCHAR},
      </if>
      
      <if test="brand != null" >
        BRAND = #{brand,jdbcType=VARCHAR},
      </if>
      
      
      <if test="modelNo != null" >
        MODEL_NO = #{modelNo,jdbcType=VARCHAR},
      </if>

      <if test="price1 != null" >
        PRICE1 = #{price1,jdbcType=REAL},
      </if>
      
      
      <if test="price2 != null" >
        PRICE2 = #{price2,jdbcType=REAL},
      </if>
      
      <if test="total1 != null " >
        TOTAL1 = #{total1,jdbcType=REAL},
      </if>
      
      <if test="total2 != null" >
        TOTAL2 = #{total2,jdbcType=REAL},
      </if>
      
      <if test="bill != null" >
        BILL = #{bill,jdbcType=VARCHAR},
      </if>

      <if test="datePurchase != null" >
        DATE_PURCHASE = #{datePurchase},
      </if>
      
      <if test="dateStorage != null" >
        DATE_STORAGE = #{dateStorage,jdbcType=VARCHAR},
      </if>
      
      
      <if test="countStorage != null" >
        COUNT_STORAGE = #{countStorage},
      </if>
      
      
      <if test="curcountStorage != null" >
        CURCOUNT_STORAGE = #{curcountStorage},
      </if>
      
      
      <if test="remarks != null" >
        REMARKS = #{remarks,jdbcType=VARCHAR},
      </if>
     
      SYS_UPDATE_TIME = now()
    </set>
    where MATERIAL_BATCHNO = #{materialBatchno}
  </update>
  
  <select id="getMaterialtype" resultType="map" parameterType="map" >
   
select MATERIALTYPE_CODE materialtypeCode,MATERIALTYPE_NAME materialtypeName
from PE_BS_RP_MATERIALTYPE where company_code=#{companyCode}
  </select>
 
  
</mapper>