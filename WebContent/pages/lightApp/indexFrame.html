<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Index</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<script src="js/jquery-1.9.1.min.js"></script>
<script src="js/jquery.cookie.js"></script>
<script src="js/util.js"></script>
<script src="js/native-lib.js"></script>
<style>
body{background:#f5f5f5;}
 #ifm1{height:100%;width:100%;border:0px;position: absolute;top:0px;bottom:0px;left:0px;right:0px;background:#fff;}
 #ifm2{height:100%;width:100%;border:0px;position: absolute;top:0px;bottom:0px;left:0px;right:0px;background:#fff;}
 .loading-layer{height:100%;width:100%;border:0px;position: absolute;top:0px;bottom:0px;left:0px;right:0px;z-index:10;background:rgba(60,60,60,0);text-align:center;}
 .loading-layer img{margin:0 auto;position:relative;top:50%;margin-top:-70px;}
 .loading-layer .progress-bar{position:relative;top:0;height:5px;line-height:5px;background:#ff9900;width:50%;}
</style>
</head>

<body>
	<iframe id="ifm1" src=""></iframe>
	<iframe id="ifm2" src=""></iframe>
	<div class="loading-layer">
<!-- 		<img id="loadPic"/> -->
		<img src="img/glens-loading.gif"/>
<!-- 		<div class="progress-bar"></div> -->
	</div>
	<script type="text/javascript">
	var urlParams = getUrlParams();
	var frontFrame = "ifm2";
	var afterFrame = "ifm1";
	var mode = "viewTo";
	
	function ifmLoad(){
		if(mode=="historyBack"){
			return;
		}
		$("#"+afterFrame)[0].style.zIndex=2;
		$("#"+frontFrame)[0].style.zIndex=1;

		var tmp = frontFrame;
		frontFrame = afterFrame;
		afterFrame = tmp;
		
		if(mode == "viewBack"){
			$("#"+afterFrame)[0].contentWindow.history.back();
			mode="historyBack";
		}
		
		lazyCall("hideTimer", function(){
			$(".loading-layer").hide();
//			stop();
		}, 200);
	}
	
	function viewTo(url, data){
		mode = "viewTo";
		var paramsStr = toUrlParams(data);
		if(url.indexOf("?")==-1){
			url+="?";
			url+=paramsStr;
		}else{
			url+="&"+paramsStr;
		}
		$("#"+afterFrame).attr("src", url);
// 		play();
		$(".loading-layer").show();
	}

	function viewBack(){
		mode = "viewBack";
		$("#"+afterFrame)[0].contentWindow.location.reload();
		$(".loading-layer").show();
	}

	function viewForward(){
		mode = "viewForward";
		$("#"+afterFrame)[0].window.history.forward();
// 		play();
		$(".loading-layer").show();
	}
	

	function appLoadComplate(){
		$("#"+afterFrame)[0].onload = ifmLoad;
		$("#"+frontFrame)[0].onload = ifmLoad;
		var params={};
		copyAndFilter(urlParams, params, ["page"]);
		var url = appendParams(urlParams.page, params);
		viewTo(url);
	}
	
	function copyAndFilter(obj, newObj, filterKeys){
		for(var k in obj){
			for(var i in filterKeys){
				var filterKey = filterKeys[i];
				if(filterKey==k){
					break;
				}else{
					newObj[k]=obj[k];
				}
			}
		}
	}
	
	
	//动画
	var i=1;
	var animationTimer=null;
	var op="stop";
	function play(){
		i=1;
		op="start";
		change();
	}
	function stop(){
		op="stop";
	}
	function change(){
		$("#loadPic")[0].src="img/glensLoading/loading-small_"+i+".png";
		i++;
		if(i==19){
			i=1;
		}
		if(op=="stop"){
			if(!animationTimer){
				clearTimeout(animationTimer);
			}
		}else{
			animationTimer=setTimeout("change()", 40);
		}
	}
	</script>
	
	
</body>
</html>