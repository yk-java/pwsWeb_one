<!DOCTYPE HTML>
<html>
<head>
<title> 设备管理 </title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<script type="text/javascript" src="../../../js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../../../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script></head>
<script type="text/javascript" src="../../../angular-1.4.6/angular.min.js"></script>
<script type="text/javascript" src="../../../js/PageBar.js"></script>
<script type="text/javascript" src="../../../js/DropDownList-1.2/DropDownList-v1.2.js"></script>
<link rel="stylesheet" type="text/css" href="../../../js/DropDownList-1.2/DropDownList.css"/>
<script type="text/javascript" src="../../../js/Calendar.js"></script>
<script type="text/javascript" src="../../../js/config.js"></script>
<script type="text/javascript" src="../../../js/util.js"></script>
<script type="text/javascript" src="../../../js/ng-base.js"></script>

<script type="text/javascript" src="../../../js/eapJs/core/eap.core.js" ></script>
<script type="text/javascript" src="../../../js/eapJs/plugins/eap.tip.js" ></script>
<script type="text/javascript" src="../../../js/eapJs/plugins/eap.validate.js"></script>
<script type="text/javascript" src="../../../js/eapJs/local/eap.lang-zh_CN.js"></script>
<link rel="stylesheet" type="text/css" href="../../../css/validate.css"/>
<link rel="stylesheet" type="text/css" href="../../../css/edit.css"/>

<script type="text/javascript" src="../../../js/showDlog/showDlog.js"></script>
<link rel="stylesheet" type="text/css" href="../../../js/showDlog/showDlog-blue.css" />
<script src="../../../js/jquery-photo-gallery/jquery.photo.gallery.js"></script>

<style type="text/css">
	.chooseUser{width:1000px;height:500px;}
	#lay1 .pdd_ta{width:800px;padding:1% 0;background:#f5f5f5;border-radius:5px;margin-bottom:20px;border:1px solid #ccc}
	#lay1 .pdd_ta table{width:100%;}
	#lay1 .pdd_ta table th{color:#77acf9;font-weight:bold;padding:0 20px 0;}
	#lay1 .pdd_ta table input{padding-left:10px;border:1px solid #ccc;height:30px;border-radius:3px;}
	.form_bottom{border-top:none;padding-top:0;}
	
	.imgs{
		width:800px;
	}
	.img{
		width:100px;
		height:120px;
		margin-left:10px;
		
	}
</style>
</head>

<body ng-app="moduleName" ng-controller="controllerName">

<div class="list">
	<div class="list_content">
		<div class="title_div">
			<div class="title_left">
				<label class="title">任务信息</label>
			</div>
			<img src="../../../img/list_Header2-.png">
			
			
			<div class="form_bottom">
			
			<a href="javascript:" ng-click="onCancel()" class="title_cancel">
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;返回
			</a>
		</div>
		</div>
		
		
		<form id="saveForm" class="required-validate">
		<div class="form_div" id="lay1">
			<div class="pdd_ta">
				<table>
					<tr>
						<th >任务名称</th>
						<td>
							<input type="hidden" name="companyCode" value="{{data.companyCode}}"/>
							
							<input type="text" name="taskName" value="{{data.taskName}}" class="readonly" readonly="readonly"/>
						</td>
						<th >任务编号</th>
						<td>
							<input type="text" name="taskCode" value="{{data.taskCode}}" class="readonly" readonly="readonly"/>
						</td>
					</tr>
					<tr>
						<th >项目</th>
						<td>
							
							<input type="text" name="taskName" value="{{data.proName}}" class="readonly" readonly="readonly"/>
						</td>
						<th >人员</th>
						<td>
							<input type="text" name="taskCode" value="{{data.employeeName}}" class="readonly" readonly="readonly"/>
						</td>
					</tr>
					<tr>
						<th >状态</th>
						
						
						<td>
							<input ng-if="data.taskStatus==1" type="text" name="taskStatus" value="已创建" class="readonly" readonly="readonly"/>
							<input ng-if="data.taskStatus==2" type="text" name="taskStatus" value="已派单" class="readonly" readonly="readonly"/>
							<input ng-if="data.taskStatus==3" type="text" name="taskStatus" value="已完成" class="readonly" readonly="readonly"/>
						</td>
						
						
						<th >超期</th>
						<td>
							<input ng-if="data.timeoutStatus==1" type="text" name="overdueStatus" value="期间内" class="readonly" readonly="readonly"/>
							<input ng-if="data.timeoutStatus==2" type="text" name="overdueStatus" value="告警" class="readonly" readonly="readonly"/>
							<input ng-if="data.timeoutStatus==3" type="text" name="overdueStatus" value="超期" class="readonly" readonly="readonly"/>
						</td>
					</tr>
					<tr>
						<th >任务处理状态</th>
						<td>
							
							<input ng-if="data.taskResultFlag==0" type="text" name="taskResultFlag" value="处理失败" class="readonly" readonly="readonly"/>
							<input ng-if="data.taskResultFlag==1" type="text" name="taskResultFlag" value="处理成功" class="readonly" readonly="readonly"/>
							<input ng-if="data.taskResultFlag==2" type="text" name="taskResultFlag" value="未处理" class="readonly" readonly="readonly"/>
						</td>
						<th >计划开始日期</th>
						<td>
							<input type="text" name="startTime1" value="{{data.startTime1}}" class="readonly" readonly="readonly"/>
						</td>
					</tr>
					<tr>
						<th >计划结束日期</th>
						<td>
							
							<input type="text" name="endTime1" value="{{data.endTime1}}" class="readonly" readonly="readonly"/>
						</td>
						<th >实际开始日期</th>
						<td>
							<input type="text" name="startTime2" value="{{data.startTime2}}" class="readonly" readonly="readonly"/>
						</td>
					</tr>
					<tr>
						<th >实际结束日期</th>
						<td>
							
							<input type="text" name="endTime2" value="{{data.endTime2}}" class="readonly" readonly="readonly"/>
						</td>
						<th >问题类别</th>
						<td>
							
							<input type="text" name="endTime2" value="{{data.FAULT_TYPE}}" class="readonly" readonly="readonly"/>
						</td>
					</tr>
					<tr>
						<th >问题描述</th>
						<td>
							
							<input type="text" name="endTime2" value="{{data.faultDesc}}" class="readonly" readonly="readonly"/>
						</td>
						
					</tr>
				</table>
			</div>
			<div class="pdd_ta">
				<table>
				<tr ng-repeat="tr in deviceAttrTrs track by $index">
					<th ng-repeat-start="item in tr track by $index">{{item.cname}}</th>
					<td ng-repeat-end>
					<div>
					<input ng-if="item" type="text" group="cond" name="{{item.ename}}" value="{{data[item.ename]}}" class="readonly" readonly="readonly" />
					</div>
					
				</tr>
				
			</table>
			</div>
			
			<div class="imgs gallerys" style="margin-top:40px;">
				      <span style="font-size:14px;">图片列表</span>
				   <hr style="height:1px;border:none;border-top:1px solid #ccc;" />
				   <img src="" title="放大" style="cursor:url(../../../img/big.png), pointer" class="img gallery-pic" id="img1" onerror="javascript:this.src='../../../img/defaultImg.png'"  ng-click="showdiv('img1',data.HOUSEHOLD_ADDR)"  />
				   <img src="" title="放大" style="cursor:url(../../../img/big.png), pointer" class="img gallery-pic" id="img2" onerror="javascript:this.src='../../../img/defaultImg.png'" ng-click="showdiv('img2',data.HOUSEHOLD_ADDR)" />
				   <img src="" title="放大" style="cursor:url(../../../img/big.png), pointer" class="img gallery-pic" id="img3" onerror="javascript:this.src='../../../img/defaultImg.png'" ng-click="showdiv('img3',data.HOUSEHOLD_ADDR)"/>
			</div>
		</div>
		
		</form>
	</div>
</div>
<script type="text/javascript">
simpleController({
	init:function($scope, $http){
		$scope.data={};
		var urlParams = getUrlParams();
		
		$scope.deviceAttrList=[];
		$scope.deviceAttrTrs=[];
		/* 加载属性信息 */
		$scope.loadAttrs=function(){
			$scope.httpGet({
				url:"eap/pmsServices/om/deviceMgr/device/mctListAttr1?companyCode="+$scope.userData.companyCode,
				data:{"deviceTypeCode":"P02"},
				success:function(response){
					
					$scope.deviceAttrList = response.data.listFields;
					//alert(response.data.listFields)
					$scope.deviceAttrTrs=$scope.splitToTr($scope.deviceAttrList);
					
					
				}
			});
		};
		$scope.loadDeviceInfo=function(taskCode){
			$scope.httpGet({
				url:"eap/pmsServices/pm/taskMgr/task/getTask?companyCode="+$scope.userData.companyCode,
				data:{"taskCode":taskCode},
				success:function(response){
					$scope.data = response.data;
					
					
					//alert(response.data.pic1)
					
					if(response.data.pic1){
						var st1=filePath+"?fileCode="+response.data.pic1+"&attachment=0";
						$("#img1").attr("src",st1);
					}
					if(response.data.pic2){
						var st2=filePath+"?fileCode="+response.data.pic2+"&attachment=0";
						$("#img2").attr("src",st2);
					}if(response.data.pic3){
						var st3=filePath+"?fileCode="+response.data.pic3+"&attachment=0";
						$("#img3").attr("src",st3);
					}
					
					
					
								
					
					
					
					
					$scope.imgList = response.list;
					
					$scope.loadAttrs();
					//healthList.setConfig("url", "../../../component/chooseDeviceHealth.html?proNo="+$scope.data.proNo+"&required=true");
					//problemList.setConfig("url", "../../../component/chooseDeviceProblem.html?proNo="+$scope.data.proNo+"&required=true");
				}
			});
		};
		$scope.loadDeviceInfo(urlParams.taskCode);
		
		$scope.showdiv=function(str,title){
			 var img=$("#"+str);
			$.openPhotoGallery(img1,"../../../js/jquery-photo-gallery/gallery.html?picTitle="+title)
		};
		
		/* 组织tr数据 */
		$scope.splitToTr=function(arr){
			var trs=[];
			for(var i=0; i<arr.length; i++){
				var attr = arr[i];
				if(i!=0 && i%2==0){
					trs.push([]);
				}
				if(trs.length==0){
					trs.push([]);
				}
				var tr=trs[trs.length-1];
				tr.push(attr);
			}
			var lastTr=trs[trs.length-1];
			if(lastTr.length<2){
				lastTr.push({});
			}
			return trs;
		};
		
		var urlParams = getUrlParams();
		//$("input[name=rowid]").val(urlParams.rowid);
		
		
		
		
		
		
		/* 表单验证 */
		validator = $("#saveForm").validate({
			onsubmit: false,
			focusInvalid: false,
			focusCleanup: true,
			errorElement: "span",
			ignore:".ignore",
			invalidHandler: function(form, validator) {
				var errors = validator.numberOfInvalids();
				if (errors) {
					
				} 
			}
		});
		
	
		/* 取消 */
		$scope.onCancel=function(){
			hrefTo({
				url:"taster.html",
				data:urlParams
			});
		};
	
	}
});
</script>
</body>
</html>
