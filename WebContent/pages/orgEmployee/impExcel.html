<!DOCTYPE HTML>
<html>
<head>
<title> 设备管理 </title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<script type="text/javascript" src="../../js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../../js/jquery.form.js"></script>
<script type="text/javascript" src="../../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script></head>
<script type="text/javascript" src="../../angular-1.4.6/angular.min.js"></script>
<script type="text/javascript" src="../../js/PageBar.js"></script>
<script type="text/javascript" src="../../js/DropDownList-1.2/DropDownList-v1.2.js"></script>
<link rel="stylesheet" type="text/css" href="../../js/DropDownList-1.2/DropDownList.css"/>
<script type="text/javascript" src="../../js/Calendar.js"></script>
<script type="text/javascript" src="../../js/config.js"></script>
<script type="text/javascript" src="../../js/util.js"></script>
<script type="text/javascript" src="../../js/ng-base.js"></script>

<script type="text/javascript" src="../../js/eapJs/core/eap.core.js" ></script>
<script type="text/javascript" src="../../js/eapJs/plugins/eap.tip.js" ></script>
<script type="text/javascript" src="../../js/eapJs/plugins/eap.validate.js"></script>
<script type="text/javascript" src="../../js/eapJs/local/eap.lang-zh_CN.js"></script>
<link rel="stylesheet" type="text/css" href="../../css/validate.css"/>
<link rel="stylesheet" type="text/css" href="../../css/edit.css"/>

<script type="text/javascript" src="../../js/showDlog/showDlog.js"></script>
<link rel="stylesheet" type="text/css" href="../../js/showDlog/showDlog-blue.css" />

<style type="text/css">
	.chooseUser{width:1000px;height:500px;}
	#lay1 .pdd_ta{width:800px;padding:1% 0;background:#f5f5f5;border-radius:5px;margin-bottom:20px;border:1px solid #ccc}
	#lay1 .pdd_ta table{width:100%;}
	#lay1 .pdd_ta table th{color:#77acf9;font-weight:bold;padding:0 20px 0;}
	#lay1 .pdd_ta table input{padding-left:10px;border:1px solid #ccc;height:30px;border-radius:3px;}
	.form_bottom{border-top:none;padding-top:0;}
</style>
</head>

<body>

<div class="list">
	<div class="list_content">
		<div class="title_div">
			<div class="title_left">
				<label class="title">请选择数据文件</label>
			</div>
			<img src="../../img/list_Header2-.png">
		</div>
		<form id="saveForm" method="post" enctype="multipart/form-data" 
			class="required-validate">
			<br>
			<br>
			<table>
				<tr>
					<td>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input id="excelFile" type="file" name="excelFile"/>
						
						<input type="hidden" name="proNo" />
						<input type="hidden" name="proName" />
						<input type="hidden" name="categoryName" />
						<input type="hidden" name="companyCode" />
						<input type="hidden" name="categoryCode" />
					</td>
				</tr>
			</table>
			<br>
			<br>
			<div class="form_bottom">
				<a href="javascript:" onclick="doUpload()" class="title_save">
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;保存
				</a>
				<a href="javascript:" onclick="onCancel()" class="title_cancel">
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;取消
				</a>
			</div>
		</form>
	</div>
</div>
</body>
<script type="text/javascript">

$(function(){
	var params=getUrlParams();
	
	$("input[name=proNo]").val(params.proNo);
	$("input[name=proName]").val(params.proName);
	$("input[name=categoryName]").val(params.cond_categoryName);
	$("input[name=categoryCode]").val(params.cond_categoryCode);
	$("input[name=companyCode]").val(params.companyCode);
	
})



function doUpload(){
	var excelFile = $("#excelFile")[0].value;
	if(!excelFile && excelFile.length==0){
		new ShowDlog().prompt({
			msg:"请先选择文件",
			t:1500
		});
		return;
	}
	var beginIdx = excelFile.lastIndexOf(".");
	if(beginIdx==-1){
		new ShowDlog().prompt({
			msg:"文件格式不正确（仅支持.xls .xlsx）",
			t:1500
		});
		return;
	}
	var postfix = excelFile.substring(beginIdx+1);	
	if(!/^(xls|xlsx)$/g.test(postfix)){
		new ShowDlog().prompt({
			msg:"文件格式不正确（仅支持.xls .xlsx）",
			t:1500
		});
		return;
	}
	//$("#saveForm").attr("action", serviceBasePath+"eap/pmsServices/pm/taskMgr/task/importExcel");
	new ShowDlog().prompt({
		icon:"waitting",
		msg:"正在上传...",
		t:120000
	});
	$("#saveForm").ajaxSubmit({
		url:serviceBasePath+"eap/pmsServices/sys/orgEmployee/employee/importExcel",
		type: "post",               //默认是form的method（get or post），如果申明，则会覆盖  
		dataType: "json",           //html(默认), xml, script, json...接受服务端返回的类型  
		clearForm: false,          //成功提交后，清除所有表单元素的值
		success: function(responseText, statusText) {
			if(responseText.statusCode==200){
				$dlog.close();
				
				
				
				new ShowDlog().prompt({
					icon:"success",
					msg:responseText.resultMsg,
					done:function(){
						parent.$dlog.data="SUCCESS";
						parent.$dlog.close();
					},
					t:1500
				});
			
			}else{
				$dlog.close();
				new ShowDlog().prompt({
					icon:"error",
					msg:"上传失败！",
					t:1500
				});
			}
		},      //提交后的回调函数   
		error: function(xhr, status, error) {
			console.log(error);
		}
	});
}
function onCancel(){
	parent.$dlog.close();
}
</script>
</html>