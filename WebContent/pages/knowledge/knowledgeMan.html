<!DOCTYPE HTML>
<html ng-app="orgMgr">
<head>
<title> 组织架构管理</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">

<link rel="stylesheet" type="text/css" href="../../bootstrap-3.3.5-dist/css/bootstrap.min.css"/>

<link rel="stylesheet" href="../../css/zTreeStyle/zTreeStyle.css" type="text/css">
<script type="text/javascript" src="../../js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../js/jquery.ztree.core-3.5.js"></script>
<script type="text/javascript" src="../../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script></head>
<script type="text/javascript" src="../../angular-1.4.6/angular.min.js"></script>
<script type="text/javascript" src="../../js/PageBar.js"></script>
<script type="text/javascript" src="../../js/config.js"></script>
<script type="text/javascript" src="../../js/util.js"></script>
<script type="text/javascript" src="../../js/ng-base.js"></script>

<script type="text/javascript" src="../../js/showDlog/showDlog.js"></script>
<link rel="stylesheet" type="text/css" href="../../js/showDlog/showDlog-blue.css" />

<link rel="stylesheet" type="text/css" href="../../css/list.css"/>
<style type="text/css">

	.list .list_left{position: absolute;left:0px;top:0px;bottom:0px;width:220px;background:#E5F0FF;}
	.list .list_left .left_title{width:100%;height:30px;background:#3385FF;line-height:30px;color:#fff;border-bottom:solid 1px #4CA9FF;}
	.list .list_left .left_operation{width:100%;height:30px;background:#3385FF;line-height:30px;color:#fff;}
	.list .list_left .left_operation .operation1{height:30px;width:72px;border-right:solid 1px #4CA9FF;line-height:28px;text-align: center;color:#fff;float:left;cursor: pointer;}
	.list .list_left .left_operation .operation1 > a{color:#fff;vertical-align: middle;}
	.list .list_left .left_operation .operation2{height:30px;width:72px;line-height:28px;text-align: center;color:#fff;float:left;cursor: pointer;}
	.list .list_left .left_operation .operation2 > a{color:#fff;vertical-align: middle;}
	.list .list_left .left_tree{position: absolute;left:0px;right:0px;bottom:0px;top:30px;border:solid 0px;overflow: auto;}
	.list .list_content{position: absolute;left:230px;right:0px;top:0px;bottom:0px;border:solid 0px;}
	.list .list_content .title_div{width:100%;height:39px;border-bottom:solid 3px #3385FF;}
	.list .list_content .title_div .title_left{min-width:250px;height:39px;background:#3385FF;line-height:42px;color:#fff;font-size:14px;font-weight: bold;float:left;}
	.list .list_content .title_div > img{float:left;margin-top:1px;}
	.list .list_content .title_div .title_add{float:left;width:70px;height:28px;background: url(../../img/bnt_newly-added.png) repeat;line-height:28px;text-align:center;margin-left:30px;margin-top:5px;color:#fff;cursor: pointer;}
	.list .list_content .table_div{left:0px;right:0px;bottom:32px;top:42px;border:solid 0px;}

	.ztree span{font-family:微软雅黑;}

.edit-deptment{width:800px;height:450px;}
</style>

<body ng-controller="orgMgr">

<div class="list">
	<div class="list_left">
		<div class="left_title">
			&nbsp;&nbsp;知识目录架构树
		</div>
		<div class="left_tree">
			<ul id="treeDemo" class="ztree">
					
			</ul>
		</div>
	</div>
	<div class="list_content">
		<div class="title_div">
			<div class="title_left">
				&nbsp;&nbsp;&nbsp;&nbsp;{{name}}
			</div>
			<img src="../../img/list_Header-.png">
			<div class="title_add" ng-click="doAdd()">
 				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;新增  
 			</div>
		</div>
		
		<div class="table_div">
			<table width="100%" border="0" cellspacing="0" cellpadding="0" class="table">
			   <tr class="tr1">
				<th ><div align="center">序号</div></th>
				<th ><div align="center">文档名称</div></th>
				<th ><div align="center">关键字</div></th>
				<th ><div align="center">目录</div></th>
				<th ><div align="center">作者</div></th>
				<th ><div align="center">时间</div></th>
				<th ><div align="center">阅读次数</div></th>
				
				<th><div align="center">状态</div></th>
				<th ><div align="center">操作</div></th>
			  </tr>
			  <tr class="tr2" ng-repeat="item in dataList">
				<td><div align="center">{{$index+1}}</div></td>
				<td><div align="center">{{item.fileTitle}}</div></td>
				<td><div align="center">{{item.keywords}}</div></td>
				<td><div align="center">{{item.catalogName}}</div></td>
				<td><div align="center">{{item.employeeName}}</div></td>
				<td><div align="center">{{item.sysCreateTime}}</div></td>
				<td><div align="center">{{item.readCnt}}</div></td>
				
				<td>
					<div align="center" ng-if="item.publishStatus==1">创建</div>
					<div align="center" ng-if="item.publishStatus==2">发布</div>
					<div align="center" ng-if="item.publishStatus==3">收回</div>
				</td>
				<td>
					<div align="center">
						<a class="operationImg" ng-click="doEdit(item)" style="color:#3385ff">[ 修 改 ]</a>
						<a class="operationImg" ng-click="fabu(item)" ng-if="item.publishStatus==1" style="color:#3385ff">[ 发 布 ]</a>
						<a class="operationImg" ng-click="shouhui(item)" ng-if="item.publishStatus==2" style="color:#3385ff">[ 收 回 ]</a>
						<a class="operationImg" ng-click="doShow(item)" style="color:#3385ff">[ 查 看 ]</a>
						<a class="operationImg" ng-click="doDel(item)" style="color:#3385ff">[ 删 除 ]</a>
						<!-- <img class="operationImg" ng-click="doEdit(item)" src="../../img/list_item_modify-icon.png" title="修改 ">
						<img class="operationImg" ng-click="fabu(item)" ng-if="item.publishStatus==1" src="../../img/fabu-icon.png" title="发布 ">
						<img class="operationImg" ng-click="shouhui(item)" ng-if="item.publishStatus==2" src="../../img/chehui-icon.png" title="收回 ">
						<img class="operationImg" ng-click="doShow(item)" src="../../img/list_see-icon.png" title="查看正文 ">
						<img class="operationImg" ng-click="doDel(item)" src="../../img/list_delete-icon.png"> -->
		    		</div>
		    	</td>
			  </tr>
			</table>
		</div>

		<div id="page_bar" class="list_bottom" align="center">
		</div>

	</div>
</div>

<script type="text/javascript">
var  ngScope;
function createPageBar(totalPage, curPage, totalRecord){
	new PageBar().init({
		renderTo:"#page_bar",
		totalPage:totalPage,
		totalRecord: totalRecord,
		showPageInfo: true,
		curPage:curPage,
		prevPageText:"上一页",
		nextPageText:"下一页",
		onPage:function(pageNum){
			_currentPage=pageNum;
			
			
			ngScope.getList(catalogCode,_currentPage);
		}
	});
}


var _currentPage=1;
var catalogCode="";
var parentCatalogCode="";
var app = simpleController({
	moduleName:"orgMgr",
	controllerName:"orgMgr",
	init:function($scope, $http){
	
		var orgTree;
		ngScope=$scope;
		$scope.name="知识目录管理";
		$scope.dataList=[];
		var setting = {
			data: {
				simpleData: {
					enable: true
				}
			},
			callback:{
				onClick:function(){
					var selectedNodes = orgTree.getSelectedNodes();
					//alert(selectedNodes)
					var name=selectedNodes[0].name;
					$scope.name=name;
					catalogCode=selectedNodes[0].id;
					$scope.getList(catalogCode,1);
				}
			}
		};
		$scope.httpGet({
			url:"eap/pmsServices/km/catalog/catalog/getTreeList",
			data:{"companyCode":$scope.userData.companyCode},
			success:function(res){
				zNodes = res.list;
				orgTree=$.fn.zTree.init($("#treeDemo"), setting, zNodes);
				//$scope.userList = res.list;
				$scope.getList("",_currentPage);
			}
		});
		$scope.getList=function(catalogCode,currentPage){
			$scope.httpGet({
				url:"eap/pmsServices/km/kmbase/kmbase/list",
				data:{"companyCode":$scope.userData.companyCode,"catalogCode":catalogCode,"currentPage":currentPage},
				success:function(res){
					$scope.dataList=res.list;
					createPageBar(res.totalPage, res.currentPage,res.totalRecord);
					//alert(res.list.length)
				}
			});
		};
		
		/*table删除目录信息 */
		 $scope.doDel=function(obj){
			new ShowDlog().confirm({
				msg:"确定删除文档（"+obj.fileTitle+"）？",
				ok:function(){
					$scope.httpPost({
						url:"eap/pmsServices/km/kmbase/kmbase/delete",
						data:{companyCode:$scope.userData.companyCode,fileCode:obj.fileCode,rowid:obj.rowid},
						success:function(res){
							new ShowDlog().prompt({msg:"删除成功！",
								done:function(){
									//location.href="knowledgeMan.html";
								},
								t:1500
							});

							$scope.getList(catalogCode,_currentPage);
						}
					});
				}
			});
		}; 
		
		 $scope.fabu=function(obj){
				new ShowDlog().confirm({
					msg:"确定发布文档（"+obj.fileTitle+"）？",
					ok:function(){
						$scope.httpPost({
							url:"eap/pmsServices/km/kmbase/kmbase/updatePublishStatus",
							data:{companyCode:$scope.userData.companyCode,fileCode:obj.fileCode,publishStatus:2,rowid:obj.rowid,fileTitle:obj.fileTitle,btext:obj.btext,keywords:obj.keywords,catalogName:obj.catalogName,sysCreateTime:obj.sysCreateTime,employeeName:obj.employeeName,remarks:obj.remarks},
							success:function(res){
								new ShowDlog().prompt({msg:"发布成功！",
									done:function(){
										//location.href="knowledgeMan.html";
										$scope.getList(catalogCode,_currentPage);
									},
									t:1500
								});

								
							}
						});
					}
				});
			}; 
		
			 $scope.shouhui=function(obj){
					new ShowDlog().confirm({
						msg:"确定收回文档（"+obj.fileTitle+"）？",
						ok:function(){
							$scope.httpPost({
								url:"eap/pmsServices/km/kmbase/kmbase/updatePublishStatus",
								data:{companyCode:$scope.userData.companyCode,fileCode:obj.fileCode,publishStatus:3,rowid:obj.rowid,fileTitle:obj.fileTitle,btext:obj.btext,keywords:obj.keywords,catalogName:obj.catalogName,sysCreateTime:obj.sysCreateTime,employeeName:obj.employeeName,remarks:obj.remarks},
								success:function(res){
									new ShowDlog().prompt({msg:"收回成功！",
										done:function(){
											//location.href="knowledgeMan.html";
											$scope.getList(catalogCode,_currentPage);
										},
										t:1500
									});
								}
							});
						}
					});
				}; 
		
		
		$scope.doAdd=function(){
			location.href="addkldoc.html";
		};
		
		$scope.doEdit=function(obj){
			location.href="Editkldoc.html?rowid="+obj.rowid+"&companyCode="+$scope.userData.companyCode+"&fileCode="+obj.fileCode;
		};
		
		$scope.doShow=function(obj){
			location.href="knowcon.html?rowid="+obj.rowid+"&companyCode="+$scope.userData.companyCode+"&fileCode="+obj.fileCode;
		}
	}
});

	
</script>
</body>
</html>
