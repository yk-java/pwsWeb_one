<!DOCTYPE html>
<html ng-app="orgMgr">
	<head>
		<meta charset="UTF-8">
		<title></title>
		
		<link rel="stylesheet" type="text/css" href="../../bootstrap-3.3.5-dist/css/bootstrap.min.css"/>
		
		<link rel="stylesheet" href="../../css/zTreeStyle/zTreeStyle.css" type="text/css">
		<script type="text/javascript" src="../../js/jquery-1.9.1.min.js"></script>
		<script type="text/javascript" src="../../js/jquery.cookie.js"></script>
		<script type="text/javascript" src="../../js/jquery.ztree.core-3.5.js"></script>
		<script type="text/javascript" src="../../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script></head>
		<script type="text/javascript" src="../../angular-1.4.6/angular.min.js"></script>
		<script type="text/javascript" src="../../js/PageBar.js"></script>
		<script type="text/javascript" src="../../js/config.js"></script>
		<script type="text/javascript" src="../../js/util.js"></script>
		<script type="text/javascript" src="../../js/ng-base.js"></script>
		
		<script type="text/javascript" src="../../js/showDlog/showDlog.js"></script>
		<link rel="stylesheet" type="text/css" href="../../js/showDlog/showDlog-blue.css" />
		
		<link rel="stylesheet" type="text/css" href="../../css/list.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/knowledge/knowledge.css"/>
		<style>
			.fj_cz{color:#008FF5;margin-left:10px;cursor:pointer}
			.knowcon_title{text-align: center;color:#666}
			.message{font-size:14px;text-align: center;color:#8F8F8F}
		</style>
	</head>
	<body ng-controller="orgMgr">
		<div class="knowcon" style="padding-bottom:50px">
			<div class="knowcon_title">{{kmbaseData.fileTitle}}<span class="fr return">返回</span></div>
			
			<div class="message">
				发布人：{{kmbaseData.employeeName}} &nbsp;&nbsp;&nbsp;
				目录：{{kmbaseData.catalogName}}&nbsp;&nbsp;&nbsp;
				发布日期：{{kmbaseData.sysCreateTime}}
			</div>
			<div class="knowcon_tip">
				<div id="btext" class="knowcon_word">
					
				</div>
			</div>
		</div>
	</body>
	<script>
		function getUrlParams(){
			var params={};
			var url = location.href;
			var start = url.indexOf("?", 0)+1;
			var paramsStr = url.substring(start, url.length);
			var paramsArr = paramsStr.split("&");
			for(var i=0;i<paramsArr.length;i++){
				var kv = paramsArr[i].split("=");
				var k = kv[0];
				var v = kv[1];
				params[k]=v;
			}
			return params;
		}
		var app = simpleController({
			moduleName:"orgMgr",
			controllerName:"orgMgr",
			init:function($scope, $http){
				
				$scope.kmbaseData={};
				var userDataStr = $.cookie("pmsWeb_user_data");
				if(!userDataStr){
					
					noLogin(location.href);
					return;
				}
				var userData = jQuery.parseJSON(userDataStr);
				ticket = $.cookie("pmsWeb_ticket");
				var params = getUrlParams();
				
				
				$scope.httpGet({
					url:"eap/pmsServices/km/kmbase/kmbase/get",
					data:{"companyCode":params.companyCode,"rowid":params.rowid,"fileCode":params.fileCode,"employeeCode":userData.employeeCode,"employeeName":userData.employeeName},
					success:function(res){
						$scope.kmbaseData=res.data.vo;
						$scope.attachmentList=res.data.attachmentList;
						
					 	 var btext = res.data.vo.btext;
					 	
					 	  $("#btext").append(btext);
						 
					}
				});
				
				//在线阅读
				$scope.readonline=function(fj_att,fileType,fileUrl){
					location.href="kownfileDetail.html?dlurl="+fj_att+"&fileType="+fileType+"&employeeCode="+$scope.userData.employeeCode+"&fileUrl="+fileUrl+"&fileCode="+params.fileCode;
				};

				
				
				/* 下载 */
				$scope.downFile=function(fj_atturl){
					 $scope.httpGet({
						url:"eap/pmsServices/km/kmbase/kmbase/insertDownStudy?employeeCode="+$scope.userData.employeeCode+"&fileUrl="+fj_atturl+"&fileCode="+params.fileCode,
						success:function(res){
							
							 
						}
					});
					
					location.href=filePath+"?fileCode="+fj_atturl+"&attachment=1"; 
				};
				
				
				$(".return").click(function(){
					if(params.status=="1"){
						location.href="knowledge.html?data="+params.data;
					}else{
						window.history.back();
					}
					
				});
			}
		
		});

	
	
	
		
		
		
		 var ws = null;
	        function connect() {
	            if ('WebSocket' in window) {
	                ws= new WebSocket("ws://192.168.1.97:8080/pmsWeb/eap/websocket");
	            }
	            else 
	            {
	                ws = new SockJS(serviceBasePath+"/eap/websocket");
	            }
	            
	            ws.onopen = function () {
	                 var obj={
	                	fileCode:'F20161010180239442216',
	                	employeecode:'100',
	                	type:'1'
	                };
	                ws.send(JSON.stringify(obj));
	            };
	            
	        }
	</script>
</html>
