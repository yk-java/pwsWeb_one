<!DOCTYPE HTML>
<html  ng-app="mapPosition">
<head>
<title> 定位 </title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<script type="text/javascript" src="../../../js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../../../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=PL4wfqVofjrMVz7FMaPs8Dts"></script>
<script type="text/javascript" src="../../../angular-1.4.6/angular.min.js"></script>
<script type="text/javascript" src="../../../js/PageBar.js"></script>
<script type="text/javascript" src="../../../js/util.js"></script>
<script type="text/javascript" src="../../../js/config.js"></script>
<script type="text/javascript" src="../../../js/ng-base.js"></script>
<script type="text/javascript" src="../../../js/eapJs/core/eap.core.js" ></script>
<script type="text/javascript" src="../../../js/eapJs/plugins/eap.tip.js" ></script>
<script type="text/javascript" src="../../../js/eapJs/plugins/eap.validate.js"></script>
<script type="text/javascript" src="../../../js/eapJs/local/eap.lang-zh_CN.js"></script> 
<link rel="stylesheet" type="text/css" href="../../../css/edit.css"/>
<link rel="stylesheet" type="text/css" href="../../../css/common.css"/>
<script type="text/javascript" src="../../../js/showDlog/showDlog.js"></script>
<link rel="stylesheet" type="text/css" href="../../../js/showDlog/showDlog-blue.css" />
 
<style type="text/css">
	body{
		margin:0px;
		padding:0px;
		font-size:12px;
		font-family:"微软雅黑";
	}
	.list .map_div{height:100%;border:solid 1px #cccccc;}
 </style>
</head>

<body  ng-controller="mapPositionCtrl" >
<div class="list">
	<div class="list_content">
		<div class="title_div">
			<div class="title_left">
				<label class="title">变电站定位</label>
			</div>
			<img src="../../../img/list_Header2-.png">
			 <a href="javascript:" ng-click="onCancel()" class="title_cancel">
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;返回
			</a>
		</div>
		<div class="map_div" id="allmap">
			
		</div>
	</div>
</div>
<script type="text/javascript">
 
 addComplexInfoWindow=function(map,marker,info) {	
			var sContent = "<table style='border-collapse:collapse;padding-left:4px'>";
			for(var item in info){
				sContent +="<tr><td width='100' style='color:#4CA9FF;font-weight:bold'>"+item+"</td><td>"+info[item]+"</td> </tr>";
			}					
			sContent +="</table>";
			//var marker = new BMap.Marker(map.getCenter());
			var infoWindow = new BMap.InfoWindow(sContent); //创建信息窗口对象
			map.addOverlay(marker);
			marker.addEventListener("click", function() {
				// 调用了marker对象的openInfoWindow方法
				this.openInfoWindow(infoWindow); 
			});     
}
simpleController({
	moduleName:"mapPosition",
	controllerName:"mapPositionCtrl",
	init:function($scope, $http){
		var params = getUrlParams();
		console.log(params);     
	//	map.centerAndZoom(new BMap.Point(params.jd, params.wd), 12);  // 初始化地图,设置中心点坐标和地图级别
		var map= new BMap.Map("allmap");    // 创建Map实例
		//map.addControl(new BMap.MapTypeControl());   //添加地图类型控件
		map.addControl(new BMap.MapTypeControl({
		mapTypes:[
            BMAP_NORMAL_MAP,
            BMAP_HYBRID_MAP
        ]}));	  
		map.enableScrollWheelZoom();                 //启用滚轮放大缩小
	  	var ggPoint = new BMap.Point(params.jd, params.wd);	   
	 	translateCallback = function (data){
	      if(data.status === 0) {
	      	var new_point=data.points[0];
	      
	        var marker = new BMap.Marker(new_point);
	         
	        addComplexInfoWindow(map,marker,{"变电站名称":params.amname,"电压等级":params.voltagelevel,"经度":params.jd,"纬度":params.wd});
	        var label = new BMap.Label(params.amname,{offset:new BMap.Size(-15,30)});
	        label.setStyle({
			    				 color : "#000",
			    				 fontSize : "12px",
			    				 height : "24px",
			    				 lineHeight : "24px",
								 backgroundColor:"#f4f4f4",
								 borderRadius:"5px",
								 boxShadow:"2px 3px 5px #666",
								 borderColor:"#0066cc",
			    				 fontFamily:"微软雅黑"
			    			 });
	        marker.setLabel(label); //添加百度label
	     //   map.setCenter(new_point);
	      //  map.panTo(new_point);  
	        map.centerAndZoom(new_point, 15);    
	        
	      }
	    }

    
        var convertor = new BMap.Convertor();
        var pointArr = [];
        pointArr.push(ggPoint);
        convertor.translate(pointArr, 1, 5, translateCallback);
	  
  		$scope.onCancel=function(){
			history.go(-1);
			 
		};
	}
});


</script>
</body>
</html>
