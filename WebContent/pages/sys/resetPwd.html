<!DOCTYPE HTML>
<html>
<head>
<title> 重置密码</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<script type="text/javascript" src="../../js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script></head>
<script type="text/javascript" src="../../angular-1.4.6/angular.min.js"></script>
<script type="text/javascript" src="../../js/PageBar.js"></script>
<script type="text/javascript" src="../../js/DropDownList-1.2/DropDownList-v1.2.js"></script>
<link rel="stylesheet" type="text/css" href="../../js/DropDownList-1.2/DropDownList.css" />
<script type="text/javascript" src="../../js/Calendar.js"></script>
<script type="text/javascript" src="../../js/SimpleDateFormat.js"></script>
<script type="text/javascript" src="../../js/util.js"></script>
<script type="text/javascript" src="../../js/config.js"></script>
<script type="text/javascript" src="../../js/MessageTip/MessageTip.js"></script>

<script type="text/javascript" src="../../js/eapJs/core/eap.core.js" ></script>
<script type="text/javascript" src="../../js/eapJs/plugins/eap.tip.js" ></script>
<script type="text/javascript" src="../../js/eapJs/plugins/eap.validate.js"></script>
<script type="text/javascript" src="../../js/eapJs/local/eap.lang-zh_CN.js"></script>
<link rel="stylesheet" type="text/css" href="../../css/validate.css"/>
<script type="text/javascript" src="../../js/showDlog/showDlog.js"></script>
<link rel="stylesheet" type="text/css" href="../../js/showDlog/showDlog-blue.css" />
<style type="text/css">
	body{
		margin:0px;
		padding:0px;
		font-size:12px;
		font-family:"微软雅黑";
	}
	a{color:#4D4D4D;text-decoration: none;}
	.table,.table td,.table th{border:1px solid #EDEDED;border-collapse:collapse;}
	table td input{font-size:11px;font-family:"微软雅黑";min-height:30px;min-width:250px;}
	
	table th{text-align:right;}
	
	
	.tabs{border-bottom:solid 1px #e6e6e6;}
	.tab{display:inline-block;margin:0 10px;line-height:36px;font-size:14px;}
	.tab.selected{color:#3385FF;border-bottom:solid 3px #3385FF;}
	.form_div{padding:20px 10px;}
	.form_div table th{padding:4px;font-weight:normal;}
	.form_div table td{padding:4px;}
	.form_bottom{border-top:solid 1px #e6e6e6;padding-top:20px;}
	.form_bottom .title_save{float:left;width:70px;height:28px;background: url(../../img/bnt_save.png) no-repeat;line-height:28px;text-align:center;margin-left:30px;margin-top:5px;color:#fff;cursor: pointer;}
	.form_bottom .title_cancel{float:left;width:70px;height:28px;background: url(../../img/bnt_cancel.png) no-repeat;line-height:28px;text-align:center;margin-left:30px;margin-top:5px;color:#666;cursor: pointer;}
	.readonly{background:#e6e6e6;border:solid 1px #c3c3c3;}
	.sentMsgBtn{display: inline-block;cursor:pointer;padding: 0 15px;line-height:34px;background: #7fcaff;color: #fff;}
	.sentMsgBtn:hover{background:#64bbf8}
	.initialTip{color:#ccc}
	.pscheck{display:block;width: 70px;text-align: center;line-height: 20px;float:left;background:#eee;color:#999999}
	.pscheck.low{background:#fff2e5;color:#e47e17;}
	.pscheck.middle{background:#ffe6cc;color:#e47e17;}
	.pscheck.strong{background:#ffd9b2;color:#e47e17;}
</style>
</head>

<body ng-app="userMgr" ng-controller="userMgrCtrl">
<form id="saveForm" class="required-validate">
	<div class="form_div" id="lay1">
		<table width="100%">
			<tr>
				<th>原密码</th>
				<td>
					<input type="password" name="oldPass" class="required" maxlength="25" placeholder="请输入原密码" /></td>
			</tr>
			<!-- <tr>
				<th>输入验证码</th>
				<td>
					<input type="text" name="moblieNum"  maxlength="25" placeholder="请输入验证码" />
					<span class="sentMsgBtn">发送验证码</span>
				</td>
			</tr> -->
			<tr>
				<th>输入新密码</th>
				<td>
					<input type="password" id="checkPS" name="pass" class="required" placeholder="密码6~18的数字、字母大小写及字符'!@#'组合" />
					<span class="initialTip" id="tipError"></span>
				</td>
			</tr>
			<tr>
				<th>密码强度</th>
				<td>
					<span class="pscheck pscheck1">弱</span>
					<span class="pscheck pscheck2">中</span>
					<span class="pscheck pscheck3">强</span>
				</td>
			</tr>
			<tr>
				<th>确认新密码</th>
				<td>
					<input type="password" name="repass" class="required" placeholder="请再次确认密码" />
					<span class="initialTip"></span>
				</td>
			</tr>
			<tr>
				<th></th>
				<td><span id="msg"></span></td>
			</tr>
		</table>
		
	</div>
	
	
	<div class="form_bottom">
		<a href="javascript:" ng-click="onSave()" class="title_save">
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;保存
		</a>
		<a href="javascript:" ng-click="onCancel()" class="title_cancel">
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;取消
		</a>
	</div>
</form>
<script type="text/javascript">

/* alert(new RegExp("^.*\\d.*$").test("ab2cde") && new RegExp("^.*[a-z]|[A-Z].*$").test("ab2cde")); */
var selectedUnitCode="";
var validator;
var ngScope;
var userData;
var app = angular.module("userMgr", []);
app.controller("userMgrCtrl", function($scope, $http){
	/* init */
	ngScope = $scope;
	$scope.curUnit={};
	$scope.userList=[];
	
	var userDataStr = $.cookie("pmsWeb_user_data");
	if(!userDataStr){
		
		noLogin(location.href);
		return;
	}
	userData = jQuery.parseJSON(userDataStr);
	ticket = $.cookie("pmsWeb_ticket");
	
	var params = getUrlParams();
	var proNo=params.proNo;
	var proName=decodeURIComponent(params.proName);
	
	$("input[name=proNo]").val(proNo);
	$("input[name=proName]").val(proName);
	
	/* 保存 */
	$scope.onSave=function(){
		$("input[name=companyCode]").val(userData.companyCode);
		var formData = $("#saveForm").serialize();
		
		if($("#saveForm").valid() &&status==1){
			var oldPass = $("input[name=oldPass]").val();
			var pass = $("input[name=pass]").val();
			var repass = $("input[name=repass]").val();
			if(pass!=repass){
				new MessageTip({
					randerTo:"#msg",
					msg:"新密码两次输入不一致！",
					position:"after"
				}).show();
				return;
			}
			$.ajax({
				url:serviceBasePath+"eap/pmsServices/loginService/psw?accountCode="+userData.accountCode+"&oldPsw="+oldPass+"&psw="+pass,
				cache:false,
				method:"POST",
				//data:formData,
				success:function(res){
					if(res.statusCode==200){
						new ShowDlog().prompt({
							icon:"success",
							msg:"修改成功",
							data:"success",
							done:function(data){
								parent.$dlog.data="success";
								parent.$dlog.close();
							},
							t:1500
						});
						//location.href="qualityDaily.html";
					}else{
						//
						new MessageTip({
							randerTo:"#msg",
							msg:res.resultMsg,
							position:"after"
						}).show();
					}
				},
				error:function(){
					
				}
			});
			
		}else{
			//alert("表单填写异常，请检查修正后再提交");
			new MessageTip({
				randerTo:"#msg",
				msg:"表单填写异常，请检查修正后再提交",
				position:"after"
			}).show();
		}
	};
	/*  */
	$scope.onCancel=function(){
		parent.$dlog.data="cancel";
		parent.$dlog.close();
	};
	
	
	/* Validate */
	validator = $("#saveForm").validate({
		onsubmit: false,
		focusInvalid: false,
		focusCleanup: true,
		errorElement: "span",
		ignore:".ignore",
		invalidHandler: function(form, validator) {
			var errors = validator.numberOfInvalids();
			if (errors) {
				
			} 
		}
	});
	
});
var status =0;
$("#checkPS").keyup(function(){
	var thirms=$("#checkPS").val();
	if(new RegExp("^.*\\d.*$").test(thirms) && new RegExp("^.*[a-z]|[A-Z].*$").test(thirms) && new RegExp("[@#!]").test(thirms)){
		if(thirms.length<6){
			$("#tipError").text("*最小长度为6！");
			$("#tipError").css("color","red");
			$(".pscheck1").removeClass("low");
			$(".pscheck2").removeClass("middle");
			$(".pscheck3").removeClass("strong");
			return;
		}else{
			$("#tipError").text("");
			$("#tipError").css("color","#ccc")
		}
		if(thirms=="admin" ||thirms=="root"||thirms=="password" ){
			$("#tipError").text("*不能输入的关键字");
			$("#tipError").css("color","red");
			return;
		}
		
		if(thirms.length>=6&&thirms.length<=8){
			$(".pscheck1").addClass("low");
			$(".pscheck2").removeClass("middle");
			$(".pscheck3").removeClass("strong");
		}
		if(thirms.length>=8&&thirms.length<=12){
			$(".pscheck1").addClass("low");
			$(".pscheck2").addClass("middle");
			$(".pscheck3").removeClass("strong");
		}
		if(thirms.length>=12&&thirms.length<=16){
			$(".pscheck1").addClass("low");
			$(".pscheck2").addClass("middle");
			$(".pscheck3").addClass("strong");
		}
	}else{
		$("#tipError").text("*请输入字母数字字符组合！");
		$("#tipError").css("color","red");
		$(".pscheck1").removeClass("low");
		$(".pscheck2").removeClass("middle");
		$(".pscheck3").removeClass("strong");
		return;
	}
	
		status =1;
});

</script>
</body>
</html>
