<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<title>Document</title>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script type="text/javascript" src="../js/jquery-1.9.1.min.js"></script>
	<script type="text/javascript" src="../js/placeholder.js"></script>
	<script type="text/javascript" src="../js/jquery.cookie.js"></script>
	<script type="text/javascript" src="../js/config.js"></script>
	<link rel="stylesheet" type="text/css" href="../css/iconfont/iconfont.css"/>
	<script type="text/javascript" src="../angular-1.4.6/angular.min.js"></script>
	<script type="text/javascript" src="../js/util.js"></script>
	<style>
		body{background:#f2f2f2}
		*{margin: 0;list-style: none;outline: none;padding: 0;color:#000;text-decoration:none}
		.mainnav{height:50px;background: #f2f2f2;padding:0 10px;}
		.mainnav li{line-height:35px;padding:0 15px;display:inline-block;background: #fff;margin-right:10px;border: 1px solid #e0e0e0;border-radius:3px;}
		.mainnav li.active{background:#018cf5;color:#fff}
		.mainnav ul{overflow: auto;padding-top:7px;height:37px;}
		.nav_show p{height: 40px;border-bottom: 1px solid #e0e0e0;line-height:40px;background:#fff}
		.nav_show p span{display:inline-block;background:#018cf3;width:3px;height: 20px;margin:0 10px 0 10px;}
		.nav_show .third_nav{overflow:hidden;background:#fff;margin-bottom:5px}
		.nav_show .third_nav li{width: 33%;border-bottom: 1px solid #e0e0e0;border-right: 1px solid #e0e0e0;padding: 20px 0 15px 0;text-align: center;float: left;}
		.nav_show .third_nav li:nth-child(3) {border-right:none;}
		.nav_show .third_nav li .nav_icon{width: 60px;height: 60px;border-radius:50%;text-align: center;background: #ffab3e;margin: 0 auto;color: #fff;margin-bottom: 10px;}
		.nav_show .third_nav li span{padding-top: 16px;display: inline-block;font-size:30px;color:#fff}
		.nav_title{position:relative}
		.nav_title .user_info{position:absolute;top:10px;right:10px}
		.nav_title *{color:#fff;font-size:20px}
		.color1{background:#ffab3e !important;}
		.color2{background:#f88685 !important;}
		.color3{background:#3bc7f8 !important;}
		.color4{background:#ad8df0 !important;}
		.color5{background:#7add9a !important;}
		.under_line{width:100%;height:5px;background:#f2f2f2}
	</style>
</head>
<body ng-app="pmsWeb" ng-controller="mainCtrl">
	<div class="nav_title">
		<img src="../img/mbt.png" width="100%"/>
		<ul class="user_info">
			<!--<li><a href="javascript:" id="userInfo"><span class="iconfont icon-renziguanlirenyuanguanli"></span> {{userData.employeeName}} ({{userData.unitName}})</a></li> -->
			 <li><a href="javascript:doLogout()" id="logout"><span class="iconfont icon-susheguanli"></span> 注销</a></li>
		</ul>
	</div>
	
	
	<div class="mainnav">
		<ul style="white-space:nowrap;">
			<li ng-repeat="item in fnModules" ng-class="{active:item.isSelected}" ng-click="selectModule(item)">{{item.moduleName}}</li>
		</ul>
	</div>
	<div class="nav_show">
		<p ng-repeat-start="item in leftModules"><span></span>{{item.moduleName}}</p>
		<ul ng-repeat-end class="third_nav">
			<!-- <a href="om/deviceMgr/device/deviceAdd_mb.html">
				<li>
					<div class="nav_icon">
						<span class="iconfont icon-shebeiguanlisanji"></span>
					</div>
					设备管理
				</li>
			</a> -->
			<li ng-repeat="nav in item.children">
				<a href="{{nav.url}}">
					<div ng-class="{'nav_icon':true, {{colorarr[$index]}}:true}" >
						<span class="{{nav.moduleIcon}}"></span>
					</div>
					{{nav.moduleName}}
				</a>
			</li>
		</ul>
	</div>
	 <script>
		var app = angular.module("pmsWeb", []);
		app.controller("mainCtrl", function($scope, $http){
			/* init */
			$scope.userData = {};
			$scope.fnModules = [];
			$scope.leftModules = [];
			
			$scope.selectedModule={};
			$scope.selectedLeftModule={};
			$scope.position=[];
			
			var userDataStr = $.cookie("pmsWeb_user_data");
			if(!userDataStr){
				
				location.href="login_mb.html";
				return;
			}
			$scope.userData = jQuery.parseJSON(userDataStr);
			
			$scope.colorarr=["color1","color2","color3","color4","color5"]	
		
			var ticket = $.cookie("pmsWeb_ticket");
			/* load modules */
			$http.get(serviceBasePath+"eap/pmsServices/loginService/moduleTree?account="
				+encodeURIComponent($scope.userData.accountName)+"&ticket="+ticket).success(function(response) {/*encodeURIComponent(*/
				if(response.statusCode!=200){
					alert("请求服务器失败！");
					return;
				}
				
				$scope.fnModules = response.list;
				// init top menu and left menu
	 			$scope.fnModules[0].isSelected=true;
	 			$scope.selectedModule=$scope.fnModules[0];
	 			$scope.leftModules=$scope.fnModules[0].children;
	 			// init position
			});
			/* Top menu select event */
			$scope.selectModule=function(module){
				$scope.selectedModule.isSelected=false;
				module.isSelected=true;
				$scope.selectedModule=module;
				
				$scope.leftModules=module.children;
			};
			/* Left menu select event */
			$scope.selectLeftMdu=function(module){
				$scope.selectedLeftModule.isSelected=false;
				module.isSelected=true;
				$scope.selectedLeftModule=module;
				/* Position */
				$scope.position = getParentsArray($scope.fnModules, module.parentModuleCode);
			};
			
		});
		/* 获取所有父节点数据 */
		function getParentsArray(treeData, parentModuleCode){
			var parentsData = new Array();
			var arrayData = new Array();
			treeToArray(treeData, arrayData);
			var temp = new Array();
			findParents(arrayData, parentModuleCode, temp);
			for(var i=temp.length-1; i>=0; i--){// 转正序
				parentsData.push(temp[i]);
			}
			return parentsData;
		}
		/* 循环查找父节点直到底层parentModuleCode=="0" */
		function findParents(arrayData, parentModuleCode, parentsData){
			for(var i=0; i<arrayData.length; i++){
				var module = arrayData[i];
				if(module.moduleCode==parentModuleCode){
					parentsData.push(module);
					if(module.parentModuleCode!="0"){
						findParents(arrayData, module.parentModuleCode, parentsData);
					}
				}
			}
		}
		/* 树型数据转成数组型数据，方便搜索 */
		function treeToArray(treeData, arrayData){
			for(var i=0; i<treeData.length; i++){
				var node = treeData[i];
				arrayData.push(node);
				if(node.children && node.children.length>0){
					treeToArray(node.children, arrayData);
				}
			}
		}
	
		function doLogout(){
			location.href="login_mb.html";
		}
		
	</script>
	
</body>
</html>