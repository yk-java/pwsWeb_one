<!DOCTYPE HTML>
<html ng-app="weekly">
<head>
<title> 通勤绩效-统计周报</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<script type="text/javascript" src="../../../js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../../../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../../angular-1.4.6/angular.min.js"></script>
<script type="text/javascript" src="../../../js/DropDownList-1.2/DropDownList-v1.2.js"></script>
<link rel="stylesheet" type="text/css" href="../../../js/DropDownList-1.2/DropDownList.css" />
<script type="text/javascript" src="../../../js/Calendar.js"></script>
<script type="text/javascript" src="../../../js/PageBar.js"></script>
<script type="text/javascript" src="../../../js/config.js"></script>
<style type="text/css">
	body{
		margin:0px;
		padding:0px;
		font-size:12px;
		font-family:"微软雅黑";
	}
	a{color:#4D4D4D;text-decoration: none;}
	.table,.table td,.table th{border:1px solid #EDEDED;border-collapse:collapse;}
	.tr1{height:40px;background:#D9E9FF;font-family: 微软雅黑;color:#4D4D4D;font-size:12px;font-weight:normal;}
	.tr2{height:40px;background:#fff;font-family: 微软雅黑;color:#4D4D4D;font-size:12px;}
	.tr2:hover{background:#F5F5F5;}
	.tr3{height:40px;background:#F5F5F5;font-family: 微软雅黑;color:#4D4D4D;font-size:12px;}
	.tr3:hover{background:#F5F5F5;}
	.tr4{height:40px;background:#EFD397;font-family: 微软雅黑;color:#4D4D4D;font-size:12px;}
	.operationImg{cursor: pointer;margin-right:14px;}
	
	.list{position: absolute;left:13px;right:13px;top:13px;bottom:10px;border:solid 0px;}
	.list .list_content{position: absolute;left:0px;right:0px;top:0px;bottom:0px;border:solid 0px;}
	.list .list_content .title_div{width:100%;height:68px;background:#4CA9FF;}

	.list .list_content .title_div .select_1{width:200px;height:30px;border:solid 0px;margin-left:40px;margin-top:19px;float:left;color:#6E6E6E;padding-left:4px;}
	.list .list_content .title_div .select_2{width:200px;height:30px;border:solid 0px;margin-left:40px;margin-top:19px;float:left;color:#6E6E6E;padding-left:4px;}
	.list .list_content .title_div .search_div{width:50px;height:30px;background:#3385FF;color:#fff;line-height:30px;text-align:center;float:left;margin-left:30px;margin-top:20px;font-size:14px;font-weight: bold;cursor: pointer;}

	.list .list_content .table_div{left:0px;right:0px;margin-bottom:32px;top:68px;border:solid 0px;}
	.list .list_bottom{left:0px;right:0px;bottom:0px;height:22px;border:solid 0px;color:#4D4D4D;}
	.list .list_bottom .paging_div{width:500px;height:22px;;margin:0 auto;border:solid 0px;}
	.list .list_bottom .paging_div .page_div{width:58px;height:22px;border:solid 1px #E5F1FF;line-height:22px;text-align:center;float:left;cursor: pointer;}
	.list .list_bottom .paging_div .page_div_1{width:auto;height:22px;line-height:22px;text-align:center;margin-left:30px;margin-right:30px;float:left;}
	.list .list_bottom .paging_div .page_div_1 > a:hover{font-size:12px;color:#0078D7;text-decoration:underline;}
	.list .list_bottom .paging_div .page_div_1 .page_a1{margin-left:10px;}
	.list .list_bottom .paging_div .page_div_1 .page_a1:hover{font-size:12px;color:#0078D7;text-decoration:underline;}
	.list .list_bottom .paging_div .page_div_1 .page_a2{margin-left:10px;font-size:14px;color:#0078D7;text-decoration:underline;}
	.list .list_bottom .paging_div .page_div_1 .page_a2:hover{font-size:14px;color:#0078D7;text-decoration:underline;}
	.dropDownTree{width:200px;background-image:url(../../../img/open--icon.png);background-repeat: no-repeat;background-position:right;background-position:185px;cursor:pointer;}
	.dropDownList{background-image:url(../../../img/open--icon.png);background-repeat: no-repeat;background-position:right;background-position:185px;cursor:pointer;}
	#page_bar .page_btn{display:inline-black;margin:0 4px;}
	#page_bar .selected{font-weight:bold;}
</style>
</head>

<body>

<div class="list" ng-controller="weeklyCtrl">
	<div class="list_content">
		<div class="title_div">
			<input type="text" class="select_1 dropDownTree" placeholder="请选择部门"/>
			<input type="text" id="beginDate" class="select_2 dropDownList" onclick="new Calendar().show(this)" placeholder="请选择日期"/>
			<input type="text" id="endDate" class="select_2 dropDownList" onclick="new Calendar().show(this)" placeholder="请选择日期"/>
			<div class="search_div" onclick="doQuery()">
				查 询
			</div>
			<div class="search_div" onclick="doExport()">
				导 出
			</div>
		</div>
		
		<div class="table_div">
			<table width="100%" border="0" cellspacing="0" cellpadding="0" class="table">
			   <tr class="tr1">
				<th width="4%"><div align="center">序号</div></th>
				<th width="16%"><div align="center">组织机构名称</div></th>
				<th width="6%"><div align="center">员工姓名</div></th>
				<th width="10%"><div align="center">员工工号</div></th>
				<th width="6%"><div align="center">上报点数</div></th>
				<th width="6%"><div align="center">标准点数</div></th>
				<th width="6%"><div align="center">上报合格率</div></th>
				<th width="6%"><div align="center">签到合格率</div></th>
				<th width="10%"><div align="center">状态</div></th>
				<th width="16%"><div align="center">异常说明</div></th>
			  </tr>
			  <tr class="tr2" ng-repeat="item in weeklyList">
				<td><div align="center">{{$index+1}}</div></td>
				<td><div align="center">{{item.unitName}}</div></td>
				<td><div align="center">{{item.employeename}}</div></td>
				<td><div align="center">{{item.jobNo}}</div></td>
				<td><div align="center">156</div></td>
				<td><div align="center">123</div></td>
				<td><div align="center">98%</div></td>
				<td><div align="center">{{item.signPerOfPass}}%</div></td>
				<td><div align="center" style="color:#FF5400">异常</div></td>
				<td><div align="center">未按时签到</div></td>
			  </tr>
			  
			</table>
		</div>

		<div id="page_bar" class="list_bottom" align="center">
		</div>

	</div>
</div>
<script type="text/javascript">
function createPageBar(totalPage, curPage,totalRecord){
	new PageBar().init({
		renderTo:"#page_bar",
		totalPage:totalPage,
		curPage:curPage,
		totalRecord: totalRecord,
		showPageInfo:true,
		prevPageText:"上一页",
		nextPageText:"下一页",
		onPage:function(pageNum){
			var beginDate = $("#beginDate").val();
			var endDate = $("#endDate").val();
			ngScope.loadStatistic("", selectedUnitCode, beginDate, endDate, pageNum);
			//$("#currPage").html(pageNum);
		}
	});
}

function doQuery(){
	var beginDate = $("#beginDate").val();
	var endDate = $("#endDate").val();
	ngScope.loadStatistic("", selectedUnitCode, beginDate, endDate, 1);
}

function doExport(){
	alert("稍后完善");
}

var ngScope;
var selectedUnitCode;
var app = angular.module("weekly", []);
app.controller("weeklyCtrl", function($scope, $http){
	/* init */
	ngScope = $scope;
	$scope.weeklyList=[];
	
	var userDataStr = $.cookie("pmsWeb_user_data");
	if(!userDataStr){
		
		noLogin(location.href);
		return;
	}
	var userData = jQuery.parseJSON(userDataStr);
	ticket = $.cookie("pmsWeb_ticket");
	
	new DropDownList().init({
		renderTo:".dropDownTree",
		url:"../../component/orgTree.html?ticket="+ticket,
		height:"200px",
		onSelected:function(result){
			selectedUnitCode=result.unitCode;
			$(".dropDownTree").val(result.unitName);
			var date = $("#date").val();
			ngScope.loadStatistic("", result.unitCode, date, 1);
		},
		css:{
			top:50,
			left:40
		}
	});
	
	$scope.loadStatistic=function(companyCode, unitCode, beginDate, endDate, currentPage){
		$http.get(serviceBasePath+"eap/pmsServices/commuteMgr/performance/statistic/statisticByDate?companyCode="
			+companyCode+"&unitCode="+unitCode+"&beginDate="+beginDate+"&endDate="+endDate+"&currentPage="+currentPage+"&ticket="+ticket).success(function(response){
			if(response.statusCode!=200){
				alert("请求服务器失败！");
				return;
			}
			$scope.weeklyList = response.list;
			createPageBar(response.currentPage, response.totalPage,response.totalRecord);
		});
	};
	
	$scope.loadStatistic("", userData.unitCode, "", "", 1);
	selectedUnitCode=userData.unitCode;
	
});
</script>
</body>
</html>
