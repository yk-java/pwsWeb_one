<!DOCTYPE HTML>
<html>
<head>
<title>图片管理</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<script type="text/javascript" src="../../../js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../../../js/jquery.cookie.js"></script>
<script type="text/javascript"
	src="../../../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>
</head>
<script type="text/javascript" src="../../../angular-1.4.6/angular.min.js"></script>
<script type="text/javascript" src="../../../js/PageBar.js"></script>
<script type="text/javascript" src="../../../js/DropDownList-1.2/DropDownList-v1.2.js"></script>
<link rel="stylesheet" type="text/css" href="../../../js/DropDownList-1.2/DropDownList.css" />
<script type="text/javascript" src="../../../js/Calendar.js"></script>
<script type="text/javascript" src="../../../js/config.js"></script>
<script type="text/javascript" src="../../../js/util.js"></script>

<script type="text/javascript" src="../../../js/eapJs/core/eap.core.js"></script>
<script type="text/javascript" src="../../../js/eapJs/plugins/eap.tip.js"></script>
<script type="text/javascript"
	src="../../../js/eapJs/plugins/eap.validate.js"></script>
<script type="text/javascript"
	src="../../../js/eapJs/local/eap.lang-zh_CN.js"></script>
<link rel="stylesheet" type="text/css" href="../../../css/validate.css" />
<link rel="stylesheet" type="text/css" href="../../../css/edit.css" />

<script type="text/javascript" src="../../../js/jquery.form.js"></script>


<script type="text/javascript" src="../../../js/showDlog/showDlog.js"></script>
<link rel="stylesheet" type="text/css"
	href="../../../js/showDlog/showDlog-blue.css" />





<script src="../../../js/jquery-photo-gallery/jquery.photo.gallery.js"></script>

<style type="text/css">
.imgitem {
	height: 250px;
	width: 19%;
	border: 1px #ccc solid;
	float: left;
	margin-right: 1px;
	margin-left: 5px;
	margin-top: 5px;
}

.imgs {
	width: 184px;
	height: 250px;
	z-index: -1
}

.eidtdiv {
	margin-left: 125px;
	text-align: center;
	padding-top: 8px;
	position: absolute;
	font-family: '微软雅黑';
	font-size: 12px;
	height: 22px;
	width: 60px;
	filter: alpha(Opacity = 80);
	-moz-opacity: 0.5;
	opacity: 0.5;
	
	background-color: black;
}
.titlemess{
	width:184px;
	height:80px;
	background:red;
	position: absolute;
	margin-top:-84px;
	filter: alpha(Opacity = 90);
	-moz-opacity: 0.9;
	opacity: 0.9;
	background-color: #E6E6E6;
	text-align: center;
	color:#999
	
}
.eidtdiv a {
	color: #fff;
	cursor: pointer;
}

.eidtdiv a:HOVER {
	color: #3385FF;
}

.imgitem:HOVER {
	border: 1px red solid;
	cursor: pointer;
}

#bg {
	display: none;
	position: absolute;
	top: 0%;
	left: 0%;
	width: 100%;
	height: 100%;
	background-color: black;
	z-index: 95;
	-moz-opacity: 0.5;
	opacity: .50;
	filter: alpha(opacity = 50);
	text-align: center
}

#show {
	display: none;
	position: absolute;
	top: 28%;
	left: 28%;
	bottom: 35%;
	right: 28%;
	border: 2px solid #E8E9F7;
	background-color: white;
	z-index: 96;
	overflow: hidden;
	text-align: center;
}

#show img {
	height: 100%;
	width: 100%
}

#btnclose {
	position: absolute;
	z-index: 90;
	right: 0px;
	top: 0px
}
#blankMsg span{display:block;border:solid 1px #ff9900;background:#ffefcc;color:#000000;padding:4px;}
</style>
</head>

<body ng-app="userMgr" ng-controller="userMgrCtrl">
<form id="saveForm" class="required-validate" style="height:300px;">
	<div class="list">
		<div class="imgitem gallerys" ng-repeat="item in imgList">
			<div class="eidtdiv">
				<a ng-click="showdiv($index, picTitle)">放大</a> 
			</div>
			<img src="{{item.url}}" id="pic_{{$index}}" onerror="javascript:this.src='../../../img/defaultImg02.png';" class="imgs gallery-pic"
				ondblclick="$.openPhotoGallery(this, '../../../js/jquery-photo-gallery/gallery.html?picTitle={{item.picTitle}}')" />
			<div class="titlemess">
				<p>{{item.picTitle}}</p>
				
				<p>拍摄时间 : {{item.sysCreateTime}}</p>
			</div>
			
		</div>
		<div ng-if="!imgList || imgList.length==0" id="blankMsg"></div>

<!-- 		<div class="imgitem" ng-click="addImg()"> -->
<!-- 			<img src="../../../img/adding.png" style="width: 100%; height: 100%" /> -->
<!-- 		</div> -->

		<div id="bg"></div>
		<div id="show">


			<input id="btnclose" type="image" src="../../../img/closing.png"
				style="border: 0px;" title="关闭" alt="关闭" onclick="hidediv();" />

			<div
				style="width: 350px; text-align: left; margin-left: 30px; line-height: 35px; margin-top: 20px;">
				<p>
					文件名称&nbsp;&nbsp;<input type="text" name="picTitle"
						style="width: 230px; height: 26px;" />
						
						<input type="hidden" name="mctCode" />
						<input type="hidden" name="companyCode" />
						<input type="hidden" name="proNo" />
						<input type="hidden" name="deviceObjCode" />
				</p>
				<p>
					选择文件&nbsp;&nbsp;<input type="file" name="projDoc" onchange="loadfileName(this)" />
				</p>
				<div class="form_bottom"
					style="padding-left: 65px; padding-top: 40px">
					<a href="javascript:" ng-click="onSave()" class="title_save">
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;确认 </a> <a href="javascript:"
						onclick="hidediv()" class="title_cancel">
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;取消 </a>
				</div>
			</div>
		</div>

	</div>
</form>
	<script type="text/javascript">  
      
    </script>
	<script type="text/javascript">
function loadfileName(obj){
	var filePath=$(obj).val();
	
	
	var fileName=filePath.split("\\");
	
	$("input[name=picTitle]").val(fileName[fileName.length-1].substring(0,fileName[fileName.length-1].length-4));
	
}


   function hidediv() {         
		document.getElementById("bg").style.display = 'none';       
		 document.getElementById("show").style.display = 'none';
    } 
var validator;
var ngScope;
var userData;
var app = angular.module("userMgr", []);
app.controller("userMgrCtrl", function($scope, $http){
	/* init */
	ngScope = $scope;
	$scope.curUnit={};
	$scope.imgList=[];
	
	var mydate = new Date();
	//alert(mydate.getFullYear()+"-"+(mydate.getMonth()+1)+"-"+mydate.getDate());
	
	$("input[name=matterTime]").val(mydate.getFullYear()+"-"+(mydate.getMonth()+1)+"-"+mydate.getDate());
	
	var userDataStr = $.cookie("pmsWeb_user_data");
	if(!userDataStr){
		
		noLogin(location.href);
		return; 
	}
	userData = jQuery.parseJSON(userDataStr);
	ticket = $.cookie("pmsWeb_ticket");
	
	
	/* 表单验证 */
	validator = $("#saveForm").validate({
		onsubmit: false,
		focusInvalid: false,
		focusCleanup: true,
		errorElement: "span",
		ignore:".ignore",
		invalidHandler: function(form, validator) {
			var errors = validator.numberOfInvalids();
			if (errors) {
				
			} 
		}
	});
	
	//$("input[name=companyCode]").val(userData.companyCode);
	var params = getUrlParams();
	
	var mctCode=params.mctCode;
	var companyCode=params.companyCode;
	var proNo=params.proNo;
	var deviceObjCode=params.deviceObjCode;


	$("input[name=mctCode]").val(mctCode);
	$("input[name=companyCode]").val(companyCode);
	$("input[name=proNo]").val(proNo);
	$("input[name=deviceObjCode]").val(deviceObjCode);

	$scope.loadProject=function(){
		$http.get(serviceBasePath+"eap/pmsServices/commuteMgr/performance/statistic/findCommuteByDate?accountCode="+params.accountCode+"&date="+params.date).success(function(response){
			if(response.statusCode==401){
				alert("用户凭据过期！请重新登录！");
				window.top.location.href="../../../../login.html";
				return;
			}
			var vo = response.data;
			var lst = [];
			if(vo.checkinImg1){
				var imgItem={};
				imgItem.fileCode=vo.checkinImg1;
				imgItem.picTitle="签到人";
				imgItem.sysCreateTime=vo.checkinTime;
				lst.push(imgItem);
			}
			if(vo.checkinImg2){
				var imgItem={};
				imgItem.fileCode=vo.checkinImg2;
				imgItem.picTitle="签到环境";
				imgItem.sysCreateTime=vo.checkinTime;
				lst.push(imgItem);
			}
			if(vo.checkoutImg1){
				var imgItem={};
				imgItem.fileCode=vo.checkoutImg1;
				imgItem.picTitle="签退人";
				imgItem.sysCreateTime=vo.checkoutTime;
				lst.push(imgItem);
			}
			if(vo.checkoutImg2){
				var imgItem={};
				imgItem.fileCode=vo.checkoutImg2;
				imgItem.picTitle="签退环境";
				imgItem.sysCreateTime=vo.checkoutTime;
				lst.push(imgItem);
			}
			
			for(var i=0;i<lst.length;i++){
				var st=filePath+"?fileCode="+lst[i].fileCode+"&attachment=0"
						
			    lst[i].url=st;			
			} 
			$scope.imgList = lst;
			if(lst.length==0){
				$("#blankMsg").html("<span>未上传照片！</span>");
			}
		});
		
	};
	/* 初始加载 */
	$scope.loadProject(mctCode,companyCode,proNo,deviceObjCode);
	
	
	//$scope.imgList=[{url:'../../../img/testimg/1.png'},{url:'../../../img/testimg/2.png'},{url:'../../../img/testimg/3.png'},{url:'../../../img/testimg/1.png'},{url:'../../../img/testimg/2.png'},{url:'../../../img/testimg/3.png'}];
	
	
	
	
	$scope.showdiv=function(index, title){
		//alert(index);
		
		var img1=$("#pic_"+index);
		//alert(img1)
		/* var img1 = $(obj).parent().next("img");//.dblclick();
		//alert(img1)
		*/
		$.openPhotoGallery(img1, '../../../js/jquery-photo-gallery/gallery.html?picTitle='+title); 
		
		/* $("#showimg").attr("src",$scope.imgList[id].url);
		
		
		document.getElementById("bg").style.display = "block";           
		document.getElementById("show").style.display = "block"; */
	
	};
	
	
	
	/* 取消 */
	$scope.onCancel = function(){
		location.href="materialTypeMgr.html";
	};
	
});
</script>
</body>
</html>
