<!DOCTYPE HTML>
<html>
<head>
<title> 文档评核</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<script type="text/javascript" src="../../../js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../../../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../../js/eapJs/core/eap.core.js" ></script>
<script type="text/javascript" src="../../../js/eapJs/plugins/eap.tip.js" ></script>
<script type="text/javascript" src="../../../js/eapJs/plugins/eap.validate.js"></script>
<script type="text/javascript" src="../../../js/eapJs/local/eap.lang-zh_CN.js"></script>
<script type="text/javascript" src="../../../angular-1.4.6/angular.min.js"></script>
<script type="text/javascript" src="../../../js/util.js"></script>
<script type="text/javascript" src="../../../js/config.js"></script>
<script type="text/javascript" src="../../../js/Calendar.js"></script>
<link rel="stylesheet" type="text/css" href="../../../css/validate.css"/>
<link rel="stylesheet" type="text/css" href="../../../css/edit.css"/>

<script type="text/javascript" src="../../../js/showDlog/showDlog.js"></script>
<link rel="stylesheet" type="text/css" href="../../../js/showDlog/showDlog-blue.css" />

<style type="text/css">
	.all{width:100%;}
	
	.cont{padding-left:20px;}
	.cont p{margin:0px; padding:0px;margin-bottom:10px;}
	.cont table{ font-family: '微软雅黑'; line-height: 24px;}
</style>

</head>

<body ng-app="projectType" ng-controller="userMgrCtrl" style="overflow: hidden;">
<form id="saveForm" class="required-validate" style="height:300px;">

	<div class="cont">
		<p style="margin-top:10px;margin-bottom:10px;">
			<input type="radio" name="checkFlag" value="0" checked="checked"  onclick="sta(0)" /> 不扣分
			<input type="radio" name="checkFlag" value="1" onclick="sta(1)" /> 扣分
			<input type="radio" name="checkFlag" value="2" onclick="sta(1)" /> 加分
			<input type="hidden" name="companyCode" />
			<input type="hidden" name="docNo" />
			<input type="hidden" name="proNo" />
			<input type="hidden" name="docTypelibName" />
			<input type="hidden" name="employeeCode" />
		</p>
		<table>
			<tr style="height:60px;">
				<td width="60px;" style="text-align: center">评核分值</td>
				<td><input type="text" name="checkVal" class="number readonly" readonly="readonly" /></td>
			</tr>
			<tr>
				<td width="60px;" style="text-align: center">评核说明</td>
				<td><textarea rows="3" cols="50" id="checkDesc" name="checkDesc" class="readonly" readonly="readonly"></textarea></td>
			</tr>
		</table>
		
		<div class="form_bottom" style="padding-left:15px;padding-top:40px">
			<a href="javascript:" ng-click="onSave()" class="title_save" ng-if="isChecked==0">
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;确认
			</a>
			<a href="javascript:" ng-click="onCancel()" class="title_cancel">
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;取消
			</a>
	</div>
	</div>
	

</form>


<script type="text/javascript">

	function sta(num){
		if(num==0){
			 $("input[name=checkVal]").addClass("readonly");
			 $("#checkDesc").addClass("readonly");
			
			 $("input[name=checkVal]").attr("readonly","readonly");//将input元素设置为readonly
		  　   
		    $("#checkDesc").attr("readonly","readonly");
		    $("input[name=checkVal]").val("");
		    $("#checkDesc").val("");
		    
		}else{
			$("input[name=checkVal]").removeClass("readonly");
			$("#checkDesc").removeClass("readonly");
			$("#checkDesc").removeAttr("readonly");
			$("input[name=checkVal]").removeAttr("readonly");//去除input元素的readonly属性
		}
	}
	var ngScope;
	var proNo="";
	var companyCode="";
	var docNo="";
	var isChecked=0;
	
	var checkVal="";
	var checkDesc="";

	var checkFlag=0;
	var docTypelibName="";
	
	var app = angular.module("projectType", []);
	app.controller("userMgrCtrl", function($scope, $http){
		/* init */
		ngScope = $scope;
		
		$scope.lefObj={}; //左侧数据
		$scope.isChecked=0;
		var mydate = new Date();
		$("#times").val(mydate.getFullYear()+"-"+(mydate.getMonth()+1)+"-"+mydate.getDate());
		
		var userDataStr = $.cookie("pmsWeb_user_data");
		if(!userDataStr){
			
			noLogin(location.href);
			return;
		}
		$scope.userData = jQuery.parseJSON(userDataStr);
		var ticket = $.cookie("pmsWeb_ticket");
	
		$("input[name=employeeCode]").val($scope.userData.employeeCode);
		var params = getUrlParams();
		$scope.required = params.required;
		
		if(params.companyCode){
			companyCode=params.companyCode;
			$("input[name=companyCode]").val(params.companyCode);
		}
		if(params.proNo){
			proNo=params.proNo;
			$("input[name=proNo]").val(params.proNo);
		}
		
		if(params.docNo){
			docNo=params.docNo;
			$("input[name=docNo]").val(params.docNo);
		}
		if(params.isChecked){
			isChecked=params.isChecked;
			$scope.isChecked=isChecked;
		}
		if(params.checkVal){
			$("input[name=checkVal]").val(params.checkVal);
			
		}
		
		if(params.checkDesc){
			$("#checkDesc").text(params.checkDesc);
			
		}
		if(params.checkFlag){
			checkFlag=params.checkFlag;
			
		}
		docTypelibName=params.docTypelibName;
		
		$("input[name=docTypelibName]").val(docTypelibName);
		
		if(checkFlag=="0"){
			$("input[name=checkVal]").val("");
		    $("#checkDesc").val("");
		    $("input[type=radio][name='checkFlag'][value=0]").attr("checked",'checked'); 
		}else if(checkFlag=="1"){
			$("input[type=radio][name='checkFlag'][value=1]").attr("checked",'checked'); 
			$("input[name=checkVal]").removeClass("readonly");
			$("#checkDesc").removeClass("readonly");
			$("#checkDesc").removeAttr("readonly");
			$("input[name=checkVal]").removeAttr("readonly");//去除input元素的readonly属性
		}else if(checkFlag=="2"){
			$("input[type=radio][name='checkFlag'][value=2]").attr("checked",'checked'); 
			$("input[name=checkVal]").removeClass("readonly");
			$("#checkDesc").removeClass("readonly");
			$("#checkDesc").removeAttr("readonly");
			$("input[name=checkVal]").removeAttr("readonly");//去除input元素的readonly属性
		}
		
		var assetCode = "";
		
		
		/* 表单验证 */
	validator = $("#saveForm").validate({
		onsubmit: false,
		focusInvalid: false,
		focusCleanup: true,
		errorElement: "span",
		ignore:".ignore",
		invalidHandler: function(form, validator) {
			var errors = validator.numberOfInvalids();
			if (errors) {
				
			} 
		}
	});
		
		
		/* 保存 */
		$scope.onSave = function(){
			
			//$("input[name=companyCode]").val(userData.companyCode);
			var formData = $("#saveForm").serialize();
			
			
			if(isChecked=="0"){//新增
					if($("#saveForm").valid()){
						var promptDlog = new ShowDlog();
						promptDlog.prompt({
							icon:"waitting",
							msg:"正在保存...",
							done:function(){
								//
								new ShowDlog().prompt({
									msg:"服务器无响应",
									done:function(){
										//
									},
									t:1500
								});
							},
							t:60000
						});
						$.ajax({
							url:serviceBasePath+"eap/pmsServices/pm/projDoc/documentCheck/add",
							cache:false,
							method:"POST",
							data:formData,
							success:function(res){
								promptDlog.close();
								parent.$dlog.close();
							},
							error:function(){
								
							}
						});
					}
			}else if(isChecked=="1"){//修改
				//$(".title_save").hide();
				
				
				
			/* 	if($("#saveForm").valid()){
					var promptDlog = new ShowDlog();
					promptDlog.prompt({
						icon:"waitting",
						msg:"正在保存...",
						done:function(){
							//
							new ShowDlog().prompt({
								msg:"服务器无响应",
								done:function(){
									//
								},
								t:1500
							});
						},
						t:60000
					});
					$.ajax({
						url:serviceBasePath+"eap/pmsServices/pm/projDoc/documentCheck/update",
						cache:false,
						method:"POST",
						data:formData,
						success:function(res){
							promptDlog.close();
							parent.$dlog.close();
						},
						error:function(){
							
						}
					});
				} */
			}
			
		};
		$scope.onCancel=function(){
			parent.$dlog.close();
			
		};
		
	});
	
	
	</script>
</body>
</html>
