<!DOCTYPE HTML>
<html>
<head>
<title> 人员管理</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<script type="text/javascript" src="../../../js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../../../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script></head>
<script type="text/javascript" src="../../../angular-1.4.6/angular.min.js"></script>
<script type="text/javascript" src="../../../js/PageBar.js"></script>
<script type="text/javascript" src="../../../js/DropDownList-1.2/DropDownList-v1.2.js"></script>
<link rel="stylesheet" type="text/css" href="../../../js/DropDownList-1.2/DropDownList.css" />
<script type="text/javascript" src="../../../js/Calendar.js"></script>
<script type="text/javascript" src="../../../js/SimpleDateFormat.js"></script>
<script type="text/javascript" src="../../../js/util.js"></script>
<script type="text/javascript" src="../../../js/config.js"></script>
<script type="text/javascript" src="../../../js/ng-base.js"></script>
<script type="text/javascript" src="../../../js/eapJs/core/eap.core.js" ></script>
<script type="text/javascript" src="../../../js/eapJs/plugins/eap.tip.js" ></script>
<script type="text/javascript" src="../../../js/eapJs/plugins/eap.validate.js"></script>
<script type="text/javascript" src="../../../js/eapJs/local/eap.lang-zh_CN.js"></script>
<link rel="stylesheet" type="text/css" href="../../../css/validate.css"/>
<script type="text/javascript" src="../../../js/showDlog/showDlog.js"></script>
<link rel="stylesheet" type="text/css" href="../../../js/showDlog/showDlog-blue.css" />

<style type="text/css">
	body{
		margin:0px;
		padding:0px;
		font-size:12px;
		font-family:"微软雅黑";
	}
	a{color:#4D4D4D;text-decoration: none;}
	.table,.table td,.table th{border:1px solid #EDEDED;border-collapse:collapse;}
	table td input{font-size:11px;font-family:"微软雅黑";min-height:21px;min-width:80px;}
	textarea,input{font-size:11px;font-family:"微软雅黑";}
	.tr1{height:40px;background:#D9E9FF;font-family: 微软雅黑;color:#4D4D4D;font-size:12px;font-weight:normal;}
	.tr2{height:40px;background:#fff;font-family: 微软雅黑;color:#4D4D4D;font-size:12px;}
	.tr2:hover{background:#F5F5F5;}
	.tr3{height:40px;background:#F5F5F5;font-family: 微软雅黑;color:#4D4D4D;font-size:12px;}
	.tr3:hover{background:#F5F5F5;}
	.tr4{height:40px;background:#EFD397;font-family: 微软雅黑;color:#4D4D4D;font-size:12px;}
	.operationImg{cursor: pointer;margin-right:14px;}
	
	.list{position: absolute;left:13px;right:13px;top:13px;bottom:10px;border:solid 0px;}
	.list .list_content{position: absolute;left:0px;right:0px;top:0px;bottom:0px;border:solid 0px;}
	.list .list_content .title_div{width:100%;height:39px;border-bottom:solid 3px #4CA9FF;}
	.list .list_content .title_div .title_left{min-width:200px;height:39px;background:#4CA9FF;line-height:42px;color:#fff;font-size:14px;font-weight: bold;float:left;}
	.list .list_content .title_div .title_left > select{width:250px;height:30px;border:solid 0px;margin-left:20px;color:#4D4D4D;float:left;margin-top:5px;}
	.list .list_content .title_div .title_left > input{width:200px;height:30px;border:solid 0px;margin-left:20px;color:#666;float:left;margin-top:5px;padding-left:4px;}
	.list .list_content .title_div .title_left .query_div{width:60px;height:30px;float:left;margin-left:20px;margin-top:7px;line-height:30px;text-align:center;color:#fff;background:#3385FF;cursor: pointer;}
	.list .list_content .title_div > img{float:left;margin-top:1px;}
	.list .list_content .title_div .title_add{float:left;width:70px;height:28px;background: url(../../../img/bnt_newly-added.png) no-repeat;line-height:28px;text-align:center;margin-left:30px;margin-top:5px;color:#fff;cursor: pointer;}
	
	.list .list_content .table_div{left:0px;right:0px;margin-bottom:32px;top:42px;border:solid 0px;}
	.list .list_bottom{left:0px;right:0px;bottom:0px;height:22px;border:solid 0px;color:#4D4D4D;}
	.list .list_bottom .paging_div{width:500px;height:22px;;margin:0 auto;border:solid 0px;}
	.list .list_bottom .paging_div .page_div{width:58px;height:22px;border:solid 1px #E5F1FF;line-height:22px;text-align:center;float:left;cursor: pointer;}
	.list .list_bottom .paging_div .page_div_1{width:auto;height:22px;line-height:22px;text-align:center;margin-left:30px;margin-right:30px;float:left;}
	.list .list_bottom .paging_div .page_div_1 > a:hover{font-size:12px;color:#0078D7;text-decoration:underline;}
	.list .list_bottom .paging_div .page_div_1 .page_a1{margin-left:10px;}
	.list .list_bottom .paging_div .page_div_1 .page_a1:hover{font-size:12px;color:#0078D7;text-decoration:underline;}
	.list .list_bottom .paging_div .page_div_1 .page_a2{margin-left:10px;font-size:14px;color:#0078D7;text-decoration:underline;}
	.list .list_bottom .paging_div .page_div_1 .page_a2:hover{font-size:14px;color:#0078D7;text-decoration:underline;}
	.dropDownArea{border-width:1px;padding:2px 1px;background-image:url(../../../img/area.png);background-repeat: no-repeat;background-position:right;cursor:pointer;}
	.dropDownArea2{border-width:1px;padding:2px 1px;background-image:url(../../../img/area.png);background-repeat: no-repeat;background-position:right;cursor:pointer;}
	.dropDownTree{background-image:url(../../../img/open--icon.png);background-repeat: no-repeat;background-position:right;background-position:185px;cursor:pointer;}
	#page_bar .page_btn{display:inline-black;margin:0 4px;}
	#page_bar .selected{font-weight:bold;}
	.title_div .title_left .title{font-size:14px;font-weight:bold;padding-left:6px;}
	table th{text-align:right;}
	
	table{border-collapse:collapse;}
	.tabs{border-bottom:solid 1px #e6e6e6;}
	.tab{display:inline-block;margin:0 10px;line-height:36px;font-size:14px;}
	.tab.selected{color:#3385FF;border-bottom:solid 3px #3385FF;}
	.form_div{padding:20px 10px;}
	.form_div table th{padding:5px;font-weight:normal;}
	.form_div table td{padding:5px;}
	.form_bottom{border-top:solid 1px #e6e6e6;padding-top:20px;}
	.form_bottom .title_save{float:left;width:70px;height:28px;background: url(../../../img/bnt_save.png) no-repeat;line-height:28px;text-align:center;margin-left:30px;margin-top:5px;color:#fff;cursor: pointer;}
	.form_bottom .title_cancel{float:left;width:70px;height:28px;background: url(../../../img/bnt_cancel.png) no-repeat;line-height:28px;text-align:center;margin-left:30px;margin-top:5px;color:#666;cursor: pointer;}
	.readonly{background:#e6e6e6;border:solid 1px #c3c3c3;}
	tr.th_bg{background:#e6e6e6;height:30px;padding:0px;border-top:solid 2px #fff;}
	tr.th_bg td{padding:0px;}
	tr.th_bg .title{display:inline-block;width:90px;color:#0078D7;font-size:14px;font-weight:bold;line-height:32px;border-bottom:solid 2px #0078D7;padding-left:10px;padding-right:10px;}
	tr.tb_bg{background:#f4f4f4;}
	.workloadItem{display:inline-block;margin-right:30px;color:#0078D7;font-size:12px;}
	.workloadItem .num{color:#f80;font-weight:bold;}
	.form_div table th.group_ti{font-weight:bold;}
	
</style>
</head>

<body ng-app="moduleName" ng-controller="controllerName">

<div class="list">
	<div class="list_content">
		<div class="title_div">
			<div class="title_left">
				<label class="title">项目进度日报</label>
			</div>
			<img src="../../../img/list_Header2-.png">
		</div>
<!-- 		<div class="tabs"> -->
<!-- 			<a href="#lay1" class="tab selected">项目日报</a> -->
<!-- 		</div> -->
		<form id="saveForm" class="required-validate">
		<div class="form_div" id="lay1">
			<table>
				<tr class="th_bg">
					<td colspan="7">
						<label class="title">项目日报</label>
					</td>
				</tr>
				<tr class="tb_bg">
					<th></th>
					<th>项目</th>
					<td>
						<input type="hidden" name="companyCode"/>
						<input type="hidden" name="proNo"/>
						<input type="text" name="proName" class="required readonly" readonly="readonly" maxlength="16"/></td>
					<th>上报日期</th>
					<td><input type="text" name="reportDate" readonly="readonly" class="required readonly" maxlength="16" style="width:130px;font-weight:bold;font-size:14px;background:#ffff99;"/></td>
					<th></th>
					<td></td>
				</tr>
				<tr class="tb_bg">
					<th class="group_ti">本日计划完成量</th>
					<th>外业计划完成工作量（{{unit}}）</th>
					<td>
						<input type="text" name="" value="{{planOwWordload}}" class="readonly" readonly="readonly"/>
					</td>
					<th>内业计划完成工作量（{{unit}}）</th>
					<td><input type="text" name="" value="{{planIwWordload}}" class="readonly" readonly="readonly" style="width:130px;"/></td>
					<th></th>
					<td></td>
				</tr>
				<tr class="th_bg">
					<td colspan="2">
						<label class="title">本日完成指标</label>
					</td>
					<td colspan="5">
						<label class="workloadItem">外业完成总工作量：<span class="num" id="oSum">{{outSum}}</span>{{unit}}</label>
						<label class="workloadItem">外业完成工作量：<span class="num" id="actualOwWordload">{{daily.actualOwWordload}}</span>{{unit}}</label>
						<label class="workloadItem">内业完成总工作量：<span class="num" id="iSum">{{inSum}}</span>{{unit}}</label>
						<label class="workloadItem">内业完成工作量：<span class="num" id="actualIwWordload">{{daily.actualIwWordload}}</span>{{unit}}</label>
						<input type="hidden" name="actualOwWordload" value="{{daily.actualOwWordload}}"/>
						<input type="hidden" name="actualIwWordload" value="{{daily.actualIwWordload}}"/>
						
						<input type="hidden" name="actualOwCable" value="{{daily.actualOwCable}}"/>
						<input type="hidden" name="actualOwLocate" value="{{daily.actualOwLocate}}"/>
						<input type="hidden" name="actualOwCard" value="{{daily.actualOwCard}}"/>
						
						<input type="hidden" name="kpiData"/>
					</td>
				</tr>
				<!-- ------------------------------------------------------------------------------------------------------- -->
				<tr ng-repeat="tr in kpiTable" class="tb_bg">
					<th class="group_ti">
						{{tr.label}}
					</th>
					<td ng-repeat-start="item in tr.kpis" align="right">{{item.kpiName}}</td>
					<td ng-repeat-end><input type="text" ng-if="item.kpiName != null" name="{{item.kpiCode}}" group="kpi" kpitype="{{item.kpiType}}" itemlabel="{{item.itemLabel}}" mergeflag="{{item.mergeFlag}}" ng-keyup="doItemSum(item)" value="{{item.kpiValue}}" class="required number"/>{{item.kpiUnit}}</td>
				</tr>
				<!-- ------------------------------------------------------------------------------------------------------- -->
				<tr class="th_bg">
					<td colspan="7">
						<label class="title">本日完成说明</label>
					</td>
				</tr>
				<tr class="tb_bg">
					<th class="group_ti">外业说明</th>
					<th>外业投入人员</th>
					<td>
						<input type="text" name="actualOwPns" value="{{daily.actualOwPns}}" class="required number"/>
					</td>
					<th>外业完成说明 </th>
					<td>
						<textarea cols="30" rows="3" name="actualOwWorkDesc" class="required">{{daily.actualOwWorkDesc}}</textarea>
					</td>
					<th></th>
					<td></td>
				</tr>
				<tr class="tb_bg">
					<th class="group_ti">内业说明</th>
					<th>内业投入人员</th>
					<td><input type="text" name="actualIwPns" value="{{daily.actualIwPns}}" class="required number"/></td>
					<th>内业完成说明</th>
					<td><textarea cols="30" rows="3" name="actualIwWorkDesc" class="required">{{daily.actualIwWorkDesc}}</textarea></td>
					<th></th>
					<td></td>
				</tr>
				<tr class="th_bg">
					<td colspan="7">
						<label class="title">次日计划</label>
					</td>
				</tr>
				<tr class="tb_bg">
					<th></th>
					<th>外业计划完成工作量（{{unit}}）</th>
					<td><input type="text" name="planOwWordload" value="{{daily.planOwWordload}}" class="required number"/></td>
					<th>内业计划完成工作量（{{unit}}）</th>
					<td><input type="text" name="planIwWordload" value="{{daily.planIwWordload}}" class="required number"/></td>
					<th></th>
					<td></td>
				</tr>
			</table>
			
		</div>
		

		<div class="form_bottom">
			<a href="javascript:" ng-click="onSave()" class="title_save">
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;保存
			</a>
			<a href="javascript:" ng-click="onCancel()" class="title_cancel">
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;取消
			</a>
		</div>
		</form>
	</div>
</div>
<script type="text/javascript">
var isSave=false;
var validator;
var ngScope;
var userData;
simpleController({
	init:function($scope, $http){
		$scope.unit="";// 项目工作量单位
		$scope.kpiList = [];// 项目指标
		$scope.kpiTable = [];// 项目指标分行列排版
		$scope.pmBase={};// 项目信息
		$scope.iwProportion="";// 内业计划量
		$scope.owProportion="";// 外业计划量
		$scope.proPhase=0;// 项目阶段
		$scope.daily={};
		
		var userData = $scope.userData;
		var ticket = $scope.ticket;
		
		// 参数
		var params = getUrlParams();
		var proNo=params.proNo;
		var proName=params.proName;
		var reportDate=params.reportDate;
		$scope.owSumType=params.owSumType;
		if($scope.owSumType=='1' || $scope.owSumType=='2'){
			$("input[name=actualOwWordload]").attr("readonly", "readonly");
		}
		$("input[name=proNo]").val(proNo);
		$("input[name=proName]").val(proName);
		//var reportDate = new SimpleDateFormat({formatString:"yyyy-MM-dd"}).format(new Date());
		$("input[name=reportDate]").val(reportDate);
		
		
		/* 查询本日工作计划 */
		$scope.httpGet({
			url:"eap/pmsServices/pm/schedulePlan/scheduleDaily/lastDayWordload?proNo="+proNo+"&reportDate="+reportDate,
			success:function(response){
				$scope.planOwWordload=response.data.planOwWordload;
				$scope.planIwWordload=response.data.planIwWordload;
			}
		});
		
		/* 查询项目信息 */
		$scope.httpGet({
			url:"eap/pmsServices/pm/baseMgr/pmBase/get?proNo="+proNo,
			success:function(response){
				$scope.pmBase = response.data;
				$scope.proPhase = response.data.proPhase;
				$scope.unit=response.data.unitWorkload;
				$scope.loadKpiList($scope.pmBase.categoryCode);
			}
		});
		
		/* 获取日报信息 */
		$scope.httpGet({
			url:"eap/pmsServices/pm/schedulePlan/scheduleDaily/findByRowid?rowid="+params.rowid,
			success:function(response){
				$scope.daily = response.data;
				
				/* 查询指标信息 */
				$scope.httpGet({
					url:"eap/pmsServices/pm/schedulePlan/pmDayKpi/queryByProNoAndReportDate?proNo="+$scope.daily.proNo+"&reportDate="+$scope.daily.reportDate,
					success:function(response){
						$scope.kpiList = response.list;
						$scope.kpiTable = $scope.getKpiTable($scope.kpiList);
						$scope.doSum($scope.kpiList);
					}
				});
				
			}
		});
		
		

		
		/* 指标列表 
		$scope.loadKpiList=function(categoryCode){
			$scope.httpGet({
				url:"eap/pmsServices/pm/kpiLib/listAll",
				data:{"categoryCode":categoryCode},
				success:function(res){
					$scope.kpiList = res.list;
					$scope.kpiTable = $scope.getKpiTable($scope.kpiList);
				}
			});
		};*/
		
		/* Validate */
		validator = $("#saveForm").validate({
			onsubmit: false,
			focusInvalid: false,
			focusCleanup: true,
			errorElement: "span",
			ignore:".ignore",
			invalidHandler: function(form, validator) {
				var errors = validator.numberOfInvalids();
				if (errors) {
					
				} 
			}
		});

		/* 计算不折算的外业内业量 */
		$scope.doSum=function(arr){
			var outSum=0, inSum=0;
			var outKpi = $scope.getOut(arr);
			var inKpi = $scope.getIn(arr);
			/* 计算外业工作量 */
			var A=0,B=0,C=0;
			for(var i=0; i<outKpi.length; i++){
				var kpi = outKpi[i];
				if(kpi.mergeFlag == '2'){
					continue;// 不参与计算
				}
				if($scope.owSumType=='1'){// 江苏电缆探测ABC
					if(kpi.itemLabel=="A"){
						A+=kpi.kpiValue;
					}else if(kpi.itemLabel=="B"){
						B+=kpi.kpiValue;
					}else if(kpi.itemLabel=="C"){
						C+=kpi.kpiValue;
					}
				}else if($scope.owSumType=='2'){
					if(kpi.itemLabel=="A"){
						A+=kpi.kpiValue;
					}else if(kpi.itemLabel=="C"){
						C+=kpi.kpiValue;
					}
				}else{
					outSum+=kpi.kpiValue;
				}
			}
			if($scope.owSumType=='1'){// 江苏电缆探测ABC
				var cKm=C/40.0;
				if($scope.proPhase==3){
					cKm=C/25.0;
				}
				if(!(isNaN(A) || isNaN(B) || isNaN(C))){
					outSum=A+B+cKm;
				}
			}else if($scope.owSumType=='2'){// 山东电缆探测AC
				var cKm=C/40.0;
				if($scope.proPhase==3){
					cKm=C/25.0;
				}
				if(!(isNaN(A) || isNaN(C))){
					outSum=A+cKm;
					//$("#oSum").html(sum.toFixed(3));
				}
			}
			/* 计算内业工作量 */
			for(var i=0; i<inKpi.length; i++){
				var kpi = inKpi[i];
				if(kpi.mergeFlag == '2'){
					continue;// 不参与计算
				}
				inSum+=kpi.kpiValue;
			}
			$scope.outSum = decim(outSum, 2);
			$scope.inSum = decim(inSum, 2);
		};
		/* 计算外业量 */
		$scope.doItemSum=function(item){
			if(item.mergeFlag == '2'){
				return;// 不参与计算
			}
			if(item.kpiType==1){// 外业指标
				if($scope.owSumType=='1'){// 江苏电缆探测ABC
					var A = getItemVal($("input[itemlabel=A]"));
					var B = getItemVal($("input[itemlabel=B]"));
					var C = getItemVal($("input[itemlabel=C]"));
					$("input[name=actualOwCable]").val(A);
					$("input[name=actualOwLocate]").val(B);
					$("input[name=actualOwCard]").val(C);
					var cKm=C/40.0;
					if($scope.proPhase==3){
						cKm=C/25.0;
					}
					if(!(isNaN(A) || isNaN(B) || isNaN(C))){
						var sum=A+B+cKm;
						$("#oSum").html(sum.toFixed(3));
						var ow=A*0.4+B*0.1+cKm*0.4;
						$("input[name=actualOwWordload]").val(ow.toFixed(3))
						$("#actualOwWordload").html(ow.toFixed(3))
					}
				}else if($scope.owSumType=='2'){// 山东电缆探测AC
					var A = getItemVal($("input[itemlabel=A]"));
					var C = getItemVal($("input[itemlabel=C]"));
					$("input[name=actualOwCable]").val(A);
					$("input[name=actualOwCard]").val(C);
					var cKm=C/40.0;
					if($scope.proPhase==3){
						cKm=C/25.0;
					}
					if(!(isNaN(A) || isNaN(C))){
						var sum=A+cKm;
						$("#oSum").html(sum.toFixed(3));
						var ow=A*0.5+cKm*0.5;
						$("input[name=actualOwWordload]").val(ow.toFixed(3))
						$("#actualOwWordload").html(ow.toFixed(3))
					}
				}else{
					var oSum = getItemVal($("input[kpitype=1]"));
					$("input[name=actualOwWordload]").val(oSum.toFixed(3));
					$("#actualOwWordload").html(oSum.toFixed(3));
					$("#oSum").html(oSum.toFixed(3));
				}
			}else if(item.kpiType==2){// 内业指标
				var iSum = getItemVal($("input[kpitype=2]"));
				$("input[name=actualIwWordload]").val(iSum.toFixed(3));
				$("#actualIwWordload").html(iSum.toFixed(3));
				$("#iSum").html(iSum.toFixed(3));
			}
		};
		var getItemVal=function($selected){
			var itemVal=0;
			$selected.each(function(){
				var val = parseFloat($(this).val());
				if(isNaN(val)){
					val=0;
				}
				if($(this).attr("mergeflag") != '2'){// 不等于2参与求和，等于2不参与求和
					itemVal+=val;
				}
			});
			return itemVal;
		};
		
		/* 提交日报  */
		$scope.onSave = function(){
			var rpDate = $("input[name=reportDate]").val();
			var owSumType_t = $scope.owSumType;
			new ShowDlog().confirm({
				msg:"确定修改【"+rpDate+"】的日报内容吗？",
				ok:function(){
					
					$("input[name=companyCode]").val(userData.companyCode);
					var kpiData = "";
					$("input[group=kpi]").each(function(){
						var k = $(this).attr("name");
						var v = $(this).val();
						if(kpiData.length>0){
							kpiData+="&";
						}
						kpiData+=k+"="+v;
					});
					$("input[name=kpiData]").val(kpiData);
					var formData = $("#saveForm").serialize();
					
					if($("#saveForm").valid()){
						if(!isSave){
							isSave=true;
							$.ajax({
								url:serviceBasePath+"eap/pmsServices/pm/schedulePlan/scheduleDaily/update",
								cache:false,
								method:"POST",
								data:formData,
								success:function(res){
									if(res.statusCode==200){
										new ShowDlog().prompt({msg:"保存成功！",
												done:function(){
													hrefTo({
														url:"progressDaily.html",
														data:getUrlParams()
													});
												},
												t:1500
											});
										
									}
								},
								error:function(){
									
								}
							});
						}
					}
				}
			});
		};
		/* 取消 */
		$scope.onCancel = function(){
			//location.href="progressDaily.html";
			hrefTo({
				url:"progressDaily.html",
				data:getUrlParams()
			});
		}
		/* tool function */
		$scope.getOut=function(arr){
			var arrN=[];
			for(var i=0;i<arr.length;i++){
				var kpi = arr[i];
				if(kpi.isPerCnt==1){// 过滤人数
					continue;
				}
				if(kpi.kpiType==1){// 外业
					arrN.push(kpi);
				}
			}
			return arrN;
		};
		$scope.getIn=function(arr){
			var arrN=[];
			for(var i=0;i<arr.length;i++){
				var kpi = arr[i];
				if(kpi.isPerCnt==1){// 过滤人数
					continue;
				}
				if(kpi.kpiType==2){// 内业
					arrN.push(kpi);
				}
			}
			return arrN;
		};
		$scope.getExt=function(arr){
			var arrN=[];
			for(var i=0;i<arr.length;i++){
				var kpi = arr[i];
				if(kpi.isPerCnt==1){// 过滤人数
					continue;
				}
				if(kpi.kpiType==3){// 附属
					arrN.push(kpi);
				}
			}
			return arrN;
		};
		$scope.getKpiTable = function(arr){
			var trs = [];
			var outKpi = $scope.getOut(arr);
			var inKpi = $scope.getIn(arr);
			var extKpi = $scope.getExt(arr);
			trs.push({label:"外业指标", kpis:[]});
			for(var i=0;i<outKpi.length;i++){
				if(i!=0 && i%3==0){
					var tr = trs[trs.length-1];
					for(var j=tr.kpis.length;j<3;j++){
						tr.kpis.push({});
					}
					trs.push({label:"", kpis:[]});
				}
				var tr = trs[trs.length-1];
				tr.kpis.push(outKpi[i]);
			}
			var tr = trs[trs.length-1];
			for(var i=tr.kpis.length;i<3;i++){
				tr.kpis.push({});
			}
			trs.push({label:"内业指标", kpis:[]});
			for(var i=0;i<inKpi.length;i++){
				if(i!=0 && i%3==0){
					var tr = trs[trs.length-1];
					for(var j=tr.kpis.length;j<3;j++){
						tr.kpis.push({});
					}
					trs.push({label:"", kpis:[]});
				}
				var tr = trs[trs.length-1];
				tr.kpis.push(inKpi[i]);
			}
			var tr = trs[trs.length-1];
			for(var i=tr.kpis.length;i<3;i++){
				tr.kpis.push({});
			}
			if(extKpi.length>0){
				trs.push({label:"附属指标", kpis:[]});
				for(var i=0;i<extKpi.length;i++){
					if(i!=0 && i%3==0){
						var tr = trs[trs.length-1];
						for(var j=tr.kpis.length;j<3;j++){
							tr.kpis.push({});
						}
						trs.push({label:"", kpis:[]});
					}
					var tr = trs[trs.length-1];
					tr.kpis.push(extKpi[i]);
				}
				var tr = trs[trs.length-1];
				for(var i=tr.kpis.length;i<3;i++){
					tr.kpis.push({});
				}
			}
			return trs;
		};
		// END
	}
});
</script>
</body>
</html>
