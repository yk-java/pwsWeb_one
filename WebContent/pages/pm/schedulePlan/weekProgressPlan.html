<!DOCTYPE HTML>
<html>
<head>
<title> 人员管理</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<script type="text/javascript" src="../../../js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../../../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script></head>
<script type="text/javascript" src="../../../angular-1.4.6/angular.min.js"></script>
<script type="text/javascript" src="../../../js/PageBar.js"></script>
<script type="text/javascript" src="../../../js/DropDownList-1.2/DropDownList-v1.2.js"></script>
<link rel="stylesheet" type="text/css" href="../../../js/DropDownList-1.2/DropDownList.css" />
<script type="text/javascript" src="../../../js/Calendar.js"></script>
<script type="text/javascript" src="../../../js/SimpleDateFormat.js"></script>
<script type="text/javascript" src="../../../js/util.js"></script>
<script type="text/javascript" src="../../../js/ExportExcel.js"></script>
<script type="text/javascript" src="../../../js/config.js"></script>
<link rel="stylesheet" type="text/css" href="../../../css/list.css" />

<style type="text/css">
.good{background:url(../../../img/good.png) no-repeat top right;}
.low{background:url(../../../img/bad.png) no-repeat top right;}

.switch_btn_group{border:solid 1px #3385FF;min-height:30px;float:left;border-radius:15px; position:absolute;right:20px;top:0px;}
	.switch_btn_group a{display:inline-block;float:left;background:#fff;color:#3385FF;text-decoration:none;font-size:13px;
		line-height:30px;text-align:center;margin:0 1px 0 0;min-width:60px;}
	.switch_btn_group a.selected{background:#3385FF;color:#fff;}
	.switch_btn_group a:first-of-type{border-top-left-radius:15px;border-bottom-left-radius:15px;}
	.switch_btn_group a:last-of-type{border-top-right-radius:15px;border-bottom-right-radius:15px;margin:0;}
	
</style>
</head>

<body ng-app="userMgr" ng-controller="userMgrCtrl">

<div class="list" style="top:0;right:0">
	<div class="list_content">
		<div class="title_div" style="padding:13px 0 0 0;background:#fff;position:fixed;z-index:100">
			<div style="position:absolute;width:100%;">
				<div style="float:left;overflow:hidden">
					<div class="title_left">
<!-- 						<input type="text" class="dropDownList" id="proStatus" placeholder="项目状态"/> -->
						<input type="text" class="dropDownProjectType" placeholder="项目类别"/>
						<input type="text" style="width:206px;" class="dropDownTree dropDownList" placeholder="项目"/>
						<input type="text" id="beginDate" class="dateComponent" onclick="new Calendar().show(this)" placeholder="请选择启始日期"/>
						<input type="text" id="endDate" class="dateComponent" onclick="new Calendar().show(this)" placeholder="请选择结束日期"/>
						<input type="text" style="width:150px;" name="searchName" class="" placeholder="项目名、编码、负责人"/>
						<div class="query_div" ng-click="doQuery()">
							查询
						</div>
						<div class="query_div" ng-click="doExport()">
							导出
						</div>
						&nbsp;&nbsp;&nbsp;&nbsp;
					</div>
					<img src="../../../img/list_Header2-.png" style="margin-top:3px">
					
				</div>
				<div class="switch_btn_group">
					<a href="#" datatype="2" class="selected">已激活</a>
					<a href="#" datatype="3">已关闭</a>
				</div>
			</div>
		</div>
		
		<div class="table_div" style="position:absolute;top:55px;bottom:0;overflow:auto;margin-bottom:0;" >
			<div style="position:fixed;top:55px;right: 17px;left: 13px;">
				<table width="100%" border="0" cellspacing="0" cellpadding="0" class="table" id="dataTable">
				   <tr class="tr1">
					<th style="width:5%" rowspan="2"><div align="center">序号</div></th>
					<th style="width:15%" rowspan="2"><div align="center">项目名称</div></th>
					<th style="width:15%" rowspan="2"><div align="center">项目编号</div></th>
					<th style="width:5%" rowspan="2"><div align="center">负责人</div></th>
					
					<th style="background:#FFDF96;width:14%" colspan="3"><div align="center">本阶段完成工作量</div></th>
					<th style="background:#FFDF96;width:5%" rowspan="2"><div align="center">本阶段工时</div></th>

					<th style="background:#96BAFF;width:5%" rowspan="2"><div align="center">项目<br>累计工时</div></th>
<!-- 					<th style="background:#96BAFF;width:5%" rowspan="2"><div align="center">时间进度(%)</div></th> -->
					<th style="background:#96BAFF;width:5%" rowspan="2"><div align="center">项目<br>完成工作量</div></th>
					<th style="background:#96BAFF;width:5%" rowspan="2"><div align="center">项目<br>总工作量</div></th>
					<th style="background:#96BAFF;width:5%" rowspan="2"><div align="center">项目<br>完成进度</div></th>
	<!-- 				<th rowspan="2"><div align="center">相关操作</div></th> -->
				  </tr>
				   <tr class="tr1">
					<th style="background:#FFDF96;"><div align="center">外业</div></th>
					<th style="background:#FFDF96;"><div align="center">内业</div></th>
					<th style="background:#FFDF96;"><div align="center">总量</div></th>
					
				  </tr>
			  </table>
			</div>
			<table width="100%" border="0" cellspacing="0" cellpadding="0" class="table" id="dataTable2">
			   <tr class="tr1">
				<th style="width:5%" rowspan="2"><div align="center">序号</div></th>
				<th style="width:15%" rowspan="2"><div align="center">项目名称</div></th>
				<th style="width:15%" rowspan="2"><div align="center">项目编号</div></th>
				<th style="width:5%" rowspan="2"><div align="center">负责人</div></th>
				
				<th style="background:#FFDF96;width:14%" colspan="3"><div align="center">本阶段完成工作量</div></th>
				<th style="background:#FFDF96;width:5%" rowspan="2"><div align="center">本阶段工时</div></th>

				<th style="background:#96BAFF;width:5%" rowspan="2"><div align="center">项目<br>累计工时</div></th>
<!-- 				<th style="background:#96BAFF;width:5%" rowspan="2"><div align="center">时间进度(%)</div></th> -->
				<th style="background:#96BAFF;width:5%" rowspan="2"><div align="center">项目<br>完成工作量</div></th>
				<th style="background:#96BAFF;width:5%" rowspan="2"><div align="center">项目<br>总工作量</div></th>
				<th style="background:#96BAFF;width:5%" rowspan="2"><div align="center">项目<br>完成进度</div></th>
<!-- 				<th rowspan="2"><div align="center">相关操作</div></th> -->
			  </tr>
			   <tr class="tr1">
				<th style="background:#FFDF96;"><div align="center">外业</div></th>
				<th style="background:#FFDF96;"><div align="center">内业</div></th>
				<th style="background:#FFDF96;"><div align="center">总量</div></th>
				
			  </tr>
			  <tr class="tr2" ng-repeat="item in dataList">
				<td><div align="center">{{$index+1}}</div></td>
				
				<td><div align="center">{{item.proName}}</div></td>
				<td><div align="center">{{item.proCode}}</div></td>
				<td><div align="center">{{item.proManager}}</div></td>
				
				<td><div align="center">{{item.actualOwWordload}}</div></td>
				<td><div align="center">{{item.actualIwWordload}}</div></td>
				<td><div align="center">{{item.dayAccWordload}}</div></td>
				<td><div align="center">{{item.workHours}}</div></td>
				
<!-- 				<td><div align="center">{{item.dayAccmulativeProgress}}</div></td> -->
<!-- 				<td><div align="center">{{item.dayAccmulativeWordload}}</div></td> -->
				<td><div align="center">{{item.allWorkHours}}</div></td>
<!-- 				<td><div align="center">{{item.timeSchedule}}</div></td> -->
				<td><div align="center">{{item.allAccWordload}}</div></td>
				<td><div align="center">{{item.totalWorkload}}</div></td>
				<td><div align="center">{{item.allAccProgress?item.allAccProgress:0}}%</div></td>
<!-- 				<td> -->
<!-- 					<div align="center"> -->
<!-- 			    		<img class="operationImg" src="../../../img/list_see-icon.png"> -->
<!-- 			  		</div> -->
<!-- 				</td> -->
			  </tr>
			 
			</table>
		</div>

		<div id="page_bar" class="list_bottom" align="center">
		</div>

	</div>
</div>
<script type="text/javascript">
var cond_proStatus="2", cond_categoryCode="";
var cond_proNo="";
var cond_fromDate="";
var cond_toDate="";
	
var searchName="";	
var ngScope;
var app = angular.module("userMgr", []);
app.controller("userMgrCtrl", function($scope, $http){
	/* init */
	ngScope = $scope;
	$scope.curUnit={};
	$scope.dataList=[];
	
	
	/*****************************/
	var now = new Date();
	var year=now.getFullYear();
	var month=now.getMonth()+1;
	var sunday = getSunday(now);
	var saturday = getSaturday(now);
	
	
	cond_fromDate=new SimpleDateFormat({formatString:"yyyy-MM-dd"}).format(sunday);
	cond_toDate=new SimpleDateFormat({formatString:"yyyy-MM-dd"}).format(saturday);
	
	$("#beginDate").val(cond_fromDate);
	$("#endDate").val(cond_toDate);
	
	
	var userDataStr = $.cookie("pmsWeb_user_data");
	if(!userDataStr){
		
		noLogin(location.href);
		return;
	}
	var userData = jQuery.parseJSON(userDataStr);
	ticket = $.cookie("pmsWeb_ticket");
	
	
	$(".switch_btn_group>a").each(function(){
		$(this).click(function(){
			$(this).addClass("selected");
			$(this).siblings().removeClass("selected");
			cond_proStatus = $(this).attr("datatype");
			proList.setConfig("url", "../../component/projectList.html?categoryCode="+cond_categoryCode+"&proStatus="+cond_proStatus+"&ticket="+ticket);
			$scope.doQuery();
		});
		
	});
	
	/* 项目类型 */
	new DropDownList().init({
		renderTo:".dropDownProjectType",
		url:"../../component/projectType.html?ticket="+ticket,
		height:"200px",
		onSelected:function(result){
			$(".dropDownProjectType").val(result.categoryName);
			cond_categoryCode = result.categoryCode;
			/* 联动 */
			proList.setConfig("url", "../../component/projectList.html?categoryCode="+cond_categoryCode+"&proStatus="+cond_proStatus+"&ticket="+ticket);
		}
	});
	/* 项目列表 */
	var proList = new DropDownList();
	proList.init({
		renderTo:".dropDownTree",
		url:"../../component/projectList.html?categoryCode="+cond_categoryCode+"&ticket="+ticket,
		height:"200px",
		onSelected:function(result){
			$(".dropDownTree").val(result.proName);
			cond_proNo=result.proNo;
		}
	});
	
	$scope.loadData=function(proNo, fromDate, toDate, currentPage,searchName){//alert(unitCode);
		$http.get(serviceBasePath+"eap/pmsServices/pm/schedulePlan/scheduleSummary?proNo="+proNo+"&proStatus="+cond_proStatus+"&fromDate="+fromDate+"&toDate="
			+toDate+"&currentPage="+currentPage+"&searchName="+searchName+"&ticket="+ticket).success(function(response){
			if(response.statusCode!=200){
			//	alert("请求服务器失败！");
				response.list=[];
				//return;
			}
			$scope.dataList = response.list;
// 			createPageBar(response.totalPage, response.currentPage);
		});
	};
	
	$scope.doQuery=function(){
		cond_fromDate = $("#beginDate").val();
		cond_toDate = $("#endDate").val();
		searchName=$("input[name=searchName]").val();
		$scope.loadData(cond_proNo, cond_fromDate, cond_toDate, 1,searchName);
	};
	$scope.doExport=function(){
		excelExport("dataTable2");
	};
	$scope.loadData(cond_proNo, cond_fromDate, cond_toDate, 1,searchName);
	$scope.toZS=function(val){
		if(!val)return;
		if(val<0){
			val=val*-1;
		}
		return val.toFixed(3);
	};
});
</script>
</body>
</html>
