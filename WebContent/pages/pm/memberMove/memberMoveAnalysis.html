<!DOCTYPE HTML>
<html>
<head>
<title> 人员调动分析 </title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<script type="text/javascript" src="../../../js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../../../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../../angular-1.4.6/angular.min.js"></script>

<script type="text/javascript" src="../../../js/DropDownList-1.2/DropDownList-v1.2.js"></script>
<link rel="stylesheet" type="text/css" href="../../../js/DropDownList-1.2/DropDownList.css" />
<script type="text/javascript" src="../../../js/config.js"></script>

<link rel="stylesheet" type="text/css" href="../../../css/list.css" />
<script type="text/javascript" src="../../../js/Calendar.js"></script>
<script type="text/javascript" src="../../../js/echarts-all.js"></script>

<style type="text/css">
	.btn{display:inline-block;padding:1px 4px;border:solid 1px #f4f4f4; border-radius:4px;}
	.btn.toactive{color:#fff;background:green;}
	.btn.toclose{color:#fff;background:#ED7798;}
	
	.detailDialog{width:900px;height:400px;}
	td a{text-decoration:underline;color:blue;}
	.dialog-viewcyle{height:500px;width:700px;}
	.dialog-viewcyle1{height:600px;width:700px;}
	.echarts{width:100%;background:#E5F0FF;position: absolute;right:0px;bottom:0px;top:40px;}
	.chart1{width:45%;float:left;height:350px;background-color:#fff;margin-top:10px;margin-left:10px;}
	
	#chart1{width:100%;height:316px;overflow:hidden}
	#chart2{width:100%;height:316px;overflow:hidden}
	#chart3{width:100%;height:316px;overflow:hidden}
	#chart4{width:100%;height:316px;overflow:hidden}
	.chart2{width:45%;float:left;height:350px;background-color:#fff;margin-left:40px;margin-top:10px}
	.chart3{width:45%;float:left;height:350px;background-color:#fff;margin-top:20px;margin-left:10px;}
	.chart4{width:45%;float:left;height:350px;background-color:#fff;margin-top:20px;margin-left:40px}
	.title1{width:100%;height:26px;
	    border-bottom: solid 1px #FFE2B2;
	    border-left: solid 2px #3385FF;
	    line-height: 30px;
	}
</style>
</head>

<body ng-app="userMgr" ng-controller="userMgrCtrl">

<div class="list" id="list" style="bottom:0px;">
	<div class="list_content">
		<div class="title_div">
			<div class="title_left">
				<input type="text" class="dropDownArea" style="width:180px;" placeholder="请选择地区"/>
				<input type="text" id="starttime" name="starttime" class="date dateComponent" placeholder="请选择开始时间" onclick="new Calendar().show(this)" />
				<input type="text" id="endtime"   name="endtime" class="date dateComponent" placeholder="请选择结束时间" onclick="new Calendar().show(this)" />
				
				<div class="query_div" ng-click="doQuery()">
					查询
				</div>
				
				&nbsp;&nbsp;
			</div>
			<img src="../../../img/list_Header2-.png">
			
			
		</div>
		<style>
			ul,li{list-style:none;padding:0;margin:0}
			.tab_ct{float:right;margin-right:20px;}
			.tab_ct span{padding:4px 20px;cursor:pointer;border-radius:3px;}
			.tab_ct span.cur{background:#3385FF;color:#fff;}
			.dsn{display:none;}
			.spanmo ul{width:100%;margin:10px auto 0;}
			.spanmo ul li{line-height:30px;height:30px;}
			.spanmo ul li div{text-align:center;float:left;width:50%;}
			.spanmo ul li.li_firsr{background:#4ca9ff;color:#fff}
		</style>
		<div class="echarts">
			<div class="chart1 chart_tb">
				<div class="title1">
						&nbsp;
						<img src="../../../img/items_Sign.png">
						<label class="label_1">项目组调入统计</label>
						<div class="tab_ct" id="tab_ct1"> 
							<span class="cur">图表</span>
							<span>表格</span>
						</div>
					
				</div>
				
				<div class="t_c">
					<div id="chart1" class="spanmo"></div>
					<div id="table" class="spanmo dsn">
						<ul>
							<li class="li_firsr">
								<div>项目组</div><div>调入次数统计</div>
							</li>
							<li>
								<div>测试项目组1</div><div>1</div>
							</li>
							<li>
								<div>测试项目组2</div><div>1</div>
							</li>
							<li>
								<div>项测试项目组3</div><div>1</div>
							</li>
						</ul>
					</div>
				</div>
				
			</div>
			
			<div class="chart2 chart_tb">
				<div class="title1">
					&nbsp;
						<img src="../../../img/items_Sign.png">
						<label class="label_1">项目组调出统计</label>
						<div class="tab_ct" id="tab_ct2">
							<span class="cur">图表</span>
							<span>表格</span>
						</div>
				</div>
				<div class="t_c">
					<div id="chart2" class="spanmo"></div>
					<div id="table" class="spanmo dsn">
						<ul>
							<li class="li_firsr">
								<div>项目组</div><div>调出次数统计</div>
							</li>
							<li>
								<div>测试项目组1</div><div>1</div>
							</li>
							<li>
								<div>测试项目组2</div><div>1</div>
							</li>
							<li>
								<div>项测试项目组3</div><div>1</div>
							</li>
						</ul>
					</div>
				</div>
			</div>
			<div class="chart3 chart_tb">
				<div class="title1">
				
					&nbsp;
						<img src="../../../img/items_Sign.png">
						<label class="label_1">调动性质统计</label>
						<div class="tab_ct" id="tab_ct3">
							<span class="cur">图表</span>
							<span>表格</span>
						</div>
				</div>
				<div class="t_c">
					<div id="chart3" class="spanmo"></div>
					<div id="table" class="spanmo dsn">
						<ul>
							<li class="li_firsr">
								<div>项目组</div><div>调动性质</div>
							</li>
							<li>
								<div>测试项目组1</div><div>平调</div>
							</li>
							<li>
								<div>测试项目组2</div><div>平调</div>
							</li>
							<li>
								<div>项测试项目组3</div><div>平调</div>
							</li>
						</ul>
					</div>
				</div>
			</div>
			<div class="chart4 chart_tb">
				<div class="title1">
					
					&nbsp;
						<img src="../../../img/items_Sign.png">
						<label class="label_1">人员调入调出统计</label>
						<div class="tab_ct" id="tab_ct4">
							<span class="cur">图表</span>
							<span>表格</span>
						</div>
				</div>
				<div class="t_c">
					<div id="chart4" class="spanmo"></div>
					<div id="table" class="spanmo dsn">
						<ul>
							<li class="li_firsr">
								<div>项目组</div><div>人员调入调出次数统计</div>
							</li>
							<li>
								<div>测试项目组1</div><div>2</div>
							</li>
							<li>
								<div>测试项目组2</div><div>2</div>
							</li>
							<li>
								<div>项测试项目组3</div><div>2</div>
							</li>
						</ul>
					</div>
				</div>
			</div>
			
			
		</div>
		
		
		<script>
				function abc(did){
					$(did).find("span").each(function(index){
						$(this).click(function(){
							$(this).addClass("cur").siblings().removeClass("cur");
							$(this).parents(".chart1").attr("flag","true");
							$(this).parents(".chart2").attr("flag","true");
							$(this).parents(".chart3").attr("flag","true");
							$(this).parents(".chart4").attr("flag","true");
							var prc=$(this).parents(".chart_tb");
							if(prc.attr("flag") == "true")
							{
								$(prc).find(".spanmo").eq(index).show().siblings().hide();
							}
						})
					})
				}
				abc("#tab_ct1");
				abc("#tab_ct2");
				abc("#tab_ct3");
				abc("#tab_ct4");
			</script>
		
		

		

	</div>
</div>
<script type="text/javascript">




function getFirstAndLastMonthDay( year, month){    
               var   firstdate = year + '-' + month + '-01';  
               var  day = new Date(year,month,0);   
               var lastdate = year + '-' + month + '-' + day.getDate();//获取当月最后一天日期    
  //给文本控件赋值。同下  
               return lastdate;  
}

var ngScope;

var areaName="";
var fromDate="";
var toDate="";



var app = angular.module("userMgr", []);
app.controller("userMgrCtrl", function($scope, $http){
	/* init */
	ngScope = $scope;
	$scope.dataList=[];
	$scope.company1=[];
	$scope.num1=[];
	
	var userDataStr = $.cookie("pmsWeb_user_data");
	if(!userDataStr){
		
		noLogin(location.href);
		return;
	}
	var userData = jQuery.parseJSON(userDataStr);
	ticket = $.cookie("pmsWeb_ticket");
	
	var myDate = new Date();
	fromDate=myDate.getFullYear()+"-"+(myDate.getMonth()+1)+"-1";
	toDate=getFirstAndLastMonthDay(myDate.getFullYear(),myDate.getMonth()+1);
	
	$("#starttime").val(fromDate);
	$("#endtime").val(toDate);
	
	/* 区域 */
	new DropDownList().init({
		renderTo:".dropDownArea",
		url:"../../component/areaList.html?ticket="+ticket,
		height:"200px",
		onSelected:function(result){
			$(".dropDownArea").val(result.name);
			areaName=result.name;
			
		}
	});
	
	/* 调入 */
	$scope.loadProjects=function(areaName,fromDate,toDate){//alert(unitCode);
		
		$http.get(serviceBasePath+"eap/pmsServices/memberMove/memberMoveIn?fromDate="+fromDate+"&toDate="+toDate+"&areaName="+areaName).success(function(response){
			if(response.statusCode==401){
				alert("用户凭据过期！请重新登录！");
				window.noLogin(location.href);
				return;
			}
			$scope.dataList = response.list;
			//alert($scope.dataList.length);
			var num_1=[];
			var company_1=[];
			for(var i=0;i<response.list.length;i++){
				company_1.push(response.list[i].name);
				num_1.push(response.list[i].num);
			}
			$scope.company1=company_1;
			$scope.num1=num_1;
			var option1 = {
				
				title:{
					text: '单位(次)',
					textStyle:{
						fontSize:12
					}
				},
   
			    tooltip : {
			        trigger: 'axis'
			    },
			    calculable : true,
			  	 grid: { // 控制图的大小，调整下面这些值就可以，
		           
		             x: 35,
		             y:30,
		             x2: 30,
		             y2: 100,// y2可以控制 X轴跟Zoom控件之间的间隔，避免以为倾斜后造成 label重叠到zoom上
		             
		             borderColor:"#eee"
        		 },
			    xAxis : [
			        {
			            type : 'category',
			             axisLabel: {
				            rotate: 40
				        },
				        
			            data : company_1,
			            splitLine:{
			            	show:false
			            	
			            }
			        }
			    ],
			    yAxis : [
			        {
			            type : 'value',
			            
			        }
			    ],
			    series : [
			        {
			            name:'数量',
			            type:'bar',
			            data:num_1,
			            barWidth : 15,
			        }
			    ]
			};
                    
                    

			var chart = echarts.init(document.getElementById('chart1'));
			chart.setOption(option1);
			
// 			createPageBar(response.totalPage, response.currentPage);
		});
	};
	//调出
	$scope.loadProjects1=function(areaName,fromDate,toDate){//alert(unitCode);
		
		$http.get(serviceBasePath+"eap/pmsServices/memberMove/memberMoveOut?fromDate="+fromDate+"&toDate="+toDate+"&areaName="+areaName).success(function(response){
			if(response.statusCode==401){
				alert("用户凭据过期！请重新登录！");
				window.noLogin(location.href);
				return;
			}
			$scope.dataList = response.list;
			//alert($scope.dataList.length);
			var num_1=[];
			var company_1=[];
			for(var i=0;i<response.list.length;i++){
				company_1.push(response.list[i].name);
				num_1.push(response.list[i].num);
			}
			//$scope.company1=company_1;
			//$scope.num1=num_1;
			var option2 = {
   				
			    tooltip : {
			        trigger: 'axis'
			    },
			   title:{
					text: '单位(次)',
					textStyle:{
						fontSize:12
					}
				},
   
			    calculable : true,
			  	 grid: { // 控制图的大小，调整下面这些值就可以，
		           
		             x: 35,
		             y:30,
		             x2: 30,
		             y2: 100,// y2可以控制 X轴跟Zoom控件之间的间隔，避免以为倾斜后造成 label重叠到zoom上
        		 },
			    xAxis : [
			        {
			            type : 'category',
			             axisLabel: {
				            rotate: 40,
				        },
				        textStyle:{
				        	fontSize:8
				        },
			            data : company_1,
			            splitLine:{
			            	show:false
			            	
			            }
			        }
			    ],
			    yAxis : [
			        {
			            type : 'value'
			        }
			    ],
			    series : [
			        {
			            name:'数量',
			            type:'bar',
			            data:num_1,
			            barWidth : 15,
			        }
			    ]
			};
                    
                    

			var chart1 = echarts.init(document.getElementById('chart2'));
			chart1.setOption(option2);
			
// 			createPageBar(response.totalPage, response.currentPage);
		});
	};
	
	//根据调出性质统计
	$scope.loadProjects2=function(areaName,fromDate,toDate){//alert(unitCode);
		
		$http.get(serviceBasePath+"eap/pmsServices/memberMove/memberMoveChar?fromDate="+fromDate+"&toDate="+toDate+"&areaName="+areaName).success(function(response){
			if(response.statusCode==401){
				alert("用户凭据过期！请重新登录！");
				window.noLogin(location.href);
				return;
			}
			var list = response.list;
			//alert($scope.dataList.length);
			var temp=[];
			for(var i=0;i<list.length;i++){
				temp.push(list[i].name);
			}
			
			//$scope.company1=company_1;
			//$scope.num1=num_1;
			var option3 = {
				title:{
					text: '单位(次)',
					textStyle:{
						fontSize:12
					}
				},
			
					legend: {
				        orient : 'vertical',
				        x : 'right',
				        data:temp
				    },
				  tooltip : {
			        trigger: 'item',
			        formatter: "{a} <br/>{b} : {c} ({d}%)"
			      },
			    series : [
			        {
			            name:'访问来源',
			            type:'pie',
			            radius : '70%',
			            center: ['50%', '50%'],
			            data:list
			        }
			    ]
			};
			                    
                    

			var chart3 = echarts.init(document.getElementById('chart3'));
			chart3.setOption(option3);
			
// 			createPageBar(response.totalPage, response.currentPage);
		});
	};
	
	//人员调入调出
	$scope.loadProjects3=function(areaName,fromDate,toDate){//alert(unitCode);
		
		$http.get(serviceBasePath+"eap/pmsServices/memberMove/memberMoves?fromDate="+fromDate+"&toDate="+toDate+"&areaName="+areaName).success(function(response){
			if(response.statusCode==401){
				alert("用户凭据过期！请重新登录！");
				window.noLogin(location.href);
				return;
			}
			$scope.dataList = response.list;
			//alert($scope.dataList.length);
			var num_1=[];
			var company_1=[];
			for(var i=0;i<response.list.length;i++){
				company_1.push(response.list[i].name);
				num_1.push(response.list[i].num);
			}
			//$scope.company1=company_1;
			//$scope.num1=num_1;
			var option3 = {
   
			    tooltip : {
			        trigger: 'axis'
			    },
			    
			   grid: { // 控制图的大小，调整下面这些值就可以，
		           
		             x: 25,
		             y:10,
		             x2: 20,
		             y2: 50,// y2可以控制 X轴跟Zoom控件之间的间隔，避免以为倾斜后造成 label重叠到zoom上
        		 },
        		 
        		 title:{
					text: '单位(次)',
					textStyle:{
						fontSize:12
					}
				},
   
			    calculable : true,
			  	 grid: { // 控制图的大小，调整下面这些值就可以，
		           
		             x: 35,
		             y:30,
		             x2: 30,
		             y2: 50,// y2可以控制 X轴跟Zoom控件之间的间隔，避免以为倾斜后造成 label重叠到zoom上
        		 },
			    xAxis : [
			        {
			            type : 'category',
			             axisLabel: {
				            rotate: 70,
				        },
				        textStyle:{
				        	fontSize:8
				        },
			            data : company_1,
			            splitLine:{
			            	show:false
			            	
			            }
			        }
			    ],
			    yAxis : [
			        {
			            type : 'value'
			        }
			    ],
			    series : [
			        {
			            name:'数量',
			            type:'bar',
			            data:num_1,
			            barWidth : 15,
			        }
			    ]
			};
                    
                    

			var chart3 = echarts.init(document.getElementById('chart4'));
			chart3.setOption(option3);
			
// 			createPageBar(response.totalPage, response.currentPage);
		});
	};
	
	/* 查询 */
	$scope.doQuery=function(){
		//cond_proName = $("#searchName").val();
		//$scope.loadProjects(cond_areaName, cond_categoryCode, cond_proName, cond_proStatus, 1);
		fromDate=$("#starttime").val();
		toDate=$("endtime").val();
		
		$scope.loadProjects(areaName,fromDate,toDate);
		$scope.loadProjects1(areaName,fromDate,toDate);
		$scope.loadProjects2(areaName,fromDate,toDate);
		$scope.loadProjects3(areaName,fromDate,toDate);
	};
	

	
	
	
	
	/* 初始查询 */
	ngScope.loadProjects(areaName,fromDate,toDate);
	ngScope.loadProjects1(areaName,fromDate,toDate);
	ngScope.loadProjects2(areaName,fromDate,toDate);
	ngScope.loadProjects3(areaName,fromDate,toDate);
});
</script>
</body>
</html>
