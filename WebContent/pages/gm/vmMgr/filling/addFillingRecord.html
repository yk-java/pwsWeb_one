<!DOCTYPE HTML>
<html>
<head>
<title> 添加加油记录 </title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<script type="text/javascript" src="../../../../js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../../../../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../../../angular-1.4.6/angular.min.js"></script>
<script type="text/javascript" src="../../../../js/DropDownList-1.2/DropDownList-v1.2.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../js/DropDownList-1.2/DropDownList.css" />
<script type="text/javascript" src="../../../../js/Calendar.js"></script>
<script type="text/javascript" src="../../../../js/ng-base.js"></script>
<script type="text/javascript" src="../../../../js/config.js"></script>
<script type="text/javascript" src="../../../../js/util.js"></script>
<script type="text/javascript" src="../../../../js/eapJs/core/eap.core.js" ></script>
<script type="text/javascript" src="../../../../js/eapJs/plugins/eap.tip.js" ></script>
<script type="text/javascript" src="../../../../js/eapJs/plugins/eap.validate.js"></script>
<script type="text/javascript" src="../../../../js/eapJs/local/eap.lang-zh_CN.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../css/validate.css"/>
<link rel="stylesheet" type="text/css" href="../../../../css/edit.css"/>

<script type="text/javascript" src="../../../../js/showDlog/showDlog.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../js/showDlog/showDlog-blue.css" />
<script src="../../../../js/jquery-photo-gallery/jquery.photo.gallery.js"></script>


<style type="text/css">
	.sel{font-size: 11px;
    font-family: "微软雅黑";
    min-height: 27px;
    min-width: 204px;}
    
    
    .imgitem {
	height: 250px;
	width: 184px;
	border: 1px #ccc solid;
	float: left;
	margin-right: 1px;
	margin-left: 5px;
	margin-top: 5px;
}

.imgs {
	width: 184px;
	height: 250px;
	z-index: -1
}

.eidtdiv {
	margin-left:123px;
	text-align: center;
	padding-top: 4px;
	position: absolute;
	font-family: '微软雅黑';
	font-size: 12px;
	height: 23px;
	width: 60px;
	filter: alpha(Opacity = 80);
	-moz-opacity: 0.5;
	opacity: 0.5;
	
	background-color: black;
}
.titlemess{
	width:184px;
	height:50px;
	background:red;
	position: absolute;
	margin-top:-54px;
	filter: alpha(Opacity = 90);
	-moz-opacity: 0.9;
	opacity: 0.9;
	background-color: #E6E6E6;
	text-align: center;
	color:#999;
	font-size:18px;
	
}
.eidtdiv a {
	color: #fff;
	cursor: pointer;
}

.eidtdiv a:HOVER {
	color: #3385FF;
}

.imgitem:HOVER {
	border: 1px red solid;
	cursor: pointer;
}

#bg {
	display: none;
	position: absolute;
	top: 0%;
	left: 0%;
	width: 100%;
	height: 100%;
	background-color: black;
	z-index: 95;
	-moz-opacity: 0.5;
	opacity: .50;
	filter: alpha(opacity = 50);
	text-align: center
}

#show {
	display: none;
	position: absolute;
	top: 28%;
	left: 28%;
	bottom: 35%;
	right: 28%;
	border: 2px solid #E8E9F7;
	background-color: white;
	z-index: 96;
	overflow: hidden;
	text-align: center;
}

#show img {
	height: 100%;
	width: 100%
}

#btnclose {
	position: absolute;
	z-index: 90;
	right: 0px;
	top: 0px
}
</style>
</head>

<body ng-app="mdu" ng-controller="ctrl">

<div class="list">
	<div class="list_content">
		<div class="title_div">
			<div class="title_left">
				<label class="title">加油消费记录补充</label>
			</div>
			<img src="../../../../img/list_Header2-.png">
		</div>
		<div class="tabs">
			<a href="javascript:" for="#lay1" class="tab selected">基本信息</a>
<!-- 			<a href="javascript:" for="#lay2" class="tab">查看照片</a> -->
		</div>
		<form id="saveForm" class="required-validate">
		<div class="form_div" id="lay1">
			<table>
				<tr>
					<th>用车类型</th>
					<td width="300">
						<input type="hidden" name="useType"/>
						<input type="text" name="useTypeName" class="required dropDownList" placeholder="请选择" /></td>
					<th>
						<span ng-show="useType==1">所属项目</span>
						<span ng-show="useType==2">所属部门</span>
					</th>
					<td width="300">
						<div ng-show="useType==1">
							<input type="hidden" name="proNo"/>
							<input type="text" name="proName"  class="{{useType==1?'required':''}} dropDownList" placeholder="请选择" />
						</div>
						<div ng-show="useType==2">
							<input type="hidden" name="deptNo" />
							<input type="text" name="deptName"  class="{{useType==2?'required':''}} dropDownList" placeholder="请选择" />
						</div>
					</td>
				</tr>
				<tr>
					<th>加油卡号</th>
					<td>
						<input type="text" name="cardNo" class="readonly" readonly="readonly" value="{{sinopecBill.cardNo}}"/>
					</td>
					<th>车牌号</th>
					<td>
						<input type="text" name="plateNo" class="required" />
					</td>
				</tr>
				<tr>
					<th>金额</th>
					<td><input type="text" name="amount" class="required number readonly" readonly="readonly" value="{{sinopecBill.amount}}"/></td>
					<th>加油时间</th>
					<td><input type="text" name="fillingTime" class="required dateComponent readonly" readonly="readonly" value="{{sinopecBill.recTime}}" /></td>
				</tr>
				<tr>
					<th>加油站点</th>
					<td colspan="3"><input type="text" name="place"  value="{{sinopecBill.address}}"/></td>
				</tr>
				<tr>
					<th>备注</th>
					<td colspan="3">
						<textarea name="remarks" class="remarks" style="width:560px;height:80px;"></textarea>
					</td>
				</tr>
			</table>
		</div>
<!-- 		<div class="form_div" id="lay2" style="height:260px;"> -->
<!-- 			<div class="imgitem gallerys" ng-repeat="item in fillingRecord.picItems"> -->
<!-- 				<img src="{{item.url}}" id="pic_{{$index}}" class="imgs gallery-pic" onerror="javascript:this.src='../../../../img/defaultImg02.png';"	onclick="$.openPhotoGallery(this, '../../../../js/jquery-photo-gallery/gallery.html')" /> -->
<!-- 			</div> -->
<!-- 		</div> -->

		<div class="form_bottom">
			<a href="javascript:" ng-click="onSave()" class="title_save">
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;保存
			</a>
			<a href="javascript:" ng-click="onCancel()" class="title_cancel">
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;取消
			</a>
		</div>
		</form>
	</div>
</div>
<script type="text/javascript">
simpleController({
	moduleName:"mdu",
	controllerName:"ctrl",
	init:function($scope, $http){
		/* init */
		$scope.sinopecBill={};
		$scope.useType = 1;
		var params = getUrlParams();
		
		
		/* 用车类型 */
		new DropDownList().init({
			renderTo:"input[name=useTypeName]",
			data:[{id:1, name:"项目用车"}, {id:2, name:"部门用车"}],
			textField:"name",
			onSelected:function(result){
				$("input[name=useType]").val(result.id);
				$("input[name=useTypeName]").val(result.name);
				$("input[name=useTypeName]").focus();
				callNgFn({ctrlEl:$("body")[0], ngFn:function(scope){
					scope.useType=result.id;
				}});
			}
		});
		
		/* 项目 */
		new DropDownList().init({
			renderTo:"input[name=proName]",
			url:"../../../component/projectList.html",
			textField:"name",
			onSelected:function(result){
				$("input[name=proNo]").val(result.proNo);
				$("input[name=proName]").val(result.proName);
				$("input[name=proName]").focus();
			}
		});
		
		/* 部门 */
		new DropDownList().init({
			renderTo:"input[name=deptName]",
			url:"../../../component/orgTree.html",
			textField:"name",
			onSelected:function(result){
				$("input[name=deptNo]").val(result.unitCode);
				$("input[name=deptName]").val(result.unitName);
				$("input[name=deptName]").focus();
			}
		});
		
		/* 数据加载 */
		$scope.loadData = function(){
			$scope.httpGet({
				url:"eap/pmsServices/gm/vm/filling/getSinopecBill",
				data:{rowid:params.rowid},
				success:function(response){
					$scope.sinopecBill = response.data;
				}			
			});
		};
		/* 初始加载 */
		$scope.loadData();
		
		
		/* Validate */
		validator = $("#saveForm").validate({
			onsubmit: false,
			focusInvalid: false,
			focusCleanup: true,
			errorElement: "span",
			ignore:".ignore",
			invalidHandler: function(form, validator) {
				var errors = validator.numberOfInvalids();
				if (errors) {
					
				} 
			}
		});
		
		/* 保存 */
		$scope.onSave = function(){
			var formData = serializeArrayToMap($("#saveForm").serializeArray());
			if($("#saveForm").valid()){
				new ShowDlog().prompt({
					icon:"waitting",
					msg:"正在提交...",
					t:1000*60,
					done:function(){}
				});
				$scope.httpPost({
					url:"eap/pmsServices/gm/vm/filling/add",
					data:formData,
					success:function(response){
						$dlog.close();
						new ShowDlog().prompt({
							icon:"success",
							msg:"修改成功！",
							done:function(){
								parent.$dlog.data="SUCCESS";
								parent.$dlog.close();
							},
							t:1500
						});
					},
					error:function(){}
				});
			}
		};
		
		/* 取消 */
		$scope.onCancel = function(){
			parent.$dlog.data="CANCEL";
			parent.$dlog.close();
		};
	}
});
</script>
</body>
</html>
