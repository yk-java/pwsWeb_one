<!DOCTYPE HTML>
<html>
<head>
<title>资产管理</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<link rel="stylesheet" type="text/css" href="../../../../css/list.css" />
<link rel="stylesheet" type="text/css" href="../../../../js/showDlog/showDlog-blue.css" />

<script type="text/javascript" src="../../../../js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../../../../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../../../angular-1.4.6/angular.min.js"></script>
<script type="text/javascript" src="../../../../js/PageBar.js"></script>
<script type="text/javascript" src="../../../../js/DropDownList-1.2/DropDownList-v1.2.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../js/DropDownList-1.2/DropDownList.css" />
<script type="text/javascript" src="../../../../js/config.js"></script>
<script type="text/javascript" src="../../../../js/DropDownList-1.2/DropDownList-v1.2.js"></script>
<script type="text/javascript" src="../../../../js/showDlog/showDlog.js"></script>
<script type="text/javascript" src="../../../../js/util.js"></script>
<script type="text/javascript" src="../../../../js/Calendar.js"></script>


<script type="text/javascript" src="../../../../js/eapJs/core/eap.core.js" ></script>
<script type="text/javascript" src="../../../../js/eapJs/plugins/eap.tip.js" ></script>
<script type="text/javascript" src="../../../../js/eapJs/plugins/eap.validate.js"></script>
<script type="text/javascript" src="../../../../js/eapJs/local/eap.lang-zh_CN.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../css/validate.css"/>
<script type="text/javascript" src="../../../../js/showDlog/showDlog.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../js/showDlog/showDlog-blue.css" />

<script src="../../../../js/jquery-photo-gallery/jquery.photo.gallery.js"></script>

<style type="text/css">
	.dropDownArea{background-image:url(../../../../img/flag.png);background-repeat: no-repeat;background-position:right;background-position:185px;cursor:pointer;}
	
	.btn{display:inline-block;padding:1px 4px;border:solid 1px #f4f4f4; border-radius:4px;}
	.btn.toactive{color:#fff;background:green;}
	.btn.toclose{color:#fff;background:#ED7798;}
	.ck{border:1px #fff solid;background:#fff;margin-top:5px}
	.cks{float:left;height:20px;}
	.cks .ck{float:left;margin-top:15px;margin-left:10px;}
	.cks span{float:left;margin-top:5px;}
    .dialog-viewcode{width:500px;height:400px;}
    .dialog-viewcyle{width:900px;height:500px;}
    .dialog-scrap{width:480px;height:320px;}
    .dialog-scrap1{width:480px;height:300px;}
    .dialog-asset{height:600px;width:500px;}
    
    
    .title_div2{border:solid 0px red;background:#4CA9FF;padding:8px 6px 8px 6px;}
.title_div2 .condLayer1{display:block;border:solid 0px;margin:6px;}
.title_div2 .condLayer2{border:solid 0px green;margin:6px;}
.title_div2 .condLayer1 input{height:28px;line-height:28px;border:solid 1px #f4f4f4;color:#666;margin:0 4px;padding:0 4px;font-family:微软雅黑;}
.title_div2 .condLayer2 input{height:28px;line-height:28px;border:solid 1px #f4f4f4;color:#666;margin:0 4px;padding:0 4px;background-color:#DAEDFF;font-family:微软雅黑;}
.title_div2 .btn{display:inline-block;height:30px;line-height:30px;margin:0 4px;padding:0 15px 0 15px;background:#f4f4f4;color:#666;font-weight:bold;cursor:pointer;border:solid 1px #89C6FF; border-radius:4px;}
.title_div2 .blue{background:#3385FF;color:#fff;}
.title_div2 .blue:hover{background:#186CE7;}
.title_div2 .pink{background:#ED7798;color:#fff;}
.title_div2 .pink:hover{background:#E54673;}
    .qiehuan {
    line-height: 25px;
    border-radius: 20px;
    border: 1px solid white;
    margin-top: 16px;
    overflow: hidden;
    margin-left: 16px;
    margin-right: 16px;
    width:150px;
    height:25px;
    float:right;
    margin-top:0px;
    margin-right:-2px;
   
}

.qiehuan .tong_zhi, .qiehuan .fang_an, .qiehuan .zhi_nan {
    float: left;
    width: 32.7%;
    text-align: center;
}
.tong_zhi {
    font-size:12px;
    color: #288df5;
    background-color: white;
     border-right: 1px solid white;
}
.fang_an {
    font-size:12px;
    color: white;
    border-right: 1px solid white;
    
}
.zhi_nan {
   font-size:12px;
    color: white;
}
a{
    text-decoration: none;
    cursor: pointer;
}

.proType{
	display: none
}
.proNameD{
	display: none
}
.unitcode{
display: none
}

.more{position:absolute; margin-top:8px;}
.operates{
	position: absolute;
	z-index: 9999;
	height:165px;
	width:95px;
	background-image: url(../../../../img/asset/round.png);
	text-align: left;
	padding-top:12px;
	margin-left:45px;
	display: none
}
.operates p{margin:0px;padding-left:8px;height:23px;padding-top:3px;cursor: pointer;}
.operates p:HOVER{background:#d3dff1;}
.operates p img{float:left;margin-top:1px;}
.bor{border-bottom:1px solid #eee}
.btnmore{position: absolute;margin-top:2px;}
.dlog-showPic{width:90%;min-height:500px}

   .imgitem {
		height: 250px;
		width: 184px;
		border: 1px #ccc solid;
		float: left;
		margin-right: 1px;
		margin-left: 5px;
		margin-top: 5px;
	}
	
	
	.imgs {
	width: 184px;
	height: 250px;
	z-index: -1
}

.eidtdiv {
	margin-left: 55px;
	text-align: center;
	padding-top: 8px;
	position: absolute;
	font-family: '微软雅黑';
	font-size: 12px;
	height: 27px;
	width: 80px;
	filter: alpha(Opacity = 80);
	-moz-opacity: 0.5;
	opacity: 0.5;
	
	background-color: black;
}
.titlemess{
	width:184px;
	height:50px;
	background:red;
	position: absolute;
	margin-top:-54px;
	filter: alpha(Opacity = 90);
	-moz-opacity: 0.9;
	opacity: 0.9;
	background-color: #E6E6E6;
	text-align: center;
	color:#999;
	font-size:18px;
	
}
.eidtdiv a {
	color: #fff;
	cursor: pointer;
}

.eidtdiv a:HOVER {
	color: #3385FF;
}

.imgitem:HOVER {
	border: 1px red solid;
	cursor: pointer;
}

</style>
</head>

<body ng-app="userMgr" ng-controller="userMgrCtrl">
<form id="saveForm" class="required-validate">
<div class="list">
	<div class="list_content">
		<div class="title_div2">
			<div class="condLayer1">
				 <input type="text" id="starttime" style="width:110px" name="fromDate" class="date dateComponent" placeholder="开始时间" onclick="new Calendar().show(this)" />
			     <input type="text" id="endtime"  style="width:110px"  name="toDate" class="date dateComponent" placeholder="结束时间" onclick="new Calendar().show(this)" />
				&nbsp;&nbsp;
				<div class="btn blue" ng-click="doQuery()">
					查询
				</div>
			</div>
			
		</div>
		
		<div class="table_div" style="margin-top: 50px;">
			<div class="imgitem gallerys" ng-repeat="item in imgList2">
				<div class="eidtdiv">
					<a ng-click="showdiv($index,item.picTitle)">放大</a>
				</div>
				<img src="{{item.url}}" id="pic_{{$index}}" onerror="javascript:this.src='../../../../img/defaultImg02.png';" class="imgs gallery-pic"
					ondblclick="$.openPhotoGallery(this)" />
				<div class="titlemess">
					<p>{{item.sysCreateTime}}</p>
				</div>
			</div>
			
			<div style="clear: both;"></div>
		</div>
		
		<div id="page_bar" class="list_bottom" align="center" style="margin-top: 60px;">
		</div>

	</div>
</div>
</form>
<script type="text/javascript">

function getUrlParams(){
	var params={};
	var url = location.href;
	var start = url.indexOf("?", 0)+1;
	var paramsStr = url.substring(start, url.length);
	var paramsArr = paramsStr.split("&");
	for(var i=0;i<paramsArr.length;i++){
		var kv = paramsArr[i].split("=");
		var k = kv[0];
		var v = kv[1];
		params[k]=v;
	}
	return params;
}

function createPageBar(totalPage, curPage,totalRecord){
	new PageBar().init({
		renderTo:"#page_bar",
		totalPage:totalPage,
		curPage:curPage,
		totalRecord:totalRecord,
		prevPageText:"上一页",
		nextPageText:"下一页",
		showPageInfo:true,
		onPage:function(pageNum){
			_currentPage=pageNum;
			ngScope.loadProjects(assetCode,fromDate,toDate,pageNum);
		}
	});
}

var searchName="";
var assetTypeCode="";
var assetTypeName="";
var assetClassCode="";
var assetClassName="";
var proNo="";
var proName="";
var category_Code="";
var category_Name="";
var proTypes;
var ngScope;
var droptype;
var price1="";
var price2="";
var fromDate="";
var toDate="";
var validator;

var loanUnitCode="";
var loanUnitName="";
var assetCode="";

var app = angular.module("userMgr", []);
app.controller("userMgrCtrl", function($scope, $http){
	/* init */
	ngScope = $scope;
	$scope.imgList2=[];
	
	var userDataStr = $.cookie("pmsWeb_user_data");
	if(!userDataStr){
		noLogin(location.href);
		return;
	}
	var userData = jQuery.parseJSON(userDataStr);
	ticket = $.cookie("pmsWeb_ticket");
	
	var params = getUrlParams();
	if(params){
		if(params.assetCode){
			assetCode=params.assetCode;
		}
		
	}
	
	/* 加载数据 */
	$scope.loadProjects=function(assetCode,fromDate,toDate,currentPage){
			$http.get(serviceBasePath+"eap/pmsServices/materielMg/assetMg/assetCheck/queryImages?assetCode="
			+assetCode+"&ticket="+ticket+"&fromDate="+fromDate+"&toDate="+toDate+"&currentPage="+currentPage).success(function(response){
			if(response.statusCode==401){
				alert("用户凭据过期！请重新登录！");
				window.top.location.href="../../../../login.html";
				return;
			}
			console.log(response.list);
			$scope.imgList2=[];
			var cPath=filePath+"?attachment=0&fileCode=";	
			for(var i=0;i<response.list.length;i++)
			{
				var cDate=response.list[i];
				if(cDate.PIC1!=undefined && cDate.PIC1!='')
					$scope.imgList2.push({url:cPath+cDate.PIC1,picTitle:'图片'+(i+1),'sysCreateTime':cDate.CHECK_DEAL_DATE});
				if(cDate.PIC2!=undefined && cDate.PIC2!='')
					$scope.imgList2.push({url:cPath+cDate.PIC2,picTitle:'图片'+(i+2),'sysCreateTime':cDate.CHECK_DEAL_DATE});
				if(cDate.PIC3!=undefined && cDate.PIC3!='')
					$scope.imgList2.push({url:cPath+cDate.PIC3,picTitle:'图片'+(i+3),'sysCreateTime':cDate.CHECK_DEAL_DATE});	
			}
			createPageBar(response.totalPage, response.currentPage,response.totalRecord);
		});
			
	};
	
	$scope.showdiv=function(index, title){
		//alert(index);
		var img1=$("#pic_"+index);
		$.openPhotoGallery(img1, '../../../../js/jquery-photo-gallery/gallery.html?picTitle='+title); 
	
	};
	
	
	/* 查询 */
	$scope.doQuery=function(){
		if($("#saveForm").valid()){
			fromDate=$("input[name=fromDate]").val();
		    toDate=$("input[name=toDate]").val();
		    $scope.loadProjects(assetCode,fromDate,toDate,1);
		}
	};
	
	

	
	/* 条形码 */
	$scope.viewCode=function(item){
		//	$("#main_frame").attr("src", "../sys/resetPwd.html");
		new ShowDlog().showFrame("viewCode.html?assetCode="+item.assetCode, "条形码", function(){
						// 
		},"dialog-viewcode");
		
	};
	
	/*盘点图片查看*/
	$scope.viewCheckPic=function(item)
	{
		console.log(item);
		new ShowDlog().showFrame("imags.html?assetCode="+item.assetCode, "查看图片", function(){}, "dlog-showPic");
	}
		
	/* 初始查询 */
	ngScope.loadProjects(assetCode,"","",1);
});
</script>
</body>
</html>
