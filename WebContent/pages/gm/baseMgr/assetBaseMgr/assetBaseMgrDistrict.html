<!DOCTYPE HTML>
<html>
<head>
<title>资产管理</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<link rel="stylesheet" type="text/css" href="../../../../css/list.css" />
<link rel="stylesheet" type="text/css" href="../../../../js/showDlog/showDlog-blue.css" />

<script type="text/javascript" src="../../../../js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../../../../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../../../angular-1.4.6/angular.min.js"></script>
<script type="text/javascript" src="../../../../js/PageBar.js"></script>
<script type="text/javascript" src="../../../../js/DropDownList-1.2/DropDownList-v1.2.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../js/DropDownList-1.2/DropDownList.css" />
<script type="text/javascript" src="../../../../js/config.js"></script>
<script type="text/javascript" src="../../../../js/DropDownList-1.2/DropDownList-v1.2.js"></script>
<script type="text/javascript" src="../../../../js/showDlog/showDlog.js"></script>
<script type="text/javascript" src="../../../../js/util.js"></script>
<script type="text/javascript" src="../../../../js/Calendar.js"></script>


<script type="text/javascript" src="../../../../js/eapJs/core/eap.core.js" ></script>
<script type="text/javascript" src="../../../../js/eapJs/plugins/eap.tip.js" ></script>
<script type="text/javascript" src="../../../../js/eapJs/plugins/eap.validate.js"></script>
<script type="text/javascript" src="../../../../js/eapJs/local/eap.lang-zh_CN.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../css/validate.css"/>
<script type="text/javascript" src="../../../../js/showDlog/showDlog.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../js/showDlog/showDlog-blue.css" />
<style type="text/css">
	.dropDownArea{background-image:url(../../../../img/flag.png);background-repeat: no-repeat;background-position:right;background-position:185px;cursor:pointer;}
	
	.btn{display:inline-block;padding:1px 4px;border:solid 1px #f4f4f4; border-radius:4px;}
	.btn.toactive{color:#fff;background:green;}
	.btn.toclose{color:#fff;background:#ED7798;}
	.ck{border:1px #fff solid;background:#fff;margin-top:5px}
	.cks{float:left;height:20px;}
	.cks .ck{float:left;margin-top:15px;margin-left:10px;}
	.cks span{float:left;margin-top:5px;}
    .dialog-viewcode{width:500px;height:400px;}
    .dialog-viewcyle{width:900px;height:500px;}
    .dialog-scrap{width:480px;height:320px;}
    .dialog-scrap1{width:480px;height:300px;}
    .dialog-asset{height:600px;width:500px;}
    
    
    .title_div2{border:solid 0px red;background:#4CA9FF;padding:8px 6px 8px 6px;}
.title_div2 .condLayer1{display:block;border:solid 0px;margin:6px;}
.title_div2 .condLayer2{border:solid 0px green;margin:6px;}
.title_div2 .condLayer1 input{height:28px;line-height:28px;border:solid 1px #f4f4f4;color:#666;margin:0 4px;padding:0 4px;font-family:微软雅黑;}
.title_div2 .condLayer2 input{height:28px;line-height:28px;border:solid 1px #f4f4f4;color:#666;margin:0 4px;padding:0 4px;background-color:#DAEDFF;font-family:微软雅黑;}
.title_div2 .btn{display:inline-block;height:30px;line-height:30px;margin:0 4px;padding:0 15px 0 15px;background:#f4f4f4;color:#666;font-weight:bold;cursor:pointer;border:solid 1px #89C6FF; border-radius:4px;}
.title_div2 .blue{background:#3385FF;color:#fff;}
.title_div2 .blue:hover{background:#186CE7;}
.title_div2 .pink{background:#ED7798;color:#fff;}
.title_div2 .pink:hover{background:#E54673;}
    .qiehuan {
    line-height: 25px;
    border-radius: 20px;
    border: 1px solid white;
    margin-top: 16px;
    overflow: hidden;
    margin-left: 16px;
    margin-right: 16px;
    width:150px;
    height:25px;
    float:right;
    margin-top:0px;
    margin-right:-2px;
   
}

.qiehuan .tong_zhi, .qiehuan .fang_an, .qiehuan .zhi_nan {
    float: left;
    width: 32.7%;
    text-align: center;
}
.tong_zhi {
    font-size:12px;
    color: #288df5;
    background-color: white;
     border-right: 1px solid white;
}
.fang_an {
    font-size:12px;
    color: white;
    border-right: 1px solid white;
    
}
.zhi_nan {
   font-size:12px;
    color: white;
}
a{
    text-decoration: none;
    cursor: pointer;
}

.unitcode{
display: none
}

.more{position:absolute; margin-top:8px;}
.operates{
	position: absolute;
	z-index: 9999;
	height:165px;
	width:95px;
	background-image: url(../../../../img/asset/round.png);
	text-align: left;
	padding-top:12px;
	margin-left:45px;
	display: none
}
.operates p{margin:0px;padding-left:8px;height:23px;padding-top:3px;cursor: pointer;}
.operates p:HOVER{background:#d3dff1;}
.operates p img{float:left;margin-top:1px;}
.bor{border-bottom:1px solid #eee}
.btnmore{position: absolute;margin-top:2px;}
.dlog-showPic{width:80%;min-height:600px}
</style>
</head>

<body ng-app="userMgr" ng-controller="userMgrCtrl">
<form id="saveForm" class="required-validate">
<div class="list">
	<div class="list_content">
		<div class="title_div2">
			<div class="condLayer1">
				<input type="text" style="width:110px" id="dropDownProjectType" class="dropDownList" placeholder="请选择资产分类"/>
				<input type="text" style="width:110px" id="dropDownProjectType1" class="dropDownList" placeholder="请选择资产类型"/>
				<input type="text" style="width:110px" class="proType dropDownList" placeholder="请选择项目类别"/>
				<input type="text"  class="proNameD dropDownList" placeholder="请选择项目"/>
				
				
			    <input type="text" style="width:120px"  name="searchName" placeholder="请输入查询条件"/>
				
				&nbsp;&nbsp;
				
					<div class="btn blue" ng-click="doQuery()">
					查询
				</div>
			</div>
			<div class="condLayer2" style="height:30px;padding-top:5px;">
			   
			   <div style="float:left">
			   <input type="text" id="starttime" style="width:110px" name="fromDate" class="date dateComponent" placeholder="采购开始时间" onclick="new Calendar().show(this)" />
			   <input type="text" id="endtime"  style="width:110px"  name="toDate" class="date dateComponent" placeholder="采购结束时间" onclick="new Calendar().show(this)" />
				
				
				<input type="text" style="width:110px" class="number"  name="price1" placeholder="请输入价格区间"/>
				<input type="text" style="width:110px" class="number"  name="price2" placeholder="请输入价格区间"/>
				</div>
				
				<div class="cks">
					<input name="sta" ng-click="getSta1()" class="ck" type="checkbox" value="0" id="sta1" checked="checked" /> <span>全部</span>
					<input name="sta" ng-click="getSta()" class="ck" type="checkbox" value="1" checked="checked" /> <span>闲置</span>
					<input name="sta" ng-click="getSta()" class="ck" type="checkbox" value="3" checked="checked" /> <span>项目</span>
					<input name="sta" ng-click="getSta()" class="ck" type="checkbox" value="4" checked="checked" /> <span>项目维修</span>
					<input name="sta" ng-click="getSta()" class="ck" type="checkbox" value="6" checked="checked" /> <span>待报废</span>
					<input name="sta" ng-click="getSta()" class="ck" type="checkbox" value="7" checked="checked" /> <span>已报废</span>
					<input name="sta" ng-click="getSta()" class="ck" type="checkbox" value="8" checked="checked" /> <span>总部仓库闲置</span>
				</div>
			</div>
			
		</div>
		
		<div class="table_div">
			<table width="100%" border="0" cellspacing="0" cellpadding="0" class="table">
			   <tr class="tr1">
				<th><div align="center">序号</div></th>
				<th><div align="center">资产编号</div></th>
				<th><div align="center">资产名称</div></th>
				<th><div align="center">资产分类</div></th>
				<th><div align="center">含税单价</div></th>
				<th><div align="center">不含税单价</div></th>
				<th><div align="center">采购时间</div></th>
				<th><div align="center">入库时间</div></th>
				<th><div align="center">报废时间</div></th>
				<th width="10%"><div align="center">项目</div></th>
				<th><div align="center">使用人</div></th>
				<th><div align="center">品牌</div></th>
				<th><div align="center">型号</div></th>
				<th><div align="center">资产内容</div></th>
				<th width="120"><div align="center">操作</div></th>
			  </tr>
			  <tr class="tr2" ng-repeat="item in projectList">
				<td><div align="center">{{$index+1}}</div></td>
				<td><div align="center">{{item.assetCode}}</div></td>
				<td><div align="center">{{item.assetName}}</div></td>
				<td><div align="center">{{item.assetClassName}}</div></td>
				<td><div align="center">{{item.price1}}</div></td>
				<td><div align="center">{{item.price2}}</div></td>
				<td><div align="center">{{item.datePurchase=="0000-00-00"?'':item.datePurchase}}</div></td>
				<td><div align="center">{{item.dateStorage=="0000-00-00"?'':item.dateStorage}}</div></td>
				<td><div align="center">{{item.dateDump=="0000-00-00"?'':item.dateDump}}</div></td>
				<td ng-if="item.status==1" style="background:#FF9B7E">
					<div  align="center">闲置</div>
				</td>
				<td ng-if="item.status==2" style="background:#dbc5f5">					
					<div  align="center">{{item.loanUnitName}}</div>
				</td>
				<td ng-if="item.status==3" style="background:#dbc5f5">					
					<div  align="center">{{item.loanProName}}</div>
				</td>
				<td ng-if="item.status==4" style="background:#7FBDFF">					
					<div  align="center">项目维修</div>
				</td>
				<td ng-if="item.status==5" style="background:#7FBDFF">					
					<div  align="center">维修</div>
				</td>
				<td ng-if="item.status==6" style="background:#FF7EA5">					
					<div  align="center">待报废</div>
				</td>
				<td ng-if="item.status==7" style="background:#e5e5e5">					
					<div  align="center">已报废</div>
				</td>
				<td ng-if="item.status==8" style="background:#00CC33">					
					<div  align="center">总部仓库闲置</div>
				</td>
				<td><div align="center">{{item.loanEmployeename}}</div></td>
				<td><div align="center">{{item.brand}}</div></td>
				<td><div align="center">{{item.modelNo}}</div></td>
				<td><div align="center">{{item.forms}}</div></td>
				
				<td>
					
		    		<div align="center"  ng-if="item.status==1">
			    		<img class="operationImg" ng-click="doShow(item)" src="../../../../img/list_see-icon.png" title="查看 ">
			    		<input type="image" src="../../../../img/asset/more.png"  onclick="shownext(this)" title="更多" class="btnmore" />
			    		<div class="operates">
				    		<p class="bor" ng-click="viewCode(item)"><img class="operationImg"  src="../../../../img/asset/barcode.png" title="条形码 ">条形码</p>
				    		<p class="bor" ng-click="viewCheckPic(item)"><img class="operationImg"  src="../../../../img/asset/assetcheck.png" title="盘点图片 ">盘点图片</p>
				    		<p class="bor" ng-click="viewCyle(item)"><img class="operationImg"  src="../../../../img/asset/lifecyle.png" title="生命周期 ">生命周期</p>
			    			
			    		</div>
			    		
		    			
		    		</div>
		    		<div align="center"  ng-if="item.status==8">
			    		<img class="operationImg" ng-click="doShow(item)" src="../../../../img/list_see-icon.png" title="查看 ">
			    		<input type="image" src="../../../../img/asset/more.png"  onclick="shownext(this)" title="更多" class="btnmore" />
			    		<div class="operates">
				    		<p class="bor" ng-click="viewCode(item)"><img class="operationImg"  src="../../../../img/asset/barcode.png" title="条形码 ">条形码</p>
				    		<p class="bor" ng-click="viewCheckPic(item)"><img class="operationImg"  src="../../../../img/asset/assetcheck.png" title="盘点图片 ">盘点图片</p>
				    		<p class="bor" ng-click="viewCyle(item)"><img class="operationImg"  src="../../../../img/asset/lifecyle.png" title="生命周期 ">生命周期</p>
			    			
			    		</div>
			    		
		    			
		    		</div>
		    		
		    		<div align="center"  ng-if="item.status==2">
			    		<img class="operationImg" ng-click="doShow(item)" src="../../../../img/list_see-icon.png" title="查看 ">
			    			
		    			
		    			<input type="image" src="../../../../img/asset/more.png"  onclick="shownext(this)" title="更多" class="btnmore" />
			    		<div class="operates">
			    			<p class="bor" ng-click="viewCode(item)"><img class="operationImg"  src="../../../../img/asset/barcode.png" title="条形码 ">条形码 </p>
			    			<p class="bor" ng-click="viewCheckPic(item)"><img class="operationImg"  src="../../../../img/asset/assetcheck.png" title="盘点图片 ">盘点图片</p>
				    		<p class="bor" ng-click="viewCyle(item)"><img class="operationImg" src="../../../../img/asset/lifecyle.png" title="生命周期 ">生命周期 </p>
				    		<p class="bor" ng-click="assetMove(item)"><img class="operationImg" src="../../../../img/asset/assetMove.png" title="资产调动">资产调动</p>    	
			    		</div>
		    				
		    		</div>
		    		<div align="center"  ng-if="item.status==3">
		    			<img class="operationImg" ng-click="doShow(item)" src="../../../../img/list_see-icon.png" title="查看 ">
			    		<input type="image" src="../../../../img/asset/more.png"  onclick="shownext(this)" title="更多" class="btnmore" />
			    		<div class="operates">
				    		<p class="bor" ng-click="viewCode(item)"><img class="operationImg"  src="../../../../img/asset/barcode.png" title="条形码 ">条形码 </p>
				    		<p class="bor" ng-click="viewCheckPic(item)"><img class="operationImg"  src="../../../../img/asset/assetcheck.png" title="盘点图片 ">盘点图片</p>
				    		<p class="bor" ng-click="viewCyle(item)" ><img class="operationImg"  src="../../../../img/asset/lifecyle.png" title="生命周期 ">生命周期</p>   
				    		<p class="bor" ng-click="assetMove(item)"><img class="operationImg"  src="../../../../img/asset/assetMove.png" title="资产调动">资产调动 </p>  			
		    			</div>
		    		</div>
		    		<div align="center"  ng-if="item.status==4">		
			    		<img class="operationImg" ng-click="doShow(item)" src="../../../../img/list_see-icon.png" title="查看 ">
			    		<input type="image" src="../../../../img/asset/more.png"  onclick="shownext(this)" title="更多" class="btnmore" />
			    		
			    		<div class="operates">
				    		<p class="bor" ng-click="viewCode(item)"><img class="operationImg"  src="../../../../img/asset/barcode.png" title="条形码 ">条形码 </p>
				    		<p class="bor" ng-click="viewCheckPic(item)"><img class="operationImg"  src="../../../../img/asset/assetcheck.png" title="盘点图片 ">盘点图片</p>
				    		<p class="bor" ng-click="viewCyle(item)" ><img class="operationImg" src="../../../../img/asset/lifecyle.png" title="生命周期 ">生命周期</p>	
		    			</div>
		    		</div>
		    		<div align="center"  ng-if="item.status==5">
			    		<img class="operationImg" ng-click="doShow(item)" src="../../../../img/list_see-icon.png" title="查看 ">
			    		<input type="image" src="../../../../img/asset/more.png"  onclick="shownext(this)" title="更多" class="btnmore" />
			    		<div class="operates">
				    		<p class="bor" ng-click="viewCode(item)"><img class="operationImg"  src="../../../../img/asset/barcode.png" title="条形码 ">条形码</p>
				    		<p class="bor" ng-click="viewCheckPic(item)"><img class="operationImg"  src="../../../../img/asset/assetcheck.png" title="盘点图片 ">盘点图片</p>
				    		<p class="bor"  ng-click="viewCyle(item)"><img class="operationImg" src="../../../../img/asset/lifecyle.png" title="生命周期 ">生命周期 </p>
		    			</div>
		    		</div>
		    		<div align="center" ng-if="item.status==6">
			    		<img class="operationImg" ng-click="doShow(item)" src="../../../../img/list_see-icon.png" title="查看 ">
			    		
			    		<input type="image" src="../../../../img/asset/more.png"  onclick="shownext(this)" title="更多" class="btnmore" />
			    		<div class="operates">
				    		<p class="bor" ng-click="viewCode(item)"><img class="operationImg"  src="../../../../img/asset/barcode.png" title="条形码 ">条形码 </p>
				    		<p class="bor" ng-click="viewCheckPic(item)"><img class="operationImg"  src="../../../../img/asset/assetcheck.png" title="盘点图片 ">盘点图片</p>
				    		<p class="bor" ng-click="viewCyle(item)"><img class="operationImg"  src="../../../../img/asset/lifecyle.png" title="生命周期 ">生命周期</p>
			    		</div>
		    		</div>
		    		<div align="center"  ng-if="item.status==7">
			    		<img class="operationImg" ng-click="doShow(item)" src="../../../../img/list_see-icon.png" title="查看 ">
			    		<input type="image" src="../../../../img/asset/more.png"  onclick="shownext(this)" title="更多" class="btnmore" />
			    		<div class="operates">
			    		
			    			<p class="bor"  ng-click="viewCode(item)"><img class="operationImg" src="../../../../img/asset/barcode.png" title="条形码 ">条形码</p>
			    			<p class="bor" ng-click="viewCheckPic(item)"><img class="operationImg"  src="../../../../img/asset/assetcheck.png" title="盘点图片 ">盘点图片</p>
			    			<p ng-click="viewCyle(item)"><img class="operationImg"  src="../../../../img/asset/lifecyle.png" title="生命周期 ">生命周期</p>
			    		</div>
		    		</div>
		    		
				</td>
			  </tr>
			</table>
		</div>

		<div id="page_bar" class="list_bottom" align="center">
		</div>

	</div>
</div>
</form>
<script type="text/javascript">
function shownext(obj){
	//alert($(obj).next()[0].style.display)
	if($(obj).next()[0].style.display=="none"||$(obj).next()[0].style.display==""){
		$(obj).next().show();
		$(obj).focus();
	    $(obj).focusout(function(){
			
		   /*lazyCall('t1',function(){
				$(obj).next().hide();	
			}, 300); */
			
			var st=setTimeout(function(){
				$(obj).next().hide();	
			}, 300);
			
			
		}); 
	}else{
			$(obj).next().hide();	
		
	}
}



function searchAll(){
	$("#allbar").css("background","#fff");
	$("#allbar").css("color","#3385ff");
	
	$("#probar").css("background","#4CA9FF");
	$("#probar").css("color","#fff");
	
	$("#unitbar").css("background","#4CA9FF");
	$("#unitbar").css("color","#fff");
	
	
	loanUnitCode="";
	loanUnitName="";
	proNo="";
	proName="";
	category_Code = "";
	category_Name="";
	
	$(".proType").hide();
	$(".proNameD").hide();
	$(".unitcode").hide();
	
	$(".proType").val("");
	$(".proNameD").val("");
	$(".unitcode").val("");
	
	ngScope.loadProjects(searchName,assetTypeCode, assetClassCode,status,1,proNo,fromDate,toDate,price1,price2,loanUnitCode);
	
	
}
function searchPro(){
	
	$("#allbar").css("background","#4CA9FF");
	$("#allbar").css("color","#fff");
	$("#probar").css("background","#fff");
	$("#probar").css("color","#3385ff");
	$("#unitbar").css("background","#4CA9FF");
	$("#unitbar").css("color","#fff");
	
	loanUnitCode="";
	loanUnitName="";
	//proNo="";
	//proName="";
	//category_Code = "";
	//category_Name="";
	
	$(".proType").show();
	$(".proNameD").show();
	$(".unitcode").hide();
	
	$(".unitcode").val("");
	ngScope.loadProjects(searchName,assetTypeCode, assetClassCode,status,1,proNo,fromDate,toDate,price1,price2,loanUnitCode);
	
}
function searchUnit(){
	
	$("#allbar").css("background","#4CA9FF");
	$("#allbar").css("color","#fff");
	
	$("#probar").css("background","#4CA9FF");
	$("#probar").css("color","#fff");
	
	$("#unitbar").css("background","#fff");
	$("#unitbar").css("color","#3385ff");
	
	
	//loanUnitCode="";
	//loanUnitName="";
	proNo="";
	proName="";
	category_Code = "";
	category_Name="";
	
	$(".proType").hide();
	$(".proNameD").hide();
	$(".unitcode").show();
	$(".proType").val("");
	$(".proNameD").val("");
	ngScope.loadProjects(searchName,assetTypeCode, assetClassCode,status,1,proNo,fromDate,toDate,price1,price2,loanUnitCode);
	
}


function getUrlParams(){
	var params={};
	var url = location.href;
	var start = url.indexOf("?", 0)+1;
	var paramsStr = url.substring(start, url.length);
	var paramsArr = paramsStr.split("&");
	for(var i=0;i<paramsArr.length;i++){
		var kv = paramsArr[i].split("=");
		var k = kv[0];
		var v = kv[1];
		params[k]=v;
	}
	return params;
}


function createPageBar(totalPage, curPage,totalRecord){
	new PageBar().init({
		renderTo:"#page_bar",
		totalPage:totalPage,
		curPage:curPage,
		totalRecord:totalRecord,
		prevPageText:"上一页",
		nextPageText:"下一页",
		showPageInfo:true,
		onPage:function(pageNum){
			_currentPage=pageNum;
			ngScope.loadProjects(searchName,assetTypeCode, assetClassCode,status,pageNum,proNo,fromDate,toDate,price1,price2,loanUnitCode);
		}
	});
}
var searchName="";
var assetTypeCode="";
var assetTypeName="";
var assetClassCode="";
var assetClassName="";
var status="1,2,3,4,5,6,7,8";
var proNo="";
var proName="";
var _currentPage=1;
var category_Code="";
var category_Name="";
var proTypes;
var ngScope;
var droptype;
var price1="";
var price2="";
var fromDate="";
var toDate="";
var validator;

var loanUnitCode="";
var loanUnitName="";

var app = angular.module("userMgr", []);
app.controller("userMgrCtrl", function($scope, $http){
	/* init */
	ngScope = $scope;
	$scope.curUnit={};
	$scope.projectList=[];
	
	var userDataStr = $.cookie("pmsWeb_user_data");
	if(!userDataStr){
		
		noLogin(location.href);
		return;
	}
	var userData = jQuery.parseJSON(userDataStr);
	ticket = $.cookie("pmsWeb_ticket");
	
	var params = getUrlParams();
	

	
	
	if(params){
		if(params.assetClassCode){
			assetClassCode=params.assetClassCode;
		}
		if(params.assetClassName){
			assetClassName=decodeURIComponent(params.assetClassName);
			$("#dropDownProjectType").val(assetClassName);
		}
		if(params.assetTypeName){
			assetTypeName=decodeURIComponent(params.assetTypeName);
			$("#dropDownProjectType1").val(assetTypeName)
		}
		if(params.assetTypeCode){
			assetTypeCode=params.assetTypeCode;
		}
		if(params.proNo){
			proNo=params.proNo;
		}
		if(params.proName){
			proName=decodeURIComponent(params.proName);
			$(".proNameD").val(proName);
		}
		if(params.category_Name){
			category_Name=decodeURIComponent(params.category_Name);
			$(".proType").val(category_Name);
		}
		if(params.category_Code){
			category_Code=params.category_Code;
		}
		if(params.searchName){
			searchName=decodeURIComponent(params.searchName);
			$("input[name=searchName]").val(searchName)			
		}
		
		if(params.price1){
			price1=params.price1;
			$("input[name=price1]").val(price1);
		}
		
		if(params.price2){
			price2=params.price2;
			$("input[name=price2]").val(price2);
		}
		
		if(params.fromDate){
			fromDate=params.fromDate;
			$("input[name=fromDate]").val(fromDate);
		}
		
		if(params.toDate){
			toDate=params.toDate;
			$("input[name=toDate]").val(toDate);
		}
		
		if(params.currentPage){
			_currentPage=params.currentPage;
		}
		
		
		
		
		
		
		if(params.status){
			status=params.status;
		}
		
	}

	
	/* 表单验证 */
	validator = $("#saveForm").validate({
		onsubmit: false,
		focusInvalid: false,
		focusCleanup: true,
		errorElement: "span",
		ignore:".ignore",
		invalidHandler: function(form, validator) {
			var errors = validator.numberOfInvalids();
			if (errors) {
				
			} 
		}
	});
	
	
	/* 资产分类*/
	new DropDownList().init({
		renderTo:"#dropDownProjectType",
		url:"../../../component/assetType.html?ticket="+ticket,
		height:"200px",
		onSelected:function(result){
			//assetClassName
			$("#dropDownProjectType").val(result.assetClassName);
			assetClassCode = result.assetClassCode;
			assetClassName = result.assetClassName;
			ngScope.loadProjects(searchName,assetTypeCode, assetClassCode,status, 1,proNo,fromDate,toDate,price1,price2,loanUnitCode);
			/* 
			//资产类型
			new DropDownList().init({
				renderTo:"#dropDownProjectType1",
				url:"../../../component/assetLeixing.html?ticket="+ticket+"&assetClassCode="+assetClassCode,
				height:"200px",
				onSelected:function(result){
					$("#dropDownProjectType1").val(result.assetTypeName);
					assetTypeCode = result.assetTypeCode;  
					ngScope.loadProjects(assetTypeCode, assetClassCode,status, 1,proNo);
				}
			}); */
		
			var url="../../../component/assetLeixing.html?&assetClassCode="+assetClassCode;
			droptype.setConfig("url", url);
		}
	});
	
	droptype=new DropDownList();
	//资产类型
	droptype.init({
		renderTo:"#dropDownProjectType1",
		url:"../../../component/assetLeixing.html?ticket="+ticket+"&assetClassCode="+assetClassCode,
		height:"200px",
		onSelected:function(result){
			$("#dropDownProjectType1").val(result.assetTypeName);
			assetTypeCode = result.assetTypeCode;  
			assetTypeName = result.assetTypeName;
			ngScope.loadProjects(searchName,assetTypeCode, assetClassCode,status, 1,proNo,fromDate,toDate,price1,price2,loanUnitCode);
		}
	});
	
	/* 项目类型 */
	new DropDownList().init({
		renderTo:".proType",
		url:"../../../component/projectType.html?required=false&ticket="+ticket,
		height:"200px",
		onSelected:function(result){
			$(".proType").val(result.categoryName);
			category_Code = result.categoryCode;
			category_Name=result.categoryName;
			var url = "../../../component/projectList.html?categoryCode="+category_Code+"&required=false&ticket="+ticket;
			proTypes.setConfig("url", url);
			
		}
	});
	/* 项目列表 */
	proTypes=new DropDownList();
	proTypes.init({
		renderTo:".proNameD",
		url:"../../../component/projectList.html?categoryCode="+category_Code+"&required=false&ticket="+ticket,
		height:"200px",
		onSelected:function(result){
			$(".proNameD").val(result.proName);
			proNo=result.proNo;
			proName=result.proName;
			//ngScope.loadProjects(assetTypeCode, assetClassCode,fromDate, toDate,proNo);
			$scope.loadProjects(searchName,assetTypeCode, assetClassCode,status,1,proNo,fromDate,toDate,price1,price2,loanUnitCode);
		}
	});
	
	/* 部门列表 */
	new DropDownList().init({
		renderTo:"input[name=loanUnitName]",
		url:"../../../component/orgTree.html?required=true",
		height:"200px",
		onSelected:function(result){
			$("input[name=loanUnitName]").val(result.unitName);
			
			loanUnitName=result.unitName;
			loanUnitCode=result.unitCode;
			$scope.loadProjects(searchName,assetTypeCode, assetClassCode,status,1,proNo,fromDate,toDate,price1,price2,loanUnitCode);
			
		}
	});

	
	/* 加载数据 */
	$scope.loadProjects=function(searchName,assetTypeCode, assetClassCode,status,currentPage,proNo,fromDate,toDate,price1,price2,loanUnitCode){//alert(unitCode);
	
	    if(loanUnitCode=="0"){
	    	
	    	loanUnitCode="";
	    }
		if($("#saveForm").valid()){
		
			$http.get(serviceBasePath+"eap/pmsServices/materielMg/assetMg/asset/list?assetTypeCode="
			+assetTypeCode+"&assetClassCode="+assetClassCode+"&status="+status+
			"&currentPage="+currentPage+"&ticket="+ticket+"&loanProNo="+proNo+"&searchName="+searchName+"&fromDate="+fromDate+"&endDate="+toDate+"&price1="+price1+"&price2="+price2+"&loanUnitCode="+loanUnitCode).success(function(response){
			if(response.statusCode==401){
				alert("用户凭据过期！请重新登录！");
				window.top.location.href="../../login.html";
				return;
			}
			$scope.projectList = response.list;
			createPageBar(response.totalPage, response.currentPage,response.totalRecord);
			});
			
		}
	};
	/* 查询 */
	$scope.doQuery=function(){
		
		if($("#saveForm").valid()){
			searchName = $("input[name=searchName]").val();
			price1=$("input[name=price1]").val();
			price2=$("input[name=price2]").val();
			fromDate=$("input[name=fromDate]").val();
		    toDate=$("input[name=toDate]").val();
		    
		   
		    var d1 = new Date(fromDate.replace(/\-/g, "\/"));  
		    var d2 = new Date(toDate.replace(/\-/g, "\/"));  

		     if(fromDate!=""&&toDate!=""&&d1 >d2)  
		    {  
			    // alert("开始时间不能大于结束时间！");  
			     
			     var dialog=new ShowDlog();
					
					dialog.prompt({
						icon:"warning",
						msg:"开始时间不能大于结束时间！",
						done:function(){},
						t:1500
					});
					
					
			     return false;  
		    }
		    
		   
		    $scope.loadProjects(searchName,assetTypeCode, assetClassCode,status,1,proNo,fromDate,toDate,price1,price2,loanUnitCode);
		    
		    
		    
			
			
		}
	};
	
	
	$scope.getSta1=function(){
		var sta1=$("#sta1").is(':checked');
		if(sta1){
			
			$(":checkbox").prop("checked",true) 


		}else{
			$(":checkbox").removeAttr("checked"); 

			
		}
		
		var obj=document.getElementsByName("sta");  //选择所有name="'sta'"的对象，返回数组    
  
	  var s="";    
	  for(var i=0; i<obj.length; i++){    
	    if(obj[i].checked) s+=obj[i].value+",";  //如果选中，将value添加到变量s中    
	  }    
	  //那么现在来检测s的值就知道选中的复选框的值了    
	  //alert(s)
	  if(s==""){
	  	status="";
	  	$scope.loadProjects(searchName,assetTypeCode, assetClassCode,status,1,proNo,fromDate,toDate,price1,price2,loanUnitCode);
	  }else{
	  	 s=s.substring(0,s.length-1);
	  	 status=s;
	  	 $scope.loadProjects(searchName,assetTypeCode, assetClassCode,status,1,proNo,fromDate,toDate,price1,price2,loanUnitCode);
	  }
		
		
	};
	
	//得到status
	$scope.getSta=function(){
	  var obj=document.getElementsByName("sta");  //选择所有name="'sta'"的对象，返回数组    
  
	  var s="";    
	  for(var i=0; i<obj.length; i++){    
	    if(obj[i].checked) s+=obj[i].value+",";  //如果选中，将value添加到变量s中    
	  }    
	  //那么现在来检测s的值就知道选中的复选框的值了    
	  //alert(s)
	  if(s==""){
	  	status="";
	  	$scope.loadProjects(searchName,assetTypeCode, assetClassCode,status,1,proNo,fromDate,toDate,price1,price2,loanUnitCode);
	  }else{
	  	 s=s.substring(0,s.length-1);
	  	 status=s;
	  	 $scope.loadProjects(searchName,assetTypeCode, assetClassCode,status,1,proNo,fromDate,toDate,price1,price2,loanUnitCode);
	  }
	  
	};
	
	$scope.doExport=function(){
		location.href=serviceBasePath+"eap/pmsServices/materielMg/assetMg/asset/export?status="+status+"&assetTypeCode="+assetTypeCode+"&assetClassCode="+assetClassCode+"&loanProNo="+proNo;
		
	};
	
	
	/* 修改 */
	$scope.doUpdate=function(item){
		//assetTypeCode, assetClassCode,status, _currentPage,proNo
		location.href="editAssetBase.html?assetCode="+item.assetCode+"&assetClassCode="+assetClassCode+"&assetTypeCode="+assetTypeCode
				+"&proNo="+proNo+"&assetClassName="+encodeURIComponent(assetClassName)+"&assetTypeName="+encodeURIComponent(assetTypeName)
				+"&proName="+encodeURIComponent(proName)+"&category_Name="+encodeURIComponent(category_Name)+"&category_Code="
				+category_Code+"&status="+status+"&searchName="+encodeURIComponent(searchName)+"&price1="+price1+"&price2="+price2+"&fromDate="+fromDate+"&toDate="+toDate+"&currentPage="+_currentPage;
	};
	

	//保养记录	
	$scope.doMaintain=function(item){
		
		hrefTo({
			url:"maintainMgr.html",
			data:{
				assetCode:item.assetCode,
				assetName:item.assetName,
				assetClassCode:assetClassCode,
				assetClassName:assetClassName,
				assetTypeCode:assetTypeCode,
				assetTypeName:assetTypeName,
				proNo:proNo,
				proName:proName,
				category_Name:category_Name,
				category_Code:category_Code,
				searchName:searchName,
				price1:price1,
				price2:price2,
				fromDate:fromDate,
				toDate:toDate,
				currentPage:_currentPage
			}
		});
		
	};
	//资产维修
	$scope.doRepair=function(item){
		
		hrefTo({
			url:"repairMgr.html",
			data:{
				assetCode:item.assetCode,
				assetName:item.assetName,
				assetClassCode:assetClassCode,
				assetClassName:assetClassName,
				assetTypeCode:assetTypeCode,
				assetTypeName:assetTypeName,
				proNo:proNo,
				proName:proName,
				category_Name:category_Name,
				category_Code:category_Code,
				loanEmployeecode:item.loanEmployeecode,
				loanEmployeename:item.loanEmployeename,
				loanUnitCode:item.loanUnitCode,
				loanUnitName:item.loanUnitName,
				loanProNo:item.loanProNo,
				loanProName:item.loanProName,
				searchName:searchName,
				price1:price1,
				price2:price2,
				fromDate:fromDate,
				toDate:toDate,
				currentPage:_currentPage
			}
		});
		
	};
	/* 显示 */
	$scope.doShow=function(item){
		location.href="showAssetBaseDistrict.html?assetCode="+item.assetCode+"&assetClassCode="+assetClassCode+"&assetTypeCode="+assetTypeCode+"&proNo="
				+proNo+"&assetClassName="+encodeURIComponent(assetClassName)+"&assetTypeName="+encodeURIComponent(assetTypeName)+"&proName="
				+encodeURIComponent(proName)+"&category_Name="+encodeURIComponent(category_Name)+"&category_Code="
				+category_Code+"&status="+status+"&searchName="+encodeURIComponent(searchName)+"&price1="+price1+"&price2="+price2+"&fromDate="+fromDate+"&toDate="+toDate+"&currentPage="+_currentPage;
	};
	
	/* 条形码 */
	$scope.viewCode=function(item){
		//	$("#main_frame").attr("src", "../sys/resetPwd.html");
		new ShowDlog().showFrame("viewCode.html?assetCode="+item.assetCode, "条形码", function(){
						// 
		},"dialog-viewcode");
		
	};
	
	/*盘点图片查看*/
	$scope.viewCheckPic=function(item)
	{
		console.log(item);
		new ShowDlog().showFrame("imags.html?assetCode="+item.assetCode, "查看图片", function(){}, "dlog-showPic");
	}
	
	/* 生命周期 */
	$scope.viewCyle=function(item){
		//	$("#main_frame").attr("src", "../sys/resetPwd.html");
		new ShowDlog().showFrame("viewCyle.html?assetCode="+item.assetCode, "生命周期", function(){
						// 
		},"dialog-viewcyle");
		
	};
	
	//资产调用
	$scope.assetMove=function(item){
		//	$("#main_frame").attr("src", "../sys/resetPwd.html");
		
		location.href="moveAssetBaseDistrict.html?assetCode="+item.assetCode+"&assetClassCode="+assetClassCode+"&assetTypeCode="
				+assetTypeCode+"&proNo="+proNo+"&assetClassName="+encodeURIComponent(assetClassName)+"&assetTypeName="+encodeURIComponent(assetTypeName)
				+"&proName="+encodeURIComponent(proName)+"&category_Name="+encodeURIComponent(category_Name)+"&category_Code="
				+category_Code+"&status="+status+"&searchName="+encodeURIComponent(searchName)+"&price1="+price1+"&price2="+price2+"&fromDate="+fromDate+"&toDate="+toDate+"&currentPage="+_currentPage;;
		
	};
	
	
	
	$scope.scrap=function(item){
		new ShowDlog().showFrame("scrap.html?assetCode="+item.assetCode, "资产报废", function(){
						// 
						
						$scope.loadProjects(searchName,assetTypeCode, assetClassCode,status, _currentPage,proNo,fromDate,toDate,price1,price2,loanUnitCode);
		},"dialog-scrap");
	};
	
	/* 删除 */
	$scope.doDelete=function(item){
		new ShowDlog().confirm({
			msg:"确定对资产“"+item.assetTypeName+item.assetClassName+"”进行删除操作吗？",
			ok:function(){
				$http.post(serviceBasePath+"eap/pmsServices/materielMg/assetMg/asset/delete?assetCode="+item.assetCode+"&ticket="+ticket).success(function(response){
					$scope.loadProjects(searchName,assetTypeCode, assetClassCode,status, _currentPage,proNo,fromDate,toDate,price1,price2,loanUnitCode);
				});
			},
			cancel:function(){}
		});
	};
	
	/* 资产归还 */
	$scope.doReturn=function(item){
			new ShowDlog().showFrame("backAsset.html?assetCode="+item.assetCode, "资产归还", function(){
				// 
				
				$scope.loadProjects(searchName,assetTypeCode, assetClassCode,status, _currentPage,proNo,fromDate,toDate,price1,price2,loanUnitCode);
			},"dialog-scrap1");
			
			
		
		
	};
	
	
	
	/* 初始查询 */
	ngScope.loadProjects(searchName,assetTypeCode, assetClassCode,status, _currentPage,proNo,fromDate,toDate,price1,price2,loanUnitCode);
});
</script>
</body>
</html>
