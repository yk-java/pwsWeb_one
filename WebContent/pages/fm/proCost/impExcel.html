<!DOCTYPE HTML>
<html>
<head>
<title> 设备管理 </title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<script type="text/javascript" src="../../../js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../../../js/jquery.form.js"></script>
<script type="text/javascript" src="../../../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script></head>
<script type="text/javascript" src="../../../angular-1.4.6/angular.min.js"></script>
<script type="text/javascript" src="../../../js/PageBar.js"></script>
<script type="text/javascript" src="../../../js/DropDownList-1.2/DropDownList-v1.2.js"></script>
<link rel="stylesheet" type="text/css" href="../../../js/DropDownList-1.2/DropDownList.css"/>
<script type="text/javascript" src="../../../js/Calendar.js"></script>
<script type="text/javascript" src="../../../js/config.js"></script>
<script type="text/javascript" src="../../../js/util.js"></script>
<script type="text/javascript" src="../../../js/ng-base.js"></script>

<script type="text/javascript" src="../../../js/eapJs/core/eap.core.js" ></script>
<script type="text/javascript" src="../../../js/eapJs/plugins/eap.tip.js" ></script>
<script type="text/javascript" src="../../../js/eapJs/plugins/eap.validate.js"></script>
<script type="text/javascript" src="../../../js/eapJs/local/eap.lang-zh_CN.js"></script>
<link rel="stylesheet" type="text/css" href="../../../css/validate.css"/>
<link rel="stylesheet" type="text/css" href="../../../css/edit.css"/>

<script type="text/javascript" src="../../../js/showDlog/showDlog.js"></script>
<link rel="stylesheet" type="text/css" href="../../../js/showDlog/showDlog-blue.css" />
<script type="text/javascript" src="../../../js/laydate/laydate.js"></script>

<style type="text/css">
	.chooseUser{width:1000px;height:500px;}
	#lay1 .pdd_ta{width:800px;padding:1% 0;background:#f5f5f5;border-radius:5px;margin-bottom:20px;border:1px solid #ccc}
	#lay1 .pdd_ta table{width:100%;}
	#lay1 .pdd_ta table th{color:#77acf9;font-weight:bold;padding:0 20px 0;}
	#lay1 .pdd_ta table input{padding-left:10px;border:1px solid #ccc;height:30px;border-radius:3px;}
	.form_bottom{border-top:none;padding-top:0;}
	input[type=text] {min-width:150px;min-height:28px;font-size:14px;}
	#table{margin:0 auto;line-height:50px;margin-top:180px;}
	.btnimport{width:200px;border:0px;
	    display: inline-block;
    height: 30px;
    line-height: 31px;
    margin: 0 6px;
    padding: 0 18px 0 18px;
    background: #3385FF;
    color: #fff;
    font-weight: bold;
    cursor: pointer;
    border: solid 1px #89C6FF;
    border-radius: 4px;
	}
	#message{
		width:622px;
		height:224px;
		background-image: url("../../../img/importActual.png");
		margin:0 auto;
		text-align: center;
		padding-top:120px;
		margin-top:130px;
	}
</style>
</head>

<body ng-app="moduleName" ng-controller="controllerName" style="background:url('../../../img/caiwubg.png') no-repeat top center;background-size:cover">



<div class="list">
	<div class="list_content">
		<div class="title_div">
			<div class="title_left">
				<label class="title">实际成本导入</label>
			</div>
			<img src="../../../img/list_Header2-.png">
		</div>
		<form id="saveForm" method="post" enctype="multipart/form-data" 
			class="required-validate">
			<br>
			<br>
			<div style="margin:0 auto;text-align: center;font-size:24px;color:#3385FF;top:150px;position: absolute;width:100%">
				实际成本导入
			</div>
			<div id="message">
				
				<p style="margin-top:-30px;"><img  src="../../../img/time.png" />&nbsp;&nbsp;	<input type="text" name="year" id="year" style="width:200px;" placeholder="选择时间" /></p>
				
				<p style="margin-top:30px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <img  src="../../../img/wenjianjia.png" />&nbsp;&nbsp; <input id="excelFile" type="file" name="excelFile"/></p>
					
				<p style="margin-top:30px;">	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="button" class="btnimport" value=" 导 入 " onclick="doUpload()" /></p>
			</div>
			<br>
			<br>
			
		</form>
	</div>
</div>
</body>
<script type="text/javascript">

lay('#version').html('-v'+ laydate.v);

//执行一个laydate实例
laydate.render({
elem: '#year', //指定元素,
type:"month"
});

$(function(){
	var params=getUrlParams();
	
	$("input[name=proNo]").val(params.proNo);
	$("input[name=proName]").val(params.proName);
	$("input[name=categoryName]").val(params.cond_categoryName);
	$("input[name=categoryCode]").val(params.cond_categoryCode);
	$("input[name=companyCode]").val(params.companyCode);
	
})



function doUpload(){
	
	var year=$("input[name=year]").val();
	
	
	if(year==""){
	
		var waittingDlog = new ShowDlog();

		waittingDlog.prompt({
			icon:"warning",
			msg:"请选择时间!",
			done:function(){
				
			},
			t:1500
		});
		return false;
		
	}
	
	
	var excelFile = $("#excelFile")[0].value;
	if(!excelFile && excelFile.length==0){
		new ShowDlog().prompt({
			msg:"请先选择文件",
			t:1500
		});
		return;
	}
	var beginIdx = excelFile.lastIndexOf(".");
	if(beginIdx==-1){
		new ShowDlog().prompt({
			msg:"文件格式不正确（仅支持.xls .xlsx）",
			t:1500
		});
		return;
	}
	var postfix = excelFile.substring(beginIdx+1);	
	if(!/^(xls|xlsx)$/g.test(postfix)){
		new ShowDlog().prompt({
			msg:"文件格式不正确（仅支持.xls .xlsx）",
			t:1500
		});
		return;
	}
	//$("#saveForm").attr("action", serviceBasePath+"eap/pmsServices/pm/taskMgr/task/importExcel");
	new ShowDlog().prompt({
		icon:"waitting",
		msg:"正在上传...",
		t:120000
	});
	$("#saveForm").ajaxSubmit({
		url:serviceBasePath+"eap/pmsServices/pm/pb/budgetEstimate/importExcel",
		type: "post",               //默认是form的method（get or post），如果申明，则会覆盖  
		dataType: "json",           //html(默认), xml, script, json...接受服务端返回的类型  
		clearForm: false,          //成功提交后，清除所有表单元素的值
		success: function(responseText, statusText) {
			if(responseText.statusCode==200){
				$dlog.close();
				

				new ShowDlog().prompt({
					icon:"success",
					msg:responseText.resultMsg,
					done:function(){
						
						
						
						
					},
					t:1500
				});
			
			}else{
				$dlog.close();
				new ShowDlog().prompt({
					icon:"error",
					msg:"上传失败！",
					t:1500
				});
			}
		},      //提交后的回调函数   
		error: function(xhr, status, error) {
			console.log(error);
		}
	});
}
function onCancel(){
	parent.$dlog.close();
}

simpleController({
	init:function($scope, $http){
	
		
	
		
		new DropDownList().init({
			renderTo:"input[name=year]",
			mode:"list",
			data:[{id:2015, name:"2015"},{id:2016, name:"2016"},{id:2017, name:"2017"},{id:2017, name:"2017"},{id:2018, name:"2018"},{id:2019, name:"2019"},{id:2020, name:"2020"},{id:2021, name:"2021"},{id:2022, name:"2022"}],
			textField:"name",
			height:"130px",
			onSelected:function(item){
				$("input[name=year]").val(item.id);
				
			}
		});
		new DropDownList().init({
			renderTo:"input[name=monthName]",
			mode:"list",
			data:[{id:1, name:"一月"},{id:2, name:"二月"},{id:3, name:"三月"},{id:4, name:"四月"},{id:5, name:"五月"},{id:6, name:"六月"},{id:7, name:"七月"},{id:8, name:"八月"},{id:9, name:"九月"},{id:10, name:"十月"},{id:11, name:"十一月"},{id:12, name:"十二月"}],
			textField:"name",
			height:"130px",
			onSelected:function(item){
				$("input[name=monthName]").val(item.name);
				$("input[name=month]").val(item.id);
			}
		});
		
	}
});

</script>
</html>