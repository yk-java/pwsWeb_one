<!DOCTYPE HTML>
<html ng-app="statistic">
<head>
<title>开票申请单</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<script type="text/javascript" src="../../../js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../../../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../../angular-1.4.6/angular.min.js"></script>
<script type="text/javascript" src="../../../js/PageBar.js"></script>
<script type="text/javascript" src="../../../js/Calendar.js"></script>
<script type="text/javascript" src="../../../js/config.js"></script>
<script type="text/javascript" src="../../../js/util.js"></script>

<script type="text/javascript" src="../../../js/DropDownList-1.2/DropDownList-v1.2.js"></script>
<link rel="stylesheet" type="text/css" href="../../../js/DropDownList-1.2/DropDownList.css" />

<script type="text/javascript" src="../../../js/showDlog/showDlog.js"></script>
<link rel="stylesheet" type="text/css" href="../../../js/showDlog/showDlog-blue.css" />
<link rel="stylesheet" type="text/css" href="../../../css/list.css" />


</head>

<body ng-controller="statistic">

<div class="list">
	<div class="list_content">
		<div class="title_div">
			<div class="title_left">
				<input type="text" name="proName" viewstate="proName" placeholder="项目名称搜索"/>
				<input type="text" name="beginTime" placeholder="请选择启始日期" onclick="new Calendar().show(this)" class="dateComponent"/>
				<input type="text" name="endTime" placeholder="请选择结束日期" onclick="new Calendar().show(this)" class="dateComponent"/>
				<input type="text" name="status" class="dropDownList" style="width:100px;" placeholder="状态"/>
				<div class="query_div" onclick="doQuery()">
					查询
				</div>
			</div>
			<img src="../../../img/list_Header2-.png">
			
		</div>
		
		<div class="table_div">
			<table width="100%" border="0" cellspacing="0" cellpadding="0" class="table">
			   <tr class="tr1">
				<th width="5%"><div align="center">序号</div></th>
				<th width="15%"><div align="center">开票项目</div></th>
				<th width="10%"><div align="center">项目编码</div></th>
				<th width="10%"><div align="center">合同编码</div></th>
				<th width="25%"><div align="center">开票内容</div></th>
				<th width="10%"><div align="center">开票金额</div></th>
				<th width="5%"><div align="center">状态</div></th>
				<th  width="10%"><div align="center">操作</div></th>
			  </tr>
			  <tr ng-repeat="item in infoList" class="tr2">
				<td><div align="center">{{$index+1}}</div></th>
				<td width="10%"><div align="center">{{item.proName}}</div></td>
				<td width="10%"><div align="center">{{item.proCode}}</div></td>
				<td width="10%"><div align="center">{{item.contractCode}}</div></td>
				<td width="25%"><div align="center">{{item.appContent}}</div></td>
				<td width="10%"><div align="center">{{item.money}}</div></td>
				<td width="5%" ng-if="item.status=='未开票'" style="background:yellow;"><div align="center" >{{item.status}}</div></td>
				<td width="5%" ng-if="item.status=='已开票'" ><div align="center" >{{item.status}}</div></td>
				<td align="left" ng-if="item.status=='未开票'" >
			    	<img style="margin-left: 30%;" class="operationImg" ng-click="doShow(item)" src="../../../img/list_see-icon.png" title="查看 ">
			    	<img class="operationImg" ng-click="doDeal(item)" src="../../../img/list_deal-icon.png" title="处理">
				</td>
				<td align="left" ng-if="item.status=='已开票'" >
			    	<img style="margin-left: 30%;" class="operationImg" ng-click="doShow(item)" src="../../../img/list_see-icon.png" title="查看 ">
				</td>
			  </tr>
			  
			</table>
		</div>

		<div id="page_bar" class="list_bottom" align="center">
		</div>

	</div>
</div>
<script type="text/javascript">
function createPageBar(totalPage, curPage,totalRecord){
	new PageBar().init({
		renderTo:"#page_bar",
		totalPage:totalPage,
		curPage:curPage,
		totalRecord: totalRecord,
		showPageInfo:true,
		prevPageText:"上一页",
		nextPageText:"下一页",
		onPage:function(pageNum){
			ngScope.loadStatistic( "", "","", "",pageNum);
		}
	});
}
function doQuery(){
	var proName=$("input[name=proName]").val();
	var beginTime=$("input[name=beginTime]").val();
	var endTime=$("input[name=endTime]").val();
	ngScope.loadStatistic(status,beginTime,endTime,proName,1);
}
var ngScope;
var userData;
var app = angular.module("statistic", []);
var status="";
app.controller("statistic", function($scope, $http){
	/* init */
	ngScope = $scope;
	$scope.infoList=[];
	
	var userDataStr = $.cookie("pmsWeb_user_data");
	if(!userDataStr){
		
		noLogin(location.href);
		return;
	}
	userData = jQuery.parseJSON(userDataStr);
	ticket = $.cookie("pmsWeb_ticket");
	
	new DropDownList().init({
			renderTo:"input[name=status]",
			mode:"list",
			data:[{id:"", name:"（全部）"},{id:0, name:"未开票"},{id:1, name:"已开票"}],
			textField:"name",
			onSelected:function(item){
				status=item.id;
				$("input[name=status]").val(item.name);
			}
		});
		
	
	$scope.loadStatistic=function(status,fromTime, toTime, searchName,pageNum){
		$http.get(serviceBasePath+"eap/pmsServices/fm/billApply/kplist?status="+status+"&fromTime="+fromTime+"&toTime="+toTime+"&currentPage="+pageNum+"&proName="+searchName+"&ticket="+ticket).success(function(response){
			if(response.statusCode!=200){
				alert("请求服务器失败！");
				return;
			}
			$scope.infoList = response.list;
			createPageBar(response.totalPage,response.currentPage,response.totalRecord);
		});
	};
	
		
		$scope.doShow=function(item){
		
			location.href="invoiceApplyDetail.html?rowid="+item.rowid;
		};
	
		$scope.doDeal=function(item){
		
			location.href="invoiceApplyDeal.html?rowid="+item.rowid;
		};
		
	$scope.loadStatistic("","", "","", 1);
	
});
</script>
</body>
</html>
