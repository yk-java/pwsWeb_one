<!DOCTYPE HTML>
<html>
<head>
<title> 角色管理</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<script type="text/javascript" src="../../js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../js/config.js"></script>
<script type="text/javascript" src="../../js/jquery.ztree.core-3.5.js"></script>
<link rel="stylesheet" href="../../css/zTreeStyle/zTreeStyle.css" type="text/css">
<link rel="stylesheet" type="text/css" href="../../css/iconfont/iconfont.css" />
<style type="text/css">
	
</style>
</head>

<body>
<div id="treeDemo" class="ztree"></div>
<script type="text/javascript">
var setting = {
		data:{
			key:{
				name:"moduleName"
			},
			simpleData:{
				enable:true,
				idKey:"moduleCode",
				pIdKey:"parentModuleCode",
				rootPid:"-1"
			},
			view:{
				showIcon:false
			}
		},
		callback:{
			onClick:function(){
				var selectedNodes = orgTree.getSelectedNodes();
				
				alert(selectedNodes[0].moduleCode);
				
			}
		}
	};

var orgTree;
window.onload=function(){
	var userDataStr = $.cookie("pmsWeb_user_data");
	if(!userDataStr){
		
		noLogin(location.href);
		return;
	}
	var userData = jQuery.parseJSON(userDataStr);
	ticket = $.cookie("pmsWeb_ticket");
	
	$.ajax({
		url:serviceBasePath+"eap/pmsServices/sys/funcConfig/module/list",
		method:"GET",
		cache:false,
		data:{"ticket":ticket},
		success:function(res){
			if(res.statusCode==200){
				var treeNodes={};
				treeNodes.moduleName="所有模块";
				treeNodes.moduleCode="0";
				treeNodes.parentModuleCode="-1";
				res.list.push(treeNodes);
				/*for(var i=0;i<res.list.length;i++){
					var node = res.list[i];
					var icon="("+node.icon+")"
					node.moduleName=node.moduleName+icon;
				}*/
				orgTree = $.fn.zTree.init($("#treeDemo"), setting, res.list);
				
			}else if(res.statusCode==401){
				window.noLogin(location.href);
			}else{
				alert("服务器访问出错！");
			}
		},
		error:function(){
			alert("服务器访问失败！");
		}
	});
	
};
</script>
</body>
</html>
