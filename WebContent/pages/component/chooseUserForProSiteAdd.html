<!DOCTYPE HTML>
<html ng-app="orgMgr">
<head>
<title> 人员选择 </title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">

<link rel="stylesheet" type="text/css" href="../../bootstrap-3.3.5-dist/css/bootstrap.min.css"/>

<link rel="stylesheet" href="../../css/zTreeStyle/zTreeStyle.css" type="text/css">
<script type="text/javascript" src="../../js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../js/jquery.ztree.core-3.5.js"></script>
<script type="text/javascript" src="../../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script></head>
<script type="text/javascript" src="../../angular-1.4.6/angular.min.js"></script>
<script type="text/javascript" src="../../js/PageBar.js"></script>
<script type="text/javascript" src="../../js/config.js"></script>
<script type="text/javascript" src="../../js/util.js"></script>
<link rel="stylesheet" type="text/css" href="../../css/list.css"/>
<script type="text/javascript" src="../../js/showDlog/showDlog.js"></script>
<link rel="stylesheet" type="text/css" href="../../js/showDlog/showDlog-blue.css" />

<style type="text/css">

	.list{position: absolute;left:13px;right:13px;top:13px;bottom:10px;border:solid 0px;}
	.list .list_left{position: absolute;left:0px;top:0px;bottom:0px;width:240px;background:#E5F0FF;}
	.list .list_left .left_title{width:100%;height:42px;background:#3385FF;line-height:30px;color:#fff;border-bottom:solid 1px #4CA9FF;}
	.list .list_left .left_title label{display:inline-block;margin-top:5px;}
	.list .list_left .left_tree{position: absolute;left:0px;right:0px;bottom:0px;top:40px;border:solid 0px;overflow: auto;}
	.list .list_content{position: absolute;left:0px;right:0px;top:0px;bottom:0px;border:solid 0px;}
	.list .list_content .title_div{width:100%;height:42px;border-bottom:solid 3px #3385FF;}
	.list .list_content .title_div .title_left{min-width:250px;height:42px;background:#3385FF;line-height:42px;color:#fff;font-size:14px;font-weight: bold;float:left;}
	.list .list_content .title_div > img{float:left;margin-top:1px;}
	.list .list_content .title_div .title_add{float:left;width:70px;height:28px;background: url(../../img/bnt_newly-added.png) repeat;line-height:28px;text-align:center;margin-left:30px;margin-top:5px;color:#fff;cursor: pointer;}
	.list .list_content .table_div{left:0px;right:0px;bottom:32px;top:42px;border:solid 0px;}
	.owWordLoad {text-decoration: underline;color: #0099ff;}
	.owWordload-detail{border:solid 1px #666;background:#ffee99;color:#666;padding:4px 6px 4px 6px;position:absolute;display:none;}
	.left_title{font-family:微软雅黑;font-size:14px;font-weight:bold;}
	.ztree li span{font-family:微软雅黑;}
	.ztree{overflow-x:hidden;}
</style>

<body ng-controller="orgMgr">

<div class="list">
	<div class="list_content">
		<div class="title_div">
			<div class="title_left">
				<label style="float:left;">&nbsp;&nbsp;&nbsp;&nbsp;{{curUnit.unitName}}员工</label>
				<input type="text" name="searchName" style="font-weight:normal;" placeholder="请输入姓名搜索"/>
				<div class="query_div" style="background:#0C64E7;" ng-click="doQuery()">
					查询
				</div>
			</div>
			<img src="../../img/list_Header-.png">
			<div class="title_add" ng-click="ok()">
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;确定
			</div>
		</div>
		
		<div class="table_div">
			<table width="100%" border="0" cellspacing="0" cellpadding="0" class="table">
			   <tr class="tr1">
			   	<th width="2%"><input type="checkbox" name="employeeAll" ng-click="chooseUserAll()"/></th>
				<th width="2%"><div align="center">序号</div></th>
				<th width="5%"><div align="center">员工姓名</div></th>
				<th width="6%"><div align="center">性别</div></th>
				<th width="8%"><div align="center">手机</div></th>
				<th width="8%"><div align="center">施工队名称</div></th>
			  </tr>
			  <tr ng-repeat="item in userList" class="tr2">
			  	<td><input type="checkbox" name="employee" value="{{item.workerName}}" workerCode="{{item.workerCode}}" gender="{{item.gender}}" photo="{{item.photo}}" mobile="{{item.mobile}}" ng-click="chooseUser(item)"/></td>
				<td><div align="center">{{$index+1}}</div></td>
				<td><div align="center">{{item.workerName}}</div></td>
				<td>
					<div ng-if="item.gender==1" align="center">男</div>
					<div ng-if="item.gender==2" align="center">女</div>
				</td>
				<td><div align="center">{{item.mobile}}</div></td>
				<td><div align="center">{{item.teams}}</div></td>
			  </tr>
			</table>
		</div>

		<div id="page_bar" class="list_bottom" align="center">
		</div>

	</div>
</div>

<script type="text/javascript">

var zNodes ={};
var orgTree={};
var ticket="";
var selectedUnit={};
var searchName="";
function createPageBar(totalPage, curPage){
	new PageBar().init({
		renderTo:"#page_bar",
		totalPage:totalPage,
		curPage:curPage,
		btnCount:10,
		prevPageText:"上一页",
		nextPageText:"下一页",
		onPage:function(pageNum){
			ngScope.loadUsers(pageNum, "");
			//$("#currPage").html(pageNum);
		}
	});
}

var ngScope;
var app = angular.module("orgMgr", []);
app.controller("orgMgr", function($scope, $http){
	/* init */
	ngScope = $scope;
	$scope.curUnit={};
	$scope.userList=[];
	
	var urlParams = getUrlParams();
	var params_unitCode = urlParams.unitCode;
	var params_unitName = urlParams.unitName;
	
	var userDataStr = $.cookie("pmsWeb_user_data");
	if(!userDataStr){
		
		noLogin(location.href);
		return;
	}
	var userData = jQuery.parseJSON(userDataStr);
	ticket = $.cookie("pmsWeb_ticket");
	
	$scope.loadUsers=function(currentPage, searchName){//alert(unitCode);
	
		$http.get(serviceBasePath+"eap/pmsServices/pm/workers/chooseWorkers?companyCode="+userData.companyCode+"&currentPage="+currentPage+"&searchName="+searchName+"&ticket="+ticket).success(function(response){
			if(response.statusCode!=200){
				alert("请求服务器失败！");
				return;
			}
			$scope.userList = response.list;
			selectedUser=[];
			createPageBar(response.totalPage, response.currentPage);
		});
	};
	var selectedUser=[];
	$scope.loadUsers(1,searchName)
	$scope.chooseUserAll=function(){
		$("input[type=checkbox][name=employee]").click();
	};
	
	/* 选择用户 */
	$scope.chooseUser=function(item){
// 		var chk=$("input[type=checkbox][value="+item.employeecode+"]")[0];
// 		if(chk.checked)
// 			selectedUser.push(item);
// 		else
// 			arrRemove(selectedUser, item);
	};
	

	
	$scope.ok=function(){
		selectedUser=[];
		$("input[type=checkbox][name=employee]").each(function(index){
			if($(this)[0].checked){
				var workerName = $(this).val();
				var gender = $(this).attr("gender");
				var unitCode=$(this).attr("unitCode");
				var mobile=$(this).attr("mobile");
				var workerCode=$(this).attr("workerCode");
				var photo=$(this).attr("photo");
				var item={};
				item.workerName = workerName;
				item.gender = gender;
				item.mobile=mobile;
				item.workerCode=workerCode;
				item.photo=photo;
				selectedUser.push(item);
			}
		});
		parent.$dlog.data=selectedUser;
		parent.$dlog.close();
	};
	
	$scope.doQuery=function(){
		var searchName = $("input[name=searchName]").val();
		this.loadUsers(1, searchName);
	};
	$scope.toArr=function(pros){
		if(!pros)return;
		var arr = pros.split(",");//alert(arr);
		return arr;
	};
	
	$scope.top2=function(arr){
		var arrN=[];
		if(!arr)return arrN;
		for(var i=0;i<arr.length;i++){
			if(i>1){
				break;
			}
			arrN.push(arr[i]);
		}
		return arrN;
	};
	
	$scope.after2=function(arr){
		var arrN=[];
		for(var i=2;i<arr.length;i++){
			arrN.push(arr[i]);
		}//alert(arrN.length);
		return arrN;
	};
});

window.onkeyup=function(e){
	if(e.keyCode==13){
		ngScope.doQuery();
	}
};
</script>
</body>
</html>
