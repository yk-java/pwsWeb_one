<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script type="text/javascript" src="../../js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script></head>
<script type="text/javascript" src="../../angular-1.4.6/angular.min.js"></script>
<script type="text/javascript" src="../../js/PageBar.js"></script>
<script type="text/javascript" src="../../js/DropDownList-1.2/DropDownList-v1.2.js"></script>
<link rel="stylesheet" type="text/css" href="../../js/DropDownList-1.2/DropDownList.css" />
<script type="text/javascript" src="../../js/config.js"></script>
<script type="text/javascript" src="../../js/util.js"></script>
<link rel="stylesheet" type="text/css" href="../../css/list.css"/>
<script type="text/javascript" src="../../js/Calendar.js"></script>
<script type="text/javascript" src="../../js/ViewState.js"></script>
<script type="text/javascript" src="../../js/showDlog/showDlog.js"></script>
<link rel="stylesheet" type="text/css" href="../../js/showDlog/showDlog-blue.css" />
<style>
*{margin:0;padding:0;outline:none;list-style:none;}
.msg_filter{width:95%;margin:0 auto;padding:30px 0 20px 0;border-bottom:1px solid #f2f2f2;overflow:hidden}
.msg_filter input{height:30px;border:1px solid #3385ff;margin-right:10px;text-indent:8px;float:left}
.query_div2{background:#3385ff;line-height:32px;display:inline-block;padding:0 20px;color:#fff;font-size:18px;cursor:pointer;float:left}
.msg_warp{width:95%;margin:0 auto;}
.msg_warp .msg_warpul{margin-bottom:20px}
.msg_warp .msg_warpul li{border-bottom:1px solid #f2f2f2;cursor:pointer;}
.msg_warp .msg_warpul li:hover{background:#fafafa}
.msg_warp .msg_warpul li p{font-size:16px;padding:20px 0 10px 0;margin-left:10px}
.msg_warp .msg_warpul li .msg_tip{padding-bottom:20px;margin-left:10px}
.msg_warp .msg_warpul li .msg_tip span{margin-right:300px;color:#a3a3a3;font-size:12px}
.msg_warp .msg_warpul li .msg_tip span img{margin-right:10px}
.msg_warp .msg_warpul li .msg_tip span.no_read{color:#3385ff}
</style>
</head>
<body ng-app="userMgr" ng-controller="userMgrCtrl" storagekey="mainMsg.mainMsg">
<div class="msg_filter">
	<input type="text" name="title" id="title" viewstate="title" style="width:210px;" placeholder="请输入搜索关键字" />
	<input type="text" id="accountType" viewstate="accountType" class="dropDownList" style="width:80px;" placeholder="阅读状态"/>
	<input type="hidden" viewstate="accountTypeCode"/>
	<input type="text" id="startDate" name="startDate" viewstate="startDate" style="width:150px;" class="date dateComponent" placeholder="请选择开始时间" onclick="new Calendar().show(this)" />
	<input type="text" id="endDate"   name="endDate" viewstate="endDate" style="width:150px;" class="date dateComponent" placeholder="请选择结束时间" onclick="new Calendar().show(this)" />
	<span class="query_div2" ng-click="doQuery()">查&nbsp;&nbsp;询</span>
</div>
<div class="msg_warp">
	<ul class="msg_warpul">
		<li ng-repeat="item in mesList" ng-click="showDetail(item)">
			<p>{{$index+1}}.{{item.TITLE}}</p>
			<div class="msg_tip">
				<span><img src="../../img/time_icon01.png" width="14px"/>{{item.PUBLISH_DATE}}</span>
				<span ng-if="item.status==1">已阅</span>
				<span ng-if="item.status==0" class="no_read">未阅</span>
			</div>
		</li>
	</ul>
</div>

<div id="page_bar" class="list_bottom" align="center">
</div>

</body>
<script>
function createPageBar(totalPage, curPage,totalRecord){
	new PageBar().init({
		renderTo:"#page_bar",
		totalPage:totalPage,
		curPage:curPage,
		totalRecord: totalRecord,
		showPageInfo:true,
		prevPageText:"上一页",
		nextPageText:"下一页",
		onPage:function(pageNum){
			currentPage=pageNum;
			ngScope.getMesList(status,title,startDate,endDate,pageNum);
		}
	});
}
var title="";
var startDate="";
var endDate="";
var status=0;
var ngScope;
var currentPage=1;
var app = angular.module("userMgr", []);
app.controller("userMgrCtrl", function($scope, $http){
	/* init */
	ngScope = $scope;
	var urlParams=getUrlParams();
	
	var viewState = new ViewState();
	if(viewState.get("accountTypeCode") && viewState.get("accountTypeCode").length>0){
		status=viewState.get("accountTypeCode");
	}
	if(viewState.get("title") && viewState.get("title").length>0){
		title=viewState.get("title");
	}
	if(viewState.get("startDate") && viewState.get("startDate").length>0){
		startDate=viewState.get("startDate");
	}
	if(viewState.get("endDate") && viewState.get("endDate").length>0){
		endDate=viewState.get("endDate");
	}
	var userDataStr = $.cookie("pmsWeb_user_data");
	if(!userDataStr){
		noLogin(location.href);
		return;
	}
	


	
	
	var userData = jQuery.parseJSON(userDataStr);
	var accountCode=userData.accountCode;
	
	ticket = $.cookie("pmsWeb_ticket");
	$scope.mesList="";
	
	new DropDownList().init({
		renderTo:"#accountType",
		data:[{code:0, name:"(全部)"},{code:1, name:"未读"},{code:2,name:"已读"}],
		textField:"name",
		onSelected:function(result){
			if(result.code==0){
				$("#accountType").val("");
				status=result.code;
				$("input[viewstate=accountTypeCode]").val(result.code);
			}else{
				$("#accountType").val(result.name);
				status=result.code;
				$("input[viewstate=accountTypeCode]").val(result.code);
			}
			$scope.getMesList(status,title,startDate,endDate);
		}
	});
	$scope.getMesList=function(status,title,startDate,endDate,currentPage){
		$http.get(serviceBasePath+"eap/pmsServices/notice/pageList?status="+status+"&accountCode="+accountCode+"&title="+title+"&startDate="+startDate+"&endDate="+endDate+"&currentPage="+currentPage+"&perpage=5").success(function(response){
			if(response.statusCode==200){
				
				$scope.mesList= response.list;
				createPageBar(response.totalPage, response.currentPage,response.totalRecord);
			}
		});
	};
	
	$scope.getMesList(status,title,startDate,endDate);
	$scope.doQuery=function(item){
		viewState.collect();
		startDate=$("#startDate").val();
		endDate=$("#endDate").val();
		title=$("#title").val();
		$scope.getMesList(status,title,startDate,endDate);
	}
	
	$scope.showDetail=function(item){
		location.href="msgDetail.html?rowid="+item.rowid;
	}
});


</script>
</html>