<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>签到</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<script type="text/javascript" src="../../js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script></head>
<script type="text/javascript" src="../../angular-1.4.6/angular.min.js"></script>
<script type="text/javascript" src="../../js/PageBar.js"></script>
<script type="text/javascript" src="../../js/DropDownList-1.2/DropDownList-v1.2.js"></script>
<link rel="stylesheet" type="text/css" href="../../js/DropDownList-1.2/DropDownList.css" />
<script type="text/javascript" src="../../js/config.js"></script>
<script type="text/javascript" src="../../js/util.js"></script>
<link rel="stylesheet" type="text/css" href="../../css/list.css"/>
<script type="text/javascript" src="../../js/Calendar.js"></script>
<script type="text/javascript" src="../../js/showDlog/showDlog.js"></script>
<script type="text/javascript" src="../../js/SimpleDateFormat.js"></script>
<link rel="stylesheet" type="text/css" href="../../js/showDlog/showDlog-blue.css" />
<link rel="stylesheet" type="text/css" href="../../css/bxyw.css"/>
<script type="text/javascript" src="../../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../../js/config.js"></script>
<style>
*{margin:0;padding:0;outline:none;list-style:none;}
.msg_warp{width:95%;margin:0 auto;padding-top:90px}
.curtime{width:80%;line-height:30px;background:#e6e6e6;overflow:hidden;margin:0 auto}
.curtime *{float:left;display:block;}
.curtime img{width: 20px;margin: 5px 15px 0 15px;}
.signStatus{margin:30px 0}
.signStatus p{text-align:center;line-height:50px;color:#ccc}
.signbtn{width:90%;margin:0 auto;line-height:40px;height:40px;color:#fff;background:#02a3fe;text-align:center}
</style>
</head>
<body ng-app="userMgr" ng-controller="userMgrCtrl" style="background:#fff">
<header class="header">
	<div class="return"><img src="../../img/return.png"/></div>
	签到
</header>
<div class="msg_warp">
	<div class="curtime">
		<img src="../../img/time_icon.png">
		<p id="logInfo"></p>
	</div>
</div>
<div class="signStatus">
	<div ng-if="checkStatus ==0">
		<img src="../../img/sign_in_face_icon.png" width="130px" style="margin:0 auto;display:block"/>
		<p style="text-indent: -25px;" >您还未签到哦</p>
	</div>
	<div>
		<img ng-if="checkStatus ==1||checkStatus ==2" src="../../img/sign_out_face_smile.png" width="100%"/>
		<p ng-if="checkStatus ==1">已签到&nbsp;&nbsp;|&nbsp;&nbsp;签到时间：{{datalist.checkInTime}}</p>
		<p ng-if="checkStatus ==2">已签退&nbsp;&nbsp;|&nbsp;&nbsp;签退时间：{{datalist.checkOutTime}}</p>
	</div>
</div>
<div class="signbtn" ng-click="doCheck('1')" ng-if="checkStatus ==0">签到</div>
<div class="signbtn" ng-click="doCheck('2')" ng-if="checkStatus ==1">签退</div>
</body>
<script>
var ngScope;
var app = angular.module("userMgr", []);
app.controller("userMgrCtrl", function($scope, $http){
	/* init */
	ngScope = $scope;
	var urlParams=getUrlParams();
	var userDataStr = $.cookie("pmsWeb_user_data");
	if(!userDataStr){
		noLogin(location.href);
		return;
	}
	var userData = jQuery.parseJSON(userDataStr);
	$http.get(serviceBasePath+"eap/pmsServices/pwBaoAppService/userCheckStatus?companyCode="+userData.companyCode+"&accountCode="+userData.accountCode).success(function(response){
		if(response.statusCode==200){
			$scope.datalist=response.data;
			$scope.checkStatus = response.data.checkStatus;
		}
	})
	
	$scope.doCheck=function(checkinType){
		 checkinTime = $("#logInfo").text();
		 $http.post(serviceBasePath+"eap/pmsServices/pwBaoAppService/checkin?companyCode="+userData.companyCode+"&accountCode="+userData.accountCode+"&unitCode="+userData.unitCode+"&employeeCode="+userData.employeeCode+"&checkinType="+checkinType+"&checkinTime="+checkinTime+"&x=0.0&y=0.0&checkinImg1=''&checkinImg1=''").success(function(response){
			if(response.statusCode==200){
				if(response.resultMsg=="签到成功！"){
					new ShowDlog().prompt({
						icon:"success",
						msg:"签到成功！",
						done:function(){
							 window.location.reload(); 
						},
						t:1500
					});
				}else if(response.resultMsg=="签退成功！"){
					new ShowDlog().prompt({
						icon:"success",
						msg:"签退成功！",
						done:function(){
							 window.location.reload(); 
						},
						t:1500
					});
					 $scope.show=1;
				}
			}
		})
	};
	

	
	
});



/* 获取时间 */
function getCurDate()
{
	var d = new Date();
	var years = d.getFullYear();
	var month = add_zero(d.getMonth()+1);
	var days = add_zero(d.getDate());
	var hours = add_zero(d.getHours());
	var minutes = add_zero(d.getMinutes());
	var seconds=add_zero(d.getSeconds());
	var ndate = years+"-"+month+"-"+days+" "+hours+":"+minutes+":"+seconds+" ";
	var divT=document.getElementById("logInfo");
	divT.innerHTML= ndate;
	}
	function add_zero(temp)
	{
	if(temp<10) return "0"+temp;
	else return temp;
}
setInterval("getCurDate()",100);

$(".return").click(function(){
	window.history.back() 
})

</script>
</html>