<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<script type="text/javascript" src="../../js/jquery-1.9.1.min.js"></script>
	<script type="text/javascript" src="../../js/placeholder.js"></script>
	<script type="text/javascript" src="../../js/jquery.cookie.js"></script>
	<script type="text/javascript" src="../../js/config.js"></script>
	<link rel="stylesheet" type="text/css" href="../../css/iconfont/iconfont.css"/>
	<script type="text/javascript" src="../../angular-1.4.6/angular.min.js"></script>
	<script type="text/javascript" src="../../js/util.js"></script>
	<link rel="stylesheet" type="text/css" href="../../css/bxyw1.css"/>
	<link rel="stylesheet" type="text/css" href="../../css/mainindex.css"/>
	<script type="text/javascript" src="../../js/showDlog/showDlog.js"></script>
	<link rel="stylesheet" type="text/css" href="../../js/showDlog/showDlog-blue.css" />
	<title>修改信息</title>
</head>
<style>
	.movepass li{background:none;    border: 1px solid #eee;}
	.movepass li p,.newPs{border-bottom: 1px solid #eee;line-height: 43px;}
	.myMsg ul.myset_ul li input{background:none;width:100% !important;}
	.pscheck{display:block;width: 60px !important;text-align: center;line-height: 20px;float:left;background:#eee;color:#999999;text-indent:0}
	.pscheck.low{background:#fff2e5;color:#e47e17;}
	.pscheck.middle{background:#ffe6cc;color:#e47e17;}
	.pscheck.strong{background:#ffd9b2;color:#e47e17;}
	.error_icon{background: #fff url(../../img/error_icon.png) no-repeat 98% center !important;background-size:5% !important}
	.sentMsgBtn {display: inline-block;cursor: pointer;margin-left:90px;line-height: 34px;background: #7fcaff;color: #fff;text-indent:0px;text-align:center}
	.sentMsgBtn:hover{background:#64bbf8}
</style>
<body ng-app="pmsWeb" ng-controller="mainCtrl" style="background: #fff;">
	 <header>
		<div class="return"><img src="../../img/return.png"></div>
		密码修改
	</header>
	<section class="myset myMsg">
		
		<ul class="myset_ul movepass">
			<li><p>原密码 </p><input type="password" id="oldword" placeholder="请输入验证码"/></li>
			<li><p>验证码 <span class="sentMsgBtn">发送验证码</span></p><input type="password" id="yzm" placeholder="请输入验证码"/></li>
			<li>
				<div class="newPs" style="overflow:hidden">
					<a style="float:left">新密码</a>
					<p style="float:left;margin:12px 0 0 20px">
						<span class="pscheck pscheck1">弱</span>
						<span class="pscheck pscheck2">中</span>
						<span class="pscheck pscheck3">强</span>
					</p>
				</div>
				<input type="password" id="newword"  placeholder="密码6~18的数字、字母大小写及字符'!@#'组合" />
			</li>
			<li><p>确认密码</p><input type="password" id="newword1" placeholder="请再次输入密码"/></li>
			<li class="btn_upta" ng-click="updata()">确认修改</li>
		</ul>
	</section>
<script>
 /* alert(new RegExp("[@#!]").test("1!dasdf")) */
var mes="";
var status =0;
var app = angular.module("pmsWeb", []);
app.controller("mainCtrl", function($scope, $http){
	/* init */
	ngScope = $scope;
	var urlParams = getUrlParams();
	var userDataStr = $.cookie("pmsWeb_user_data");
	var userData = jQuery.parseJSON(userDataStr);
	var accountCode= userData.accountCode;

	$scope.updata=function(){
		var oldword =$("#oldword").val();
		var newword =$("#newword").val();
		var newword1 =$("#newword1").val();
		if(status==1){
			if(newword==newword1){
				$http.post(serviceBasePath+"eap/pmsServices/loginService/psw?accountCode="+accountCode+"&psw="+newword+"&oldPsw="+oldword).success(function(response){
					if(response.statusCode==200){
						new ShowDlog().prompt({
							icon:"success",
							msg:"保存成功！",
							done:function(){
								noLogin(location.href);
							},
							t:1500
						});
					}
				});
			}else{
				new ShowDlog().prompt({
					icon:"error",
					msg:"两次输入的密码不一致！",
					done:function(){
					},
					t:1500
				});
			}
		}else{
			new ShowDlog().prompt({
				icon:"error",
				msg:"页面输入有误，请检查后提交",
				done:function(){
				},
				t:1500
			});
		}
	};
});

function getSex(obj){
	if(mes==1){
		obj.src="../../img/switch_02.png";	
		mes=0;
	}else{
		obj.src="../../img/switch_01.png";	
		mes=1;
	}
};
function getSex1(obj){
	if(mes==1||mes==3){
		obj.src="../../img/switch_01.png";	
		mes=2;
	}else{
		obj.src="../../img/switch_02.png";	
		mes=1;
	}
};
$(".return").click(function(){
	window.history.back();
});


$("#newword").keyup(function(){
	var thirms=$("#newword").val();
	if(new RegExp("^.*\\d.*$").test(thirms) && new RegExp("^.*[a-z]|[A-Z].*$").test(thirms) && new RegExp("[@#!]").test(thirms)){
		if(thirms.length<6){
			$("#newword").addClass("error_icon")
			$(".pscheck1").removeClass("low");
			$(".pscheck2").removeClass("middle");
			$(".pscheck3").removeClass("strong");
			return;
		}else{
			$("#newword").removeClass("error_icon")
		}
		if(thirms=="admin" ||thirms=="root"||thirms=="password" ){
			$("#newword").addClass("error_icon")
			return;
		}
		
		if(thirms.length>=6&&thirms.length<=8){
			$(".pscheck1").addClass("low");
			$(".pscheck2").removeClass("middle");
			$(".pscheck3").removeClass("strong");
		}
		if(thirms.length>=8&&thirms.length<=12){
			$(".pscheck1").addClass("low");
			$(".pscheck2").addClass("middle");
			$(".pscheck3").removeClass("strong");
		}
		if(thirms.length>=12&&thirms.length<=16){
			$(".pscheck1").addClass("low");
			$(".pscheck2").addClass("middle");
			$(".pscheck3").addClass("strong");
		}
	}else{
		$("#newword").addClass("error_icon")
		$(".pscheck1").removeClass("low");
		$(".pscheck2").removeClass("middle");
		$(".pscheck3").removeClass("strong");
		return;
	}
	
		status =1;
});

</script>
</body>
</html>