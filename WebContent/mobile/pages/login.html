<!DOCTYPE HTML>
<html>
<head>
<title> 登录 - 电网智能运维管控云服务平台 </title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">

<link rel="shortcut icon" href="../favicon2.png" type="image/x-icon" />
<!-- <link rel="icon" sizes="any" mask href="../favicon.svg"> -->

<link rel="stylesheet" type="text/css" href="../bootstrap-3.3.5-dist/css/bootstrap.min.css"/>
<script type="text/javascript" src="../js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../js/placeholder.js"></script>
<script type="text/javascript" src="../js/jquery.cookie.js"></script>
<script type="text/javascript" src="../js/config.js"></script>
<script type="text/javascript" src="../js/respond.min.js"></script>
<style type="text/css">
body{font-family:微软雅黑;}
.logo{margin:10px 0;}
.content{background:url(../img/login/background_pic.png)  no-repeat center;min-height:520px;margin:0 0;}
.bottom{text-align:center;margin:0 0;font-size:12px;color:#888;}

.dialog{width:316px;height:328px;background: url(../img/login/dialog_bg.png) no-repeat;margin:30px 0 0 0;}
.dialog_title{text-align:center;color:#fff;font-size:22px;margin:25px 0px;}
.dialog_content{margin:0 20px;}
.dialog_bottom{text-align:center;color:#fff;font-size:12px;}
.error_msg{color:#ff9900;font-size:12px;}
.dialog_content input{width:100%;margin:0 auto;text-indent: 20px;}
.dialog_content input.uname{background:#dcf2ff url("../img/login_name.png") no-repeat;background-size: 6%;background-position: 5px;}
.dialog_content input.upass{background:#dcf2ff url("../img/login_password.png") no-repeat;background-size: 6%;background-position: 5px;}
.dialog_content .btn{width:100%;margin:0 auto;background:#03a2ff;color:#fff}
</style>
</head>

<body>
	
	<div class="content" style="background: none;">
		<div class="container">
			<div  class="row" >
				<div class="col-sm-4" style="padding:0;margin:0;position: relative;">
					<img src="../img/login_bg.png" width="100%"/>
					<p style="position: absolute;bottom: 15%;text-align: center;width: 100%;color: #fff;">运维宝</p>
				</div>
				<div class="col-sm-4" style="margin:30px auto 110px;padding:0;width: 95%;">
		<!-- 		<form action="main.html" method="post"> -->
						<div class="dialog_content" style="margin:0">
							<div class="form-group">
								<input type="text" name="uname" class="form-control uname" style="height:40px" placeholder="请输入用户名" maxlength="30">
							</div>
							<div class="form-group">
								<input type="password" name="upass" class="form-control upass" style="height:40px" placeholder="请输入登录密码" maxlength="30">
							</div>
							<div class="form-group">
								<button class="btn  btn-block" onclick="doLogin()" style="height:40px;line-height:40px;padding:0">登 录</button>
							</div>
							
							<div class="form-group">
								<span class="error_msg"></span>
							</div>
							
						</div>
						<div class="form-group" style="width:90%;margin:0 auto">
							<input type="checkbox" id="remember" checked="checked" style="margin-right:10px">记住用户名
						</div>
						<div class="dialog_bottom">
							诚信 &nbsp;&nbsp;|&nbsp;&nbsp; 勤勉 &nbsp;&nbsp;|&nbsp;&nbsp; 创新 &nbsp;&nbsp;|&nbsp;&nbsp; 务实
						</div>
		<!-- 		</form> -->
				</div>
			</div>
		</div>
	</div>
	<div class="row bottom" style="margin-top:20px">
		<p>Copyright &copy; 2016-2018&nbsp;&nbsp;江苏量为石信息科技股份有限公司</p>
	</div>
	<script type="text/javascript">
		window.onkeyup=function(e){
			if(e.keyCode==13){
				doLogin();
			}
		};
		
		$("#remember").click(function(){
			if($(this).attr("checked")=="checked"){
				$(this).removeAttr("checked")
			}else{
				$(this).attr("checked","checked")
			}
		})
		
		var logindata = $.cookie("logindata")
		if(logindata){
			var logindatajson =JSON.parse(logindata)
			$("input[name=uname]").val(logindatajson.uname);
			$upass = $("input[name=upass]").val(logindatajson.upass);
		}
		
		function doLogin(){
			var $uname = $("input[name=uname]");
			var $upass = $("input[name=upass]");
			var unameUpass=JSON.stringify({"uname":$uname.val(),"upass":$upass.val()})
			
			if($("#remember").	attr("checked")=="checked"){
				$.cookie("logindata",unameUpass);
			}
			
			 var $error_msg = $(".error_msg");
			var icon = "<span class=\"glyphicon glyphicon-exclamation-sign\"></span> ";
			// check
			if(!$uname.val() || $uname.val().length==0){
				var msg="请输入用户名！";
				$error_msg.html(icon+msg);
				$uname.focus();
				return false;
			}
			if(!$upass.val() || $upass.val().length==0){
				var msg="请输入密码！";
				$error_msg.html(icon+msg);
				$upass.focus();
				return false;
			}
			// login
			$.ajax({
				url:serviceBasePath+"eap/pmsServices/loginService",
				method:"GET",
				data:{"userName":$uname.val(),"psw":$upass.val()},//?userName=chenhaijie&psw=123456
				cache:false,
				success:function(res){
					if(!res){
						msg="服务器无响应信息！";
						$error_msg.html(icon+msg);
						return;
					}
					if(res.statusCode=="200"){
						// 200
						var ticket = res.ticket;
						$.cookie("pmsWeb_ticket", ticket, {"path":"/"});
						res.data.ticket=ticket;
						$.cookie("pmsWeb_user_data", JSON.stringify(res.data), {"path":"/"});
						sessionStorage.serviceBasePath=serviceBasePath;
						sessionStorage.userToken=JSON.stringify(res.data);
						location.href="main.html?ticket="+ticket;
					}else{
						msg="用户名或密码错误！";
						$error_msg.html(icon+msg);
					}
				},
				error:function(){
					var msg = "服务器访问失败";
					$error_msg.html(icon+msg);
				}
			}); 
		}
	</script>
</body>
</html>
