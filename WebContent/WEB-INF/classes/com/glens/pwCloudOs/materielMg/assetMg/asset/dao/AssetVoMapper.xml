<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.glens.pwCloudOs.materielMg.assetMg.asset.dao.AssetVoMapper" >
  <resultMap id="BaseResultMap" type="com.glens.pwCloudOs.materielMg.assetMg.asset.vo.AssetVo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
     <id column="rowno" property="rowno" jdbcType="BIGINT" />
    <result column="ASSET_QR_CODE" property="assetQrCode" jdbcType="VARCHAR" />
    <result column="ASSET_CODE" property="assetCode" jdbcType="VARCHAR" />
    <result column="ASSET_NAME" property="assetName" jdbcType="VARCHAR" />
    <result column="ASSET_CLASS_NAME" property="assetClassName" jdbcType="VARCHAR" />
    <result column="ASSET_TYPE_CODE" property="assetTypeCode" jdbcType="VARCHAR" />
    <result column="ASSET_TYPE_NAME" property="assetTypeName" jdbcType="VARCHAR" />
    <result column="BRAND" property="brand" jdbcType="VARCHAR" />
    <result column="MODEL_NO" property="modelNo" jdbcType="VARCHAR" />
    <result column="FORMS" property="forms" jdbcType="VARCHAR" />
    <result column="PRICE1" property="price1" jdbcType="REAL" />
    <result column="PRICE2" property="price2" jdbcType="REAL" />
    <result column="BILL" property="bill" jdbcType="VARCHAR" />
    <result column="DATE_PURCHASE" property="datePurchase" />
    <result column="DATE_STORAGE" property="dateStorage" />
    <result column="DATE_DUMP" property="dateDump" />
    <result column="DUMP_AMOUNT" property="dumpAmount" jdbcType="REAL" />
    <result column="STATUS" property="status" jdbcType="INTEGER" />
    <result column="LOAN_EMPLOYEECODE" property="loanEmployeecode" jdbcType="VARCHAR" />
    <result column="LOAN_EMPLOYEENAME" property="loanEmployeename" jdbcType="VARCHAR" />
    <result column="LOAN_UNIT_CODE" property="loanUnitCode" jdbcType="VARCHAR" />
    <result column="LOAN_UNIT_NAME" property="loanUnitName" jdbcType="VARCHAR" />
    <result column="LOAN_PRO_NO" property="loanProNo" jdbcType="VARCHAR" />
    <result column="LOAN_PRO_NAME" property="loanProName" jdbcType="VARCHAR" />
    <result column="LOCATION" property="location" jdbcType="VARCHAR" />
    <result column="VA_NO" property="vaNo" jdbcType="VARCHAR" />
    <result column="VA_OIL" property="vaOil" jdbcType="INTEGER" />
    <result column="VA_OIL_CONSUMPTION" property="vaOilConsumption" jdbcType="REAL" />
    <result column="VA_INIT_MILEAGE" property="vaInitMileage" jdbcType="INTEGER" />
    <result column="VA_ENGINE_NO" property="vaEngineNo" jdbcType="VARCHAR" />
    <result column="VA_CARFRAME_NO" property="vaCarframeNo" jdbcType="VARCHAR" />
    <result column="REMARKS" property="remarks" jdbcType="VARCHAR" />
    <result column="ASSET_DESC" property="assetDesc" />
    <result column="ASSET_MARK" property="assetMark" />
    <result column="STATUSNAME" property="statusname" />
    
    <result column="IS_MARK" property="isMark" />
    <result column="MARK_DATE" property="markDate" />
    <result column="MARK_OWNER" property="markOwner" />
    <result column="STOCK_PERIOD" property="stockPeriod" />
    <result column="STOCK_PERIOD_NAME" property="stockPeriodName" />
    
  </resultMap>
  <sql id="Base_Column_List" >
    a.ASSET_QR_CODE, a.ASSET_CODE,a.ASSET_NAME, a.ASSET_TYPE_CODE, a.PRICE1, a.PRICE2, a.BILL, DATE_FORMAT(a.DATE_PURCHASE,'%Y-%m-%d') DATE_PURCHASE, 
    DATE_FORMAT(a.DATE_STORAGE,'%Y-%m-%d') DATE_STORAGE,DATE_FORMAT(a.DATE_DUMP,'%Y-%m-%d') DATE_DUMP, a.DUMP_AMOUNT, a.STATUS, a.LOAN_EMPLOYEECODE, ifnull(a.LOAN_EMPLOYEENAME,'') LOAN_EMPLOYEENAME, 
    a.LOAN_UNIT_CODE, a.LOAN_UNIT_NAME, a.LOAN_PRO_NO, ifnull(a.LOAN_PRO_NAME,'') LOAN_PRO_NAME, a.LOCATION, a.VA_NO, a.VA_OIL, 
    a.VA_OIL_CONSUMPTION, a.VA_INIT_MILEAGE,a.VA_ENGINE_NO,a.VA_CARFRAME_NO,a.REMARKS, b.ASSET_TYPE_NAME, c.ASSET_CLASS_NAME,
    case when VA_NO is null then '' else CONCAT(a.VA_NO,',',a.VA_OIL,',',a.VA_OIL_CONSUMPTION,',', a.VA_INIT_MILEAGE) end ASSET_DESC,a.ASSET_MARK,
    a.BRAND,a.MODEL_NO,a.FORMS,case when a.STATUS=1 then '闲置' when a.STATUS=2 then '在用（部门）' when a.STATUS=3 then '在用（项目）' when a.STATUS=4 then '项目维修'
    when a.STATUS=5 then '维修'  when a.STATUS=6 then '待报废' when a.STATUS=7 then '已报废' end STATUSNAME,case when a.IS_MARK is null or a.IS_MARK=0 then '未标识' else '已标识' end IS_MARK,a.MARK_DATE,a.MARK_OWNER,
    case when a.STOCK_PERIOD='1' then '日' when a.STOCK_PERIOD='2' then '周' when a.STOCK_PERIOD='3' then '月' end STOCK_PERIOD_NAME,a.STOCK_PERIOD
  </sql>
  
  <select id="queryForCount" parameterType="map" resultType="int">
  	select count(*) from gm_asset_base a
  	join GM_ASSET_TYPE b on a.ASSET_TYPE_CODE=b.ASSET_TYPE_CODE
  	join GM_ASSET_CLASS c on b.ASSET_CLASS_CODE=c.ASSET_CLASS_CODE
  	<if test="districtManager != null and districtManager != ''">
  	join PM_BASE e on a.LOAN_PRO_NO=e.PRO_NO and e.DISTRICT_MANAGER=#{districtManager}
  	</if>
  	where a.SYS_PROCESS_FLAG='1' and find_in_set(cast(a.STATUS as char(1)), #{tstatus})>0
  	<if test="assetClassCode != null and assetClassCode !=''">
  	and b.ASSET_CLASS_CODE=#{assetClassCode}
  	</if>
  	<if test="assetTypeCode != null and assetTypeCode !=''">
  	and b.ASSET_TYPE_CODE=#{assetTypeCode}
  	</if>
  	
  	<if test="searchName != null and searchName != ''">
  	and (
  		a.ASSET_NAME like concat('%', #{searchName}, '%') or
  		a.BRAND like concat('%', #{searchName}, '%') or
  		a.LOAN_EMPLOYEENAME like concat('%', #{searchName}, '%') or
  		a.LOAN_UNIT_NAME like concat('%', #{searchName}, '%') or
  		a.LOAN_PRO_NAME like concat('%', #{searchName}, '%') or
  		a.FORMS like concat('%', #{searchName}, '%')
  		)
  	</if>
  	<if test="fromDate != null and fromDate != ''">
  		and a.DATE_PURCHASE &gt;= #{fromDate}
  	</if>
  	<if test="endDate != null and endDate != ''">
  		and a.DATE_PURCHASE &lt;= #{endDate}
  	</if>
  	<if test="price1!=null and price1>0">
  		and (a.PRICE1 &gt;= #{price1} or
  		 a.PRICE2 &gt;= #{price1})
  	</if>
  	<if test="price2!=null and price2>0">
  		and (a.PRICE2 &lt;= #{price2} or
  		 a.PRICE2 &lt;= #{price2})
  	</if>
  	<if test="loanProNo != null and loanProNo != ''">
  	and a.LOAN_PRO_NO = #{loanProNo}
  	</if>
  	<if test="loanUnitCode != null and loanUnitCode != ''">
  	  and a.LOAN_UNIT_CODE = #{loanUnitCode}
  	</if>
  	<if test="isMark != null and isMark != ''">
  		<if test="isMark==1">
  			and a.IS_MARK = #{isMark}
  		</if>
  		<if test="isMark==0">
  		and (a.IS_MARK = #{isMark} or a.IS_MARK is null  or a.IS_MARK='')
  		</if>
  	</if>
  	
  </select>
  
  <select id="queryForPage" parameterType="map" resultMap="BaseResultMap">
  	select 
    <include refid="Base_Column_List" />
    from gm_asset_base a
    join GM_ASSET_TYPE b on a.ASSET_TYPE_CODE=b.ASSET_TYPE_CODE
  	join GM_ASSET_CLASS c on b.ASSET_CLASS_CODE=c.ASSET_CLASS_CODE
  	<if test="districtManager != null and districtManager != ''">
  	join PM_BASE e on a.LOAN_PRO_NO=e.PRO_NO and e.DISTRICT_MANAGER=#{districtManager}
  	</if>
  	where a.SYS_PROCESS_FLAG='1' and find_in_set(cast(a.STATUS as char(1)), #{tstatus})>0
  	<if test="assetClassCode != null and assetClassCode !=''">
  	and b.ASSET_CLASS_CODE=#{assetClassCode}
  	</if>
  	<if test="assetTypeCode != null and assetTypeCode !=''">
  	and b.ASSET_TYPE_CODE=#{assetTypeCode}
  	</if>
  	<if test="searchName != null and searchName != ''">
  	and (
  		a.ASSET_NAME like concat('%', #{searchName}, '%') or
  		a.BRAND like concat('%', #{searchName}, '%') or
  		a.LOAN_EMPLOYEENAME like concat('%', #{searchName}, '%') or
  		a.LOAN_UNIT_NAME like concat('%', #{searchName}, '%') or
  		a.LOAN_PRO_NAME like concat('%', #{searchName}, '%') or
  		a.FORMS like concat('%', #{searchName}, '%')
  		)
  	</if>
  	<if test="fromDate != null and fromDate != ''">
  		and a.DATE_PURCHASE &gt;= #{fromDate}
  	</if>
  	<if test="endDate != null and endDate != ''">
  		and a.DATE_PURCHASE &lt;= #{endDate}
  	</if>
  	<if test="price1!=null and price1>0">
  		and (a.PRICE1 &gt;= #{price1} or
  		 a.PRICE2 &gt;= #{price1})
  	</if>
  	<if test="price2!=null and price2>0">
  		and (a.PRICE2 &lt;= #{price2} or
  		 a.PRICE2 &lt;= #{price2})
  	</if>
  	
  	<if test="loanProNo != null and loanProNo != ''">
  	and a.LOAN_PRO_NO = #{loanProNo}
  	</if>
  	
  	<if test="loanUnitCode != null and loanUnitCode != ''">
  	and a.LOAN_UNIT_CODE = #{loanUnitCode}
  	</if>
  	
  	<if test="isMark != null and isMark != ''">
  		<if test="isMark==1">
  			and a.IS_MARK = #{isMark} 
  		</if>
  		<if test="isMark==0">
  			and (a.IS_MARK = #{isMark} or a.IS_MARK is null  or a.IS_MARK='')
  		</if>
  	</if>
  	
  	
  	limit #{firstResult},#{maxResult}
  </select>
  
  <select id="queryForExport" parameterType="map" resultMap="BaseResultMap">
  	set @mycnt=0;
  	select 
  		(@mycnt:=@mycnt+1) as rowno,
  		<include refid="Base_Column_List" />
    from gm_asset_base a
    join GM_ASSET_TYPE b on a.ASSET_TYPE_CODE=b.ASSET_TYPE_CODE
  	join GM_ASSET_CLASS c on b.ASSET_CLASS_CODE=c.ASSET_CLASS_CODE
  	where a.SYS_PROCESS_FLAG='1' and find_in_set(cast(a.STATUS as char(1)), #{tstatus})>0
  <if test="assetClassCode != null and assetClassCode !=''">
  	and b.ASSET_CLASS_CODE=#{assetClassCode}
  	</if>
  	<if test="assetTypeCode != null and assetTypeCode !=''">
  	and b.ASSET_TYPE_CODE=#{assetTypeCode}
  	</if>
  	<if test="searchName != null and searchName != ''">
  	and (
  		a.ASSET_NAME like concat('%', #{searchName}, '%') or
  		a.LOAN_EMPLOYEENAME like concat('%', #{searchName}, '%') or
  		a.LOAN_UNIT_NAME like concat('%', #{searchName}, '%') or
  		a.LOAN_PRO_NAME like concat('%', #{searchName}, '%') or
  		a.FORMS like concat('%', #{searchName}, '%')
  		)
  	</if>
  	<if test="fromDate != null and fromDate != ''">
  	and a.DATE_PURCHASE = #{fromDate, jdbcType=VARCHAR}
  	</if>
  	<if test="endDate != null and endDate != 0">
  	and (a.PRICE1 = #{endDate, jdbcType=REAL}
  		or a.PRICE2 = #{endDate, jdbcType=REAL})
  	</if>
  	<if test="loanProNo != null and loanProNo != ''">
  	and a.LOAN_PRO_NO = #{loanProNo}
  	</if>
  </select>
  
  <select id="findById" resultMap="BaseResultMap" parameterType="com.glens.pwCloudOs.materielMg.assetMg.asset.vo.AssetVo" >
    select 
    <include refid="Base_Column_List" />
    from gm_asset_base a
    join GM_ASSET_TYPE b on a.ASSET_TYPE_CODE=b.ASSET_TYPE_CODE
  	join GM_ASSET_CLASS c on b.ASSET_CLASS_CODE=c.ASSET_CLASS_CODE
  	where a.SYS_PROCESS_FLAG='1'
    and  a.ASSET_CODE = #{assetCode}
  </select>
  <delete id="delete" parameterType="com.glens.pwCloudOs.materielMg.assetMg.asset.vo.AssetVo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from gm_asset_base
    where ASSET_CODE = #{assetCode}
  </delete>
  
  <insert id="insert" parameterType="java.util.List"  >
   
    insert into gm_asset_base (ASSET_QR_CODE, ASSET_CODE, ASSET_NAME,
      ASSET_TYPE_CODE, PRICE1, PRICE2, BRAND,MODEL_NO,FORMS,
      BILL, DATE_PURCHASE, DATE_STORAGE, 
      STATUS, 
      LOAN_EMPLOYEECODE, LOAN_EMPLOYEENAME, LOAN_UNIT_CODE, 
      LOAN_UNIT_NAME, LOAN_PRO_NO, LOAN_PRO_NAME, 
      LOCATION, ASSET_MARK,
     
        VA_NO,
      
        VA_OIL,
    
        VA_OIL_CONSUMPTION,
     
        VA_INIT_MILEAGE,
     
        VA_ENGINE_NO,
   
      
        VA_CARFRAME_NO,
      
      
      SYS_CREATE_TIME, 
      SYS_PROCESS_FLAG, REMARKS,IS_MARK,MARK_DATE,MARK_OWNER,STOCK_PERIOD) values
      <foreach collection="list" item="p" index="i" separator=",">
      (#{p.assetQrCode,jdbcType=VARCHAR}, #{p.assetCode,jdbcType=VARCHAR}, #{p.assetName,jdbcType=VARCHAR},
      #{p.assetTypeCode,jdbcType=VARCHAR}, #{p.price1,jdbcType=REAL}, #{p.price2,jdbcType=REAL}, #{p.brand},#{p.modelNo},#{p.forms},
      #{p.bill,jdbcType=VARCHAR},
      
      <if test="p.datePurchase==''">
      	NULL,
      </if>
      <if test="p.datePurchase!=''">
      	#{p.datePurchase},
      </if>
        <if test="p.dateStorage==''">
      	NULL,
      </if>
      <if test="p.dateStorage!=''">
      	#{p.dateStorage},
      </if>
       1,#{p.loanEmployeecode,jdbcType=VARCHAR}, #{p.loanEmployeename,jdbcType=VARCHAR}, #{p.loanUnitCode,jdbcType=VARCHAR}, 
      #{p.loanUnitName,jdbcType=VARCHAR}, #{p.loanProNo,jdbcType=VARCHAR}, #{p.loanProName,jdbcType=VARCHAR}, 
      #{p.location,jdbcType=VARCHAR},#{p.assetMark},
      
        #{p.vaNo,jdbcType=VARCHAR},
     
        #{p.vaOil,jdbcType=INTEGER},
      
        #{p.vaOilConsumption,jdbcType=REAL},
     
        #{p.vaInitMileage,jdbcType=INTEGER},
     
        #{p.vaEngineNo,jdbcType=VARCHAR},
      
        #{p.vaCarframeNo,jdbcType=VARCHAR},
      
      now(), 
      '1', #{p.remarks,jdbcType=VARCHAR}, #{p.isMark}, 
      
      <if test="p.markDate==''">
      	NULL,
      </if>
      <if test="p.markDate!=''">
      	#{p.markDate},
      </if>
      
       #{p.markOwner},#{p.stockPeriod})
     </foreach>
  </insert>
  
  <update id="update" parameterType="com.glens.pwCloudOs.materielMg.assetMg.asset.vo.AssetVo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update gm_asset_base
    <set >
      <if test="assetQrCode != null" >
        ASSET_QR_CODE = #{assetQrCode,jdbcType=VARCHAR},
      </if>
      <if test="assetTypeCode != null" >
        ASSET_TYPE_CODE = #{assetTypeCode,jdbcType=VARCHAR},
      </if>
      <if test="assetName != null" >
        ASSET_NAME = #{assetName,jdbcType=VARCHAR},
      </if>
      <if test="price1 != null" >
        PRICE1 = #{price1,jdbcType=REAL},
      </if>
      <if test="price2 != null" >
        PRICE2 = #{price2,jdbcType=REAL},
      </if>
      <if test="brand != null" >
        BRAND = #{brand},
      </if>
      <if test="modelNo != null" >
        MODEL_NO = #{modelNo},
      </if>
       <if test="forms != null" >
        FORMS = #{forms},
      </if>
      <if test="bill != null" >
        BILL = #{bill,jdbcType=VARCHAR},
      </if>
      <if test="datePurchase != null and datePurchase != '' " >
        DATE_PURCHASE = #{datePurchase},
      </if>
      <if test="dateStorage != null and dateStorage != '' " >
        DATE_STORAGE = #{dateStorage},
      </if>
      <if test="dateDump != null and dateDump!=''" >
        DATE_DUMP = #{dateDump,jdbcType=DATE},
      </if>
      <if test="dumpAmount != null" >
        DUMP_AMOUNT = #{dumpAmount,jdbcType=REAL},
      </if>
      <if test="loanEmployeecode != null" >
        LOAN_EMPLOYEECODE = #{loanEmployeecode,jdbcType=VARCHAR},
      </if>
      <if test="loanEmployeename != null" >
        LOAN_EMPLOYEENAME = #{loanEmployeename,jdbcType=VARCHAR},
      </if>
      <if test="loanUnitCode != null" >
        LOAN_UNIT_CODE = #{loanUnitCode,jdbcType=VARCHAR},
      </if>
      <if test="loanUnitName != null" >
        LOAN_UNIT_NAME = #{loanUnitName,jdbcType=VARCHAR},
      </if>
      <if test="loanProNo != null" >
        LOAN_PRO_NO = #{loanProNo,jdbcType=VARCHAR},
      </if>
      <if test="loanProName != null" >
        LOAN_PRO_NAME = #{loanProName,jdbcType=VARCHAR},
      </if>
      <if test="location != null" >
        LOCATION = #{location,jdbcType=VARCHAR},
      </if>
      <if test="vaNo != null" >
        VA_NO = #{vaNo,jdbcType=VARCHAR},
      </if>
      <if test="vaOil != null" >
        VA_OIL = #{vaOil,jdbcType=INTEGER},
      </if>
      <if test="vaOilConsumption != null" >
        VA_OIL_CONSUMPTION = #{vaOilConsumption,jdbcType=REAL},
      </if>
      <if test="vaInitMileage != null" >
        VA_INIT_MILEAGE = #{vaInitMileage,jdbcType=INTEGER},
      </if>
      
       <if test="vaEngineNo != null" >
        VA_ENGINE_NO = #{vaEngineNo,jdbcType=VARCHAR},
      </if>
       <if test="vaCarframeNo != null" >
        VA_CARFRAME_NO = #{vaCarframeNo,jdbcType=VARCHAR},
      </if>
      <if test="assetMark != null">
      	ASSET_MARK=#{assetMark},
      </if>
      <if test="remarks != null" >
        REMARKS = #{remarks,jdbcType=VARCHAR},
      </if>
      <if test="status != null and status != ''" >
        STATUS = #{status,jdbcType=VARCHAR},
      </if>
      <if test="markDate != null and markDate != ''" >
        MARK_DATE = #{markDate},
      </if>
      <if test="markOwner != null and markOwner != ''" >
        MARK_OWNER = #{markOwner},
      </if>
      <if test="isMark != null and isMark != ''" >
        IS_MARK = #{isMark},
      </if>
       <if test="stockPeriod != null and stockPeriod != ''" >
        STOCK_PERIOD = #{stockPeriod},
      </if>
      SYS_UPDATE_TIME = now()
    </set>
    where ASSET_CODE = #{assetCode,jdbcType=VARCHAR}
  </update>
  
  <!-- 退租 -->
  <update id="updateRentStatus"  parameterType="map">
  		update gm_asset_rent set RENT_STATUS=2,RETURN_DATE=#{rentDate}
		WHERE ASSET_CODE=#{assetCode} and RENT_STATUS=1
  </update>
  
  <insert id="addRent" parameterType="map">
  	insert into gm_asset_rent(ASSET_CODE,LOAN_EMPLOYEECODE,
  	LOAN_EMPLOYEENAME,LOAN_UNIT_CODE,LOAN_UNIT_NAME,LOAN_PRO_NO,
  	LOAN_PRO_NAME,RENT_DATE,ESTIMATE_RETURN_DATE,RENT_STATUS,FLOW_STATUS,SYS_CREATE_TIME,SYS_PROCESS_FLAG,REMARKS) 
  	VALUES(#{assetCode},#{loanEmployeecode},#{loanEmployeename},#{loanUnitCode},#{loanUnitName},
  	#{loanProNo},#{loanProName},#{rentDate},#{estimateReturnDate},1,4,now(),'1',#{remarks})

  </insert>
  
  <update id="updateAssetStatus" parameterType="map">
  	update gm_asset_base set 
  	LOAN_EMPLOYEECODE=#{loanEmployeecode},
  	LOAN_EMPLOYEENAME=#{loanEmployeename},
  	LOAN_UNIT_CODE=#{loanUnitCode},
  	LOAN_UNIT_NAME=#{loanUnitName},
  	LOAN_PRO_NO=#{loanProNo},
  	LOAN_PRO_NAME=#{loanProName},
  	SYS_UPDATE_TIME=now(),
  	STATUS=#{status}
	where asset_code=#{assetCode}
  </update>
  
  
  <select id="selectAssetDetail" parameterType="map" resultType="map">
  	select a.ASSET_QR_CODE assetQrCode, a.ASSET_CODE assetCode, a.ASSET_TYPE_CODE assetTypeCode, a.PRICE1 price1, a.ASSET_MARK assetMark,
	a.PRICE2 price2, a.BILL bill, DATE_FORMAT(a.DATE_PURCHASE,'%Y-%m-%d')  datePurChase,DATE_FORMAT(a.DATE_STORAGE,'%Y-%m-%d')  dateStorage,DATE_FORMAT(a.DATE_DUMP,'%Y-%m-%d')  dateDump, 
	a.DUMP_AMOUNT dumpAmount, a.STATUS status, a.LOAN_EMPLOYEECODE loanEmployeeCode, a.LOAN_EMPLOYEENAME loanEmployeeName, 
	a.LOAN_UNIT_CODE loanUnitCode, a.LOAN_UNIT_NAME loanUnitName, a.LOAN_PRO_NO loanProNo, a.LOAN_PRO_NAME loanProName, 
	a.LOCATION location, a.VA_NO vaNo, a.VA_OIL vaOil, a.VA_OIL_CONSUMPTION vaOilConsumption, a.VA_INIT_MILEAGE vaInitMileage, 
	a.REMARKS remarks, b.ASSET_TYPE_NAME assetTypeName, c.ASSET_CLASS_NAME assetClassName,d.ASSET_CHARACTER_NAME assetCharacterName,b.LIFETIME lifeTime,b.brand brand,b.MODEL_NO modelNo
	from gm_asset_base a
	join gm_asset_type b on a.ASSET_TYPE_CODE=b.ASSET_TYPE_CODE
	join gm_asset_class c on b.ASSET_CLASS_CODE=c.ASSET_CLASS_CODE
	join FM_ASSET_CHARACTER d on c.ASSET_CHARACTER_CODE=d.ASSET_CHARACTER_CODE
	where a.ASSET_CODE=#{assetCode}
  </select>
  
  <update id="assetScrap" parameterType="map" >
  		update gm_asset_base 
  		set STATUS=7,
  		DATE_DUMP=#{dateDump},
  		DUMP_AMOUNT=#{dumpAmount},
  		LOAN_PRO_NO='',
  		LOAN_PRO_NAME=''
  		WHERE ASSET_CODE=#{assetCode}
  </update>
  
  <update id="upDateForms" parameterType="map" >
  		update gm_asset_base 
  		set forms=#{forms}
  		
  		WHERE ASSET_CODE=#{assetCode}
  </update>
  
  <select id="selectTop20AssetMaintain" parameterType="map" resultType="map">
  	select ASSET_CODE assetCode,DATE_FORMAT(MT_DATE,'%Y-%m-%d') mtDate,MT_CONTENT mtContent,MT_PROCESS mtProcess,
  	MT_COST mtCost,MT_VENDER mtVender
  	from GM_ASSET_MAINTAIN
  	where ASSET_CODE=#{assetCode} order by MT_DATE desc limit 0,20
  </select>
  
  <select id="selectTop20AssetRepair" parameterType="map" resultType="map">
  	select ASSET_CODE assetCode,LOAN_EMPLOYEECODE loanEmployeeCode,LOAN_EMPLOYEENAME loanEmployeeName,
  	LOAN_UNIT_CODE loanUnitCode,LOAN_UNIT_NAME loanUnitName,LOAN_PRO_NO loanProNo, LOAN_PRO_NAME loanProName,
  	DATE_FORMAT(REPORT_DATE, '%Y-%m-%d') reportDate,DATE_FORMAT(REPAIR_DATE, '%Y-%m-%d') repairDate,
  	DATE_FORMAT(FINISH_DATE, '%Y-%m-%d') finishDate,REPAIR_REASON repairReason,REPAIR_COST repairCost,REPAIR_VENDER repairVender
  	from GM_ASSET_REPAIR
  	where ASSET_CODE=#{assetCode} order by REPAIR_DATE desc limit 0,20
  </select>
  
  <select id="selectTop20AssetRent" parameterType="map" resultType="map">
  	select ASSET_CODE assetCode,LOAN_EMPLOYEECODE loanEmployeeCode,LOAN_EMPLOYEENAME loanEmployeeName,
  	LOAN_UNIT_CODE loanUnitCode,LOAN_UNIT_NAME loanUnitName,LOAN_PRO_NO loanProNo, LOAN_PRO_NAME loanProName,
  	ifnull(DATE_FORMAT(RENT_DATE, '%Y-%m-%d'),'') rentDate,ifnull(DATE_FORMAT(ESTIMATE_RETURN_DATE, '%Y-%m-%d'),'') estimateReturnDate,
  	ifnull(DATE_FORMAT(RETURN_DATE, '%Y-%m-%d'),'') returnDate,RENT_STATUS rentStatus,
  	case RENT_STATUS when 1 then datediff(CURDATE(), RENT_DATE) when 2 then datediff(RETURN_DATE, RENT_DATE) end rentDay 
  	from GM_ASSET_RENT
  	where ASSET_CODE=#{assetCode} order by RENT_DATE desc limit 0,20
  </select>
  
  <select id="selectAssetChecklist" parameterType="map" resultType="map">
  	select a.LOAN_PRO_NO loadProNo,a.LOAN_PRO_NAME loanProName,d.ASSET_CLASS_NAME assetClassName,d.ASSET_CLASS_CODE assetClassCode,
	a.ASSET_CODE assetCode,cast(datediff(CURDATE(), a.RENT_DATE) * ifnull(c.DAILY_RENT,0) as DECIMAL(9,2)) rentAmount
	from GM_ASSET_RENT a
	join GM_ASSET_BASE b on a.ASSET_CODE = b.ASSET_CODE
	join GM_ASSET_TYPE c on b.ASSET_TYPE_CODE=c.ASSET_TYPE_CODE
	join GM_ASSET_CLASS d on c.ASSET_CLASS_CODE=d.ASSET_CLASS_CODE
	where a.RENT_STATUS=1 and a.LOAN_PRO_NO is not null
	<if test="proNo != null and proNo != ''">
	and a.LOAN_PRO_NO = #{proNo}
	</if>
	<if test="proName != null and proName != ''">
	and a.LOAN_PRO_NAME like "%"#{proName}"%"
	</if>
	<if test="assetClassCode != null and assetClassCode != ''">
	and d.ASSET_CLASS_CODE=#{assetClassCode}
	</if>
  </select>
  
  <select id="selectRentAssetPro" resultType="map" parameterType="map">
  	select distinct b.LOAN_PRO_NO loadProNo,b.LOAN_PRO_NAME loanProName
	from GM_ASSET_RENT b inner join pm_base d on b.LOAN_PRO_NO=d.pro_no
	where b.RENT_STATUS=1
	<if test="proNo != null and proNo != ''">
	and b.LOAN_PRO_NO = #{proNo}
	</if>
	<if test="deptCode != null and deptCode != ''">
		and d.MANAGE_DEPT=#{deptCode}
    </if>
    <if test="districtManager!=null and districtManager!=''">
    	and d.DISTRICT_MANAGER=#{districtManager}
    </if>
  </select>
  
  <select id="selectRentAssetClass" resultType="map">
  	select distinct d.ASSET_CLASS_NAME assetClassName,d.ASSET_CLASS_CODE assetClassCode
	from GM_ASSET_RENT a
	join GM_ASSET_BASE b on a.ASSET_CODE = b.ASSET_CODE
	join GM_ASSET_TYPE c on b.ASSET_TYPE_CODE=c.ASSET_TYPE_CODE
	join GM_ASSET_CLASS d on c.ASSET_CLASS_CODE=d.ASSET_CLASS_CODE
	where a.RENT_STATUS=1 and a.LOAN_PRO_NO is not null
  </select>
  
  <select id="selectProRentAsset" parameterType="map" resultType="map">
  	select a.LOAN_PRO_NO loadProNo,a.LOAN_PRO_NAME loanProName,c.DAILY_RENT dailyRent,datediff(CURDATE(), a.RENT_DATE) rentDay,
	a.ASSET_CODE assetCode,cast(datediff(CURDATE(), a.RENT_DATE) * ifnull(c.DAILY_RENT,0) as DECIMAL(9,2)) rentAmount,DATE_FORMAT(a.RENT_DATE,'%Y-%m-%d') rentDate,
	ifnull(b.BRAND,'') brand,ifnull(b.MODEL_NO,'') modelNo,c.ASSET_TYPE_NAME assetTypeName,a.LOAN_EMPLOYEENAME loanEmployeeName,
	ifnull(DATE_FORMAT(a.RECEIVE_DATE,'%Y-%m-%d'),'') receiveDate
	from GM_ASSET_RENT a
	join GM_ASSET_BASE b on a.ASSET_CODE = b.ASSET_CODE
	join GM_ASSET_TYPE c on b.ASSET_TYPE_CODE=c.ASSET_TYPE_CODE
	where a.RENT_STATUS=1 and a.LOAN_PRO_NO is not null and a.LOAN_PRO_NO=#{proNo} and c.ASSET_CLASS_CODE=#{assetClassCode}
  </select>
  
  <select id="selectAllProRentBed" resultType="map">
  	select a.PRO_NO proNo,cast(datediff(CURDATE(), a.RENT_DATE)*ifnull(b.DAYRENT,0) as DECIMAL(9,2)) rentAmount,'9999' assetClassCode,'宿舍床位' assetClassName
	from gm_bm_bedrent a
	join gm_bm_dorm b on a.DORM_CODE=b.DORM_CODE
	where a.SYS_PROCESS_FLAG='1' and b.SYS_PROCESS_FLAG='1'
	and a.RENT_STATUS=1
  </select>
  
  <select id="queryHouseRent" resultType="map" parameterType="map">
	SELECT
		e.proNo,
		sum(e.rentAmount) rentAmount
	FROM
		(
			SELECT
				a.PRO_NO proNo,
				cast(
					datediff(#{endtime}, a.RENT_DATE) * ifnull(b.DAYRENT, 0) AS DECIMAL (9, 2)
				) rentAmount
			FROM
				gm_bm_bedrent a
			JOIN gm_bm_dorm b ON a.DORM_CODE = b.DORM_CODE
			WHERE
				a.SYS_PROCESS_FLAG = '1'
			AND b.SYS_PROCESS_FLAG = '1'
			AND a.RENT_STATUS = 1
			AND a.PRO_NO = #{proNo}
			AND a.RENT_DATE &lt;= #{endtime}
			AND a.RENT_DATE >= #{starttime}
		) e  
  </select>
  
  
   <select id="queryCarRent" resultType="map" parameterType="map">
	SELECT
		a.LOAN_PRO_NO proNo,
		sum(
			cast(
				datediff(#{endtime}, a.RENT_DATE) * ifnull(c.DAILY_RENT, 0) AS DECIMAL (9, 2)
			)
		) rentAmount
	FROM
		GM_ASSET_RENT a
	JOIN GM_ASSET_BASE b ON a.ASSET_CODE = b.ASSET_CODE
	JOIN GM_ASSET_TYPE c ON b.ASSET_TYPE_CODE = c.ASSET_TYPE_CODE
	JOIN GM_ASSET_CLASS d ON c.ASSET_CLASS_CODE = d.ASSET_CLASS_CODE
	WHERE
		a.RENT_STATUS = 1
	AND a.LOAN_PRO_NO IS NOT NULL
	AND d.ASSET_CLASS_CODE = 'C20160623105233363157'
	AND c.ASSET_TYPE_CODE IN ('13', '14', '15', '16')
	AND a.LOAN_PRO_NO = #{proNo}
	AND a.RENT_DATE >= #{starttime}
	AND a.RENT_DATE &lt;= #{endtime}
   </select>
   
   
   <select id="queryDeviceUse" resultType="map" parameterType="map">
	SELECT
		a.LOAN_PRO_NO proNo,
		sum(
			cast(
				datediff(#{endtime}, a.RENT_DATE) * ifnull(c.DAILY_RENT, 0) AS DECIMAL (9, 2)
			)
		) rentAmount
	FROM
		GM_ASSET_RENT a
	JOIN GM_ASSET_BASE b ON a.ASSET_CODE = b.ASSET_CODE
	JOIN GM_ASSET_TYPE c ON b.ASSET_TYPE_CODE = c.ASSET_TYPE_CODE
	JOIN GM_ASSET_CLASS d ON c.ASSET_CLASS_CODE = d.ASSET_CLASS_CODE
	WHERE
		a.RENT_STATUS = 1
	AND a.LOAN_PRO_NO IS NOT NULL
	AND c.ASSET_TYPE_CODE NOT IN ('13', '14', '15', '16')
	AND a.LOAN_PRO_NO =#{proNo}
	AND a.RENT_DATE >= #{starttime}
	AND a.RENT_DATE &lt;= #{endtime}
   </select>
   
   <select id="queryGasolineUse" resultType="map" parameterType="map">
	SELECT
		b.PRO_NO proNo,
		round(sum(b.AMOUNT),2) rentAmount
	FROM
		gm_vm_filling_record b
	WHERE
		b.CHECK_RESULT = '1'
	AND b.PRO_NO = #{proNo}
	AND LEFT (b.CHECK_TIME, 10) &lt;= #{endtime}
	AND LEFT (b.CHECK_TIME, 10) >= #{starttime}
   </select>
   
   
  <select id="selectProRentBed" parameterType="map" resultType="map">
  	select b.DORM_NAME dormName,p.PRO_NAME proName,a.EMPLOYEENAME employeeName,a.EMPLOYEECODE employeecode,DATE_FORMAT(a.RENT_DATE,'%Y-%m-%d') rentDate,
  	cast(datediff(CURDATE(), a.RENT_DATE)*ifnull(b.DAYRENT,0) as DECIMAL(9,2)) rentAmount,datediff(CURDATE(), a.RENT_DATE) rentDay,
  	b.DAYRENT dayRent,ifnull(DATE_FORMAT(a.RECEIVE_DATE,'%Y-%m-%d'),'') receiveDate
	from gm_bm_bedrent a
	join gm_bm_dorm b on a.DORM_CODE=b.DORM_CODE
	left join pm_base p on p.pro_no=a.PRO_NO
	where a.SYS_PROCESS_FLAG='1' and b.SYS_PROCESS_FLAG='1'
	and a.RENT_STATUS=1 <!-- and a.PRO_NO=#{proNo} -->
	<if test="dormCode != null and dormCode != ''">
	and a.DORM_CODE=#{dormCode} 
	</if>
	<if test="proNo != null and proNo != ''">
	and a.PRO_NO=#{proNo}
	</if>
	and a.RENT_STATUS=1 and a.FLOW_STATUS=4
	ORDER BY a.PRO_NO DESC,a.RENT_DATE
  </select>
  
 
  <select id="queryForCount1" parameterType="map" resultType="int">
  	select count(*) from (
  		SELECT a.ASSET_CODE,a.ASSET_NAME,t.ASSET_TYPE_NAME,c.ASSET_CLASS_NAME,a.MODEL_NO,a.BRAND,t.MEASURE_UNIT,
		a.PRICE2,a.PRICE1,t.DAILY_RENT,t.DAILY_RENT_UNIT,a.STATUS,p.PRO_NO,p.PRO_NAME,p.PRO_MANAGER,p.PROVINCE,p.CITY,p.DISTRICT,
		m.UNIT_NAME,a.DATE_PURCHASE,e.EMPLOYEENAME,j.CHECK_DEAL_DATE,a.REMARKS
		from gm_asset_base a
		LEFT JOIN GM_ASSET_TYPE t on t.ASSET_TYPE_CODE=a.ASSET_TYPE_CODE
		left JOIN gm_asset_class c on c.ASSET_CLASS_CODE=t.ASSET_CLASS_CODE
		LEFT JOIN pm_base p on p.PRO_NO=a.LOAN_PRO_NO
		left JOIN md_org_unit m on m.UNIT_CODE=a.LOAN_UNIT_CODE
		LEFT JOIN (SELECT * FROM (SELECT * FROM GM_ASSET_CHECK ORDER BY CHECK_DEAL_DATE DESC ) t GROUP BY t.ASSET_CODE) j
		on j.ASSET_CODE=a.ASSET_CODE
		LEFT JOIN md_employee e on e.EMPLOYEECODE=j.CHECK_EMPLOYEE_CODE
		where 1=1 and find_in_set(cast(a.STATUS as char(1)), #{tstatus})>0
		<if test="assetClassCode != null and assetClassCode !=''">
	  	and c.ASSET_CLASS_CODE=#{assetClassCode}
	  	</if>
	  	<if test="assetTypeCode != null and assetTypeCode !=''">
	  	and t.ASSET_TYPE_CODE=#{assetTypeCode}
	  	</if>
	  	<if test="searchName != null and searchName != ''">
	  	and (
	  		a.ASSET_NAME like concat('%', #{searchName}, '%') or
	  		a.ASSET_CODE like concat('%', #{searchName}, '%') or
	  		a.BRAND like concat('%', #{searchName}, '%') or
	  		a.LOAN_EMPLOYEENAME like concat('%', #{searchName}, '%') or
	  		a.LOAN_UNIT_NAME like concat('%', #{searchName}, '%') or
	  		a.LOAN_PRO_NAME like concat('%', #{searchName}, '%') or
	  		a.FORMS like concat('%', #{searchName}, '%')
	  		)
	  	</if>
	  	<if test="fromDate != null and fromDate != ''">
	  		and a.DATE_PURCHASE &gt;= #{fromDate}
	  	</if>
	  	<if test="endDate != null and endDate != ''">
	  		and a.DATE_PURCHASE &lt;= #{endDate}
	  	</if>
	  	
	  	<if test="loanProNo != null and loanProNo != ''">
	  	and a.LOAN_PRO_NO = #{loanProNo}
	  	</if>
	  	
	  	<if test="loanUnitCode != null and loanUnitCode != ''">
	  	and a.LOAN_UNIT_CODE = #{loanUnitCode}
	  	</if>
  	) t1
  	
  </select>
  
  <select id="getMaterialBase" parameterType="map" resultType="map">
	SELECT a.ASSET_CODE,a.ASSET_NAME,t.ASSET_TYPE_NAME,c.ASSET_CLASS_NAME,
	IFNULL(a.MODEL_NO,'') MODEL_NO,IFNULL(a.BRAND,'') BRAND,t.MEASURE_UNIT,
	IFNULL(a.PRICE2,'') PRICE2,IFNULL(a.PRICE1,'') PRICE1,IFNULL(t.DAILY_RENT,'') DAILY_RENT,
	t.DAILY_RENT_UNIT,a.STATUS,IFNULL(p.PRO_NO,'') PRO_NO,IFNULL(p.PRO_NAME,'') PRO_NAME,
	IFNULL(p.PRO_MANAGER,'') PRO_MANAGER,IFNULL(p.PROVINCE,'') PROVINCE,IFNULL(p.CITY,'') CITY,IFNULL(p.DISTRICT,'') DISTRICT,
	IFNULL(m.UNIT_NAME,'') UNIT_NAME,DATE_FORMAT(a.DATE_PURCHASE,'%Y-%m-%d') DATE_PURCHASE, IFNULL(e.EMPLOYEENAME,'') EMPLOYEENAME,
	DATE_FORMAT(j.CHECK_DEAL_DATE,'%Y-%m-%d') CHECK_DEAL_DATE,IFNULL(a.REMARKS,'') REMARKS,a.VA_NO
	from gm_asset_base a
	LEFT JOIN GM_ASSET_TYPE t on t.ASSET_TYPE_CODE=a.ASSET_TYPE_CODE
	left JOIN gm_asset_class c on c.ASSET_CLASS_CODE=t.ASSET_CLASS_CODE
	LEFT JOIN pm_base p on p.PRO_NO=a.LOAN_PRO_NO
	left JOIN md_org_unit m on m.UNIT_CODE=a.LOAN_UNIT_CODE
	LEFT JOIN (SELECT * FROM (SELECT * FROM GM_ASSET_CHECK ORDER BY CHECK_DEAL_DATE DESC ) t GROUP BY t.ASSET_CODE) j
	on j.ASSET_CODE=a.ASSET_CODE
	LEFT JOIN md_employee e on e.EMPLOYEECODE=j.CHECK_EMPLOYEE_CODE
	where 1=1 and find_in_set(cast(a.STATUS as char(1)), #{tstatus})>0
	<if test="assetClassCode != null and assetClassCode !=''">
  	and c.ASSET_CLASS_CODE=#{assetClassCode}
  	</if>
  	<if test="assetTypeCode != null and assetTypeCode !=''">
  	and t.ASSET_TYPE_CODE=#{assetTypeCode}
  	</if>
  	<if test="searchName != null and searchName != ''">
  	and (
  		a.ASSET_NAME like concat('%', #{searchName}, '%') or
  		a.ASSET_CODE like concat('%', #{searchName}, '%') or
  		a.BRAND like concat('%', #{searchName}, '%') or
  		a.LOAN_EMPLOYEENAME like concat('%', #{searchName}, '%') or
  		a.LOAN_UNIT_NAME like concat('%', #{searchName}, '%') or
  		a.LOAN_PRO_NAME like concat('%', #{searchName}, '%') or
  		a.FORMS like concat('%', #{searchName}, '%')
  		)
  	</if>
  	<if test="fromDate != null and fromDate != ''">
  		and a.DATE_PURCHASE &gt;= #{fromDate}
  	</if>
  	<if test="endDate != null and endDate != ''">
  		and a.DATE_PURCHASE &lt;= #{endDate}
  	</if>
  	
  	<if test="loanProNo != null and loanProNo != ''">
  	and a.LOAN_PRO_NO = #{loanProNo}
  	</if>
  	
  	<if test="loanUnitCode != null and loanUnitCode != ''">
  	and a.LOAN_UNIT_CODE = #{loanUnitCode}
  	</if>
  	
  	limit #{firstResult},#{maxResult}
  </select>
  
  <select id="queryForCount2" parameterType="map" resultType="int">
  
  	select count(*) from(
  		select t2.*,IFNULL(g.FUELCARD_NO,'') FUELCARD_NO,IFNULL(f.D_MILEAGE,'') D_MILEAGE  from(
		SELECT a.ASSET_CODE,a.ASSET_NAME,t.ASSET_TYPE_NAME,c.ASSET_CLASS_NAME,
		IFNULL(a.MODEL_NO,'') MODEL_NO,IFNULL(a.BRAND,'') BRAND,t.MEASURE_UNIT,
		IFNULL(a.PRICE2,'') PRICE2,IFNULL(a.PRICE1,'') PRICE1,IFNULL(t.DAILY_RENT,'') DAILY_RENT,
		t.DAILY_RENT_UNIT,a.STATUS,IFNULL(p.PRO_NO,'') PRO_NO,IFNULL(p.PRO_NAME,'') PRO_NAME,
		IFNULL(p.PRO_MANAGER,'') PRO_MANAGER,IFNULL(p.PROVINCE,'') PROVINCE,IFNULL(p.CITY,'') CITY,IFNULL(p.DISTRICT,'') DISTRICT,
		IFNULL(m.UNIT_NAME,'') UNIT_NAME,DATE_FORMAT(a.DATE_PURCHASE,'%Y-%m-%d') DATE_PURCHASE, IFNULL(e.EMPLOYEENAME,'') EMPLOYEENAME,
		DATE_FORMAT(j.CHECK_DEAL_DATE,'%Y-%m-%d') CHECK_DEAL_DATE,IFNULL(a.REMARKS,'') REMARKS
		from gm_asset_base a  
		LEFT JOIN GM_ASSET_TYPE t on t.ASSET_TYPE_CODE=a.ASSET_TYPE_CODE 
		left JOIN gm_asset_class c on c.ASSET_CLASS_CODE=t.ASSET_CLASS_CODE
		LEFT JOIN pm_base p on p.PRO_NO=a.LOAN_PRO_NO
		left JOIN md_org_unit m on m.UNIT_CODE=a.LOAN_UNIT_CODE
		LEFT JOIN (SELECT * FROM (SELECT * FROM GM_ASSET_CHECK ORDER BY CHECK_DEAL_DATE DESC ) t GROUP BY t.ASSET_CODE) j
		on j.ASSET_CODE=a.ASSET_CODE
		LEFT JOIN md_employee e on e.EMPLOYEECODE=j.CHECK_EMPLOYEE_CODE
		where  a.ASSET_MARK=1
		<if test="searchName != null and searchName != ''">
	  	and a.VA_NO like concat('%', #{searchName}, '%')
	  	</if>
		) t2 
		left JOIN GM_VM_FUELCARD g on g.ASSET_CODE=t2.ASSET_CODE
		LEFT JOIN(select * from(
		select * from  PM_TM_VEHICLE_DISPATCH
		ORDER BY E_DATE desc) t GROUP BY t.VEHICLE_NO) f on f.VEHICLE_NO=g.FUELCARD_NO
  	) t3
  
  </select>
  
  
  <select id="getVehicleList" parameterType="map" resultType="map">
  		select t2.*,IFNULL(g.FUELCARD_NO,'') FUELCARD_NO,IFNULL(f.D_MILEAGE,'') D_MILEAGE  from(
		SELECT a.ASSET_CODE,a.ASSET_NAME,t.ASSET_TYPE_NAME,c.ASSET_CLASS_NAME,
		IFNULL(a.MODEL_NO,'') MODEL_NO,IFNULL(a.BRAND,'') BRAND,t.MEASURE_UNIT,
		IFNULL(a.PRICE2,'') PRICE2,IFNULL(a.PRICE1,'') PRICE1,IFNULL(t.DAILY_RENT,'') DAILY_RENT,
		t.DAILY_RENT_UNIT,a.STATUS,IFNULL(p.PRO_NO,'') PRO_NO,IFNULL(p.PRO_NAME,'') PRO_NAME,
		IFNULL(p.PRO_MANAGER,'') PRO_MANAGER,IFNULL(p.PROVINCE,'') PROVINCE,IFNULL(p.CITY,'') CITY,IFNULL(p.DISTRICT,'') DISTRICT,
		IFNULL(m.UNIT_NAME,'') UNIT_NAME,DATE_FORMAT(a.DATE_PURCHASE,'%Y-%m-%d') DATE_PURCHASE, IFNULL(e.EMPLOYEENAME,'') EMPLOYEENAME,
		DATE_FORMAT(j.CHECK_DEAL_DATE,'%Y-%m-%d') CHECK_DEAL_DATE,IFNULL(a.REMARKS,'') REMARKS,a.VA_NO
		from gm_asset_base a  
		LEFT JOIN GM_ASSET_TYPE t on t.ASSET_TYPE_CODE=a.ASSET_TYPE_CODE 
		left JOIN gm_asset_class c on c.ASSET_CLASS_CODE=t.ASSET_CLASS_CODE
		LEFT JOIN pm_base p on p.PRO_NO=a.LOAN_PRO_NO
		left JOIN md_org_unit m on m.UNIT_CODE=a.LOAN_UNIT_CODE
		LEFT JOIN (SELECT * FROM (SELECT * FROM GM_ASSET_CHECK ORDER BY CHECK_DEAL_DATE DESC ) t GROUP BY t.ASSET_CODE) j
		on j.ASSET_CODE=a.ASSET_CODE
		LEFT JOIN md_employee e on e.EMPLOYEECODE=j.CHECK_EMPLOYEE_CODE
		where  a.ASSET_MARK=1
		<if test="searchName != null and searchName != ''">
	  	and a.VA_NO like concat('%', #{searchName}, '%')
	  	</if>
		) t2 
		left JOIN GM_VM_FUELCARD g on g.ASSET_CODE=t2.ASSET_CODE
		LEFT JOIN(select * from(
		select * from  PM_TM_VEHICLE_DISPATCH
		ORDER BY E_DATE desc) t GROUP BY t.VEHICLE_NO) f on f.VEHICLE_NO=g.FUELCARD_NO
		
		limit #{firstResult},#{maxResult}
		
  </select>
  
</mapper>