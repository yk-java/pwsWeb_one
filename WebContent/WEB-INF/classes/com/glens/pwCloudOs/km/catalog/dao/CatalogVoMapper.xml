<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.glens.pwCloudOs.km.catalog.dao.CatalogVoMapper" >
  <resultMap id="BaseResultMap" type="com.glens.pwCloudOs.km.catalog.vo.CatalogVo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
     <id column="rowid" property="rowid" jdbcType="BIGINT" />
    <result column="COMPANY_CODE" property="companyCode" jdbcType="VARCHAR" />
    <result column="CATALOG_CODE" property="catalogCode" jdbcType="VARCHAR" />
    <result column="CATALOG_NAME" property="catalogName" jdbcType="VARCHAR" />
    <result column="PARENT_CATALOG_CODE" property="parentCatalogCode" jdbcType="VARCHAR" />
    <result column="CATALOG_NO" property="cataNo" jdbcType="INTEGER" />
    <result column="SYS_PROCESS_FLAG" property="sysProcessFlag" jdbcType="VARCHAR" />
    <result column="REMARKS" property="remarks" jdbcType="VARCHAR" />
    <result column="NUM" property="num" jdbcType="VARCHAR" />
    <result column="CATALOG_ICON" property="catalogIcon" jdbcType="VARCHAR" />
  </resultMap>
  
  
  
  <select id="queryForCount" parameterType="map" resultType="int">
  	select count(*) from (
  		select a.rowid,a.COMPANY_CODE,a.CATALOG_CODE,a.CATALOG_NAME,a.PARENT_CATALOG_CODE,a.CATALOG_NO,a.SYS_PROCESS_FLAG,a.REMARKS,
  	(select count(*) from km_catalog b where b.PARENT_CATALOG_CODE=a.CATALOG_CODE and b.SYS_PROCESS_FLAG='1') NUM,CATALOG_ICON
  	from km_catalog  a
  	where a.SYS_PROCESS_FLAG='1' and a.company_code=#{companyCode} 
  	<if test="parentCatalogCode!=null and parentCatalogCode !=''">
  		and a.PARENT_CATALOG_CODE=#{parentCatalogCode}
  	</if>
	order by a.rowid
  	)  tt
  </select>
  
  <select id="queryForPage" parameterType="map" resultMap="BaseResultMap">
  	select a.rowid,a.COMPANY_CODE,a.CATALOG_CODE,a.CATALOG_NAME,a.PARENT_CATALOG_CODE,a.CATALOG_NO,a.SYS_PROCESS_FLAG,a.REMARKS,
  	(select count(*) from km_catalog b where b.PARENT_CATALOG_CODE=a.CATALOG_CODE and b.SYS_PROCESS_FLAG='1') NUM,CATALOG_ICON
  	from km_catalog  a
  	where a.SYS_PROCESS_FLAG='1' and a.company_code=#{companyCode} 
  	<if test="parentCatalogCode!=null and parentCatalogCode !=''">
  		and a.PARENT_CATALOG_CODE=#{parentCatalogCode}
  	</if>
	order by a.rowid
  	limit #{firstResult},#{maxResult}
  </select>
  
  <select id="getTreeList" parameterType="map" resultType="map">
	  	select rowid,COMPANY_CODE companyCode,CATALOG_CODE id,CATALOG_NAME name,PARENT_CATALOG_CODE pId,CATALOG_NO,SYS_PROCESS_FLAG,REMARKS from km_catalog 
	  	where SYS_PROCESS_FLAG='1' and company_code=#{companyCode} 
		order by rowid
  </select>
  
 

  
  <select id="queryKmCatalogList" resultType="map">
	select
		b.company_code companyCode,
		b.catalog_code catalogCode,
		b.catalog_name catalogName,
		b.catalog_icon catalogIcon,
		0 fileCount
	from
		km_catalog b
	WHERE
	b.PARENT_CATALOG_CODE = '0'
	AND b.SYS_PROCESS_FLAG = '1'
	order by
		b.catalog_no  	
  </select>
  
  <select id="findById" resultMap="BaseResultMap" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->

  	select rowid,COMPANY_CODE,CATALOG_CODE,CATALOG_NAME,PARENT_CATALOG_CODE,CATALOG_NO,SYS_PROCESS_FLAG,REMARKS,CATALOG_ICON from km_catalog 
  	where SYS_PROCESS_FLAG='1' and company_code=#{companyCode} and catalog_code=#{catalogCode}
  </select>
  
  <delete id="delete" parameterType="com.glens.pwCloudOs.km.catalog.vo.CatalogVo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update km_catalog set SYS_PROCESS_FLAG='0' where company_code=#{companyCode} and catalog_code=#{catalogCode}

  </delete>
  
  
  <insert id="insert" parameterType="com.glens.pwCloudOs.km.catalog.vo.CatalogVo"  >
   		insert into km_catalog(company_code,catalog_code,catalog_name,parent_catalog_code,sys_process_flag,CREATOR)
		values(#{companyCode},#{catalogCode},#{catalogName},#{parentCatalogCode},'1',#{creator})
    
  </insert>
  
  <update id="update" parameterType="com.glens.pwCloudOs.km.catalog.vo.CatalogVo" >
    	update km_catalog set 
    	CATALOG_NAME=#{catalogName},
    	PARENT_CATALOG_CODE=#{parentCatalogCode},
    	SYS_PROCESS_FLAG='1'
    	<if test="catalogIcon!=null">
    		,CATALOG_ICON=#{catalogIcon}
    	</if>
    	where CATALOG_CODE=#{catalogCode} and COMPANY_CODE=#{companyCode}
  </update>
  
 
  
</mapper>