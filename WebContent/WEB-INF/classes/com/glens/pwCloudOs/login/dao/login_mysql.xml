<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="login">

  <resultMap id="UserToken" type="com.glens.eap.platform.framework.beans.UserToken">
  		 <result property="regionCode" column="REGION_CODE" />
  		 <result property="regionName" column="REGION_NAME" />
  		 <result property="companyCode" column="COMPANY_CODE" />
  		 <result property="companyName" column="COMPANY_NAME" />
         <result property="unitCode" column="UNIT_CODE" />
         <result property="unitName" column="UNIT_NAME" />
         <result property="roleCode" column="ROLE_CODE" />
         <result property="roleName" column="ROLE_NAME" />
         <result property="employeeCode" column="EMPLOYEECODE" />
  		 <result property="employeeName" column="EMPLOYEENAME" />
         <result property="accountCode" column="ACCOUNT_CODE" />
         <result property="accountName" column="ACCOUNT_NAME" />
         <result property="accountPsw" column="ACCOUNT_PASSWORD" />
         <result property="accountType" column="ACCOUNT_TYPE" />
         <result property="x" column="X" />
         <result property="y" column="Y" />
  </resultMap>

 <select id="[getAccountByAccountName]" parameterType="java.lang.String" resultMap="UserToken">
    select a.REGION_CODE,a.EMPLOYEECODE,a.ACCOUNT_CODE,a.ACCOUNT_NAME,a.ACCOUNT_PASSWORD,a.ACCOUNT_TYPE,
	b.REGION_NAME,c.EMPLOYEENAME,d.COMPANY_CODE,d.COMPANY_NAME,ifnull(e.UNIT_CODE, '') UNIT_CODE,ifnull(e.UNIT_NAME,'') UNIT_NAME,
	f.ROLE_NAME,f.ROLE_CODE, d.X, d.Y
	from pf_account a
	join md_region b on a.REGION_CODE=b.REGION_CODE
	join md_employee c on a.EMPLOYEECODE=c.EMPLOYEECODE
	join es_company d on a.COMPANY_CODE=d.COMPANY_CODE
	left join md_org_unit e on c.UNIT_CODE=e.UNIT_CODE
	join sm_role f on a.ROLECODE=f.ROLE_CODE
	where a.SYS_PROCESS_FLAG='1' and ACCOUNT_TYPE='2' and a.ACCOUNT_NAME=#{accountName}
 </select>
 
 <select id="[getPswByAccountName]" parameterType="String" resultType="java.lang.String">
 	select ACCOUNT_PASSWORD from pf_account where ACCOUNT_NAME=#{userName} and SYS_PROCESS_FLAG='1'
 </select>
 
 <select id="[queryModuleList]" parameterType="String"
		resultType="java.util.HashMap">
		select
			e.module_code moduleCode,
			e.module_name moduleName,
			ifnull(e.parent_module_code,0) parentModuleCode,
			e.url,
			e.mobile_url as mobileUrl,
			e.module_level moduleLevel,
			e.icon moduleIcon
		from
			pf_account b,
			sm_role c,
			sm_role_module d,
			ad_app_modules e
		where
			b.account_name = #{account}
		and b.rolecode = c.role_code
		and c.role_code = d.role_code
		and d.module_code = e.module_code
		order by e.module_code		
	</select>
	
	<update id="updateUserPsw" parameterType="java.util.HashMap">
		update pf_account set ACCOUNT_PASSWORD=#{psw} where ACCOUNT_CODE=#{accountCode}
	</update>
 
 	<update id="updateUserPswByMobile" parameterType="java.util.HashMap">
	UPDATE pf_account
	SET ACCOUNT_PASSWORD = #{psw}
	where ACCOUNT_NAME=#{accountName}
	</update>
	
</mapper>